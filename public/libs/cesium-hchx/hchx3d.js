/* 2019-11-4 16:27:13 | 版权所有 北京华创汇翔科技有限公司】 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Cesium"),require("jQuery"),require("turf"),require("mapv")):"function"==typeof define&&define.amd?define(["Cesium","jQuery","turf","mapv"],t):"object"==typeof exports?exports.hchx3d=t(require("Cesium"),require("jQuery"),require("turf"),require("mapv")):e.hchx3d=t(e.Cesium,e.jQuery,e.turf,e.mapv)}("undefined"!=typeof self?self:this,function(__WEBPACK_EXTERNAL_MODULE_0__,__WEBPACK_EXTERNAL_MODULE_5__,__WEBPACK_EXTERNAL_MODULE_22__,__WEBPACK_EXTERNAL_MODULE_94__){return d=[function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_0__},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aroundPoint=t.windingPoint=void 0,t.formatNum=l,t.formatPositon=u,t.formatRectangle=c,t.getMaxHeight=d,t.computePolygonHeightRange=function(e,t){for(var i=[],a=0;a<e.length;a++)i.push(e[a].clone());var n,r,o,s,l,u,c,d=0,h=9999,f=Math.PI/Math.pow(2,11)/64,p=new g.default.PolygonGeometry.fromPositions({positions:i,vertexFormat:g.default.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,granularity:f}),m=new g.default.PolygonGeometry.createGeometry(p);for(a=0;a<m.indices.length;a+=3)n=m.indices[a],r=m.indices[a+1],o=m.indices[a+2],c=new g.default.Cartesian3(m.attributes.position.values[3*n],m.attributes.position.values[3*n+1],m.attributes.position.values[3*n+2]),(s=t.globe.getHeight(g.default.Cartographic.fromCartesian(c)))<h&&(h=s),d<s&&(d=s),c=new g.default.Cartesian3(m.attributes.position.values[3*r],m.attributes.position.values[3*r+1],m.attributes.position.values[3*r+2]),(l=t.globe.getHeight(g.default.Cartographic.fromCartesian(c)))<h&&(h=l),d<l&&(d=l),c=new g.default.Cartesian3(m.attributes.position.values[3*o],m.attributes.position.values[3*o+1],m.attributes.position.values[3*o+2]),(u=t.globe.getHeight(g.default.Cartographic.fromCartesian(c)))<h&&(h=u),d<u&&(d=u);return{maxHeight:d,minHeight:h}},t.addPositionsHeight=function(e,t){if(t=Number(t)||0,isNaN(t)||0==t)return e;{if(e instanceof Array){for(var i=[],a=0,n=e.length;a<n;a++){var r=g.default.Cartographic.fromCartesian(e[a]),o=g.default.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+t);i.push(o)}return i}r=g.default.Cartographic.fromCartesian(e);return g.default.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+t)}},t.setPositionsHeight=function(e,t){{if(t=Number(t)||0,e instanceof Array){for(var i=[],a=0,n=e.length;a<n;a++){var r=g.default.Cartographic.fromCartesian(e[a]),o=g.default.Cartesian3.fromRadians(r.longitude,r.latitude,t);i.push(o)}return i}r=g.default.Cartographic.fromCartesian(e);return g.default.Cartesian3.fromRadians(r.longitude,r.latitude,t)}},t.updateHeightForClampToGround=function(e,t){var i=g.default.Cartographic.fromCartesian(t),a=e.scene.globe.getHeight(i)||0,n=e.scene.sampleHeight(i)||0,r=a<n?n:a;if(null!=r&&0<r){return g.default.Cartesian3.fromRadians(i.longitude,i.latitude,r)}return t},t.getCurrentMousePosition=function(e,t,i){var a=e.pick(t);if(e.pickPositionSupported&&g.default.defined(a)&&function(e,t){if(g.default.defined(e.id)){var i=e.id;if(i._noMousePosition)return!1;if(t&&i==t)return!1}if(g.default.defined(e.primitive)){var a=e.primitive;if(a._noMousePosition)return!1;if(t&&a==t)return!1}return!0}(a,i)){var n=e.pickPosition(t);if(g.default.defined(n)){var r=g.default.Cartographic.fromCartesian(n).height;if(0<=r)return n;if(!g.default.defined(a.id)&&-500<=r)return n}}if(e.mode===g.default.SceneMode.SCENE3D){var o=e.camera.getPickRay(t);n=e.globe.pick(o,e)}else n=e.camera.pickEllipsoid(t,e.globe.ellipsoid);return n},t.getCenter=h,t.getExtent=function(e,t){var i=c(e.camera.computeViewRectangle());if(t){var a=e.hchx.point2wgs({x:i.xmin,y:i.ymin});i.xmin=a.x,i.ymin=a.y;var n=e.hchx.point2wgs({x:i.xmax,y:i.ymax});i.xmax=n.x,i.ymax=n.y}if(i.xmax<i.xmin){var r=i.xmax;i.xmax=i.xmin,i.xmin=r}if(i.ymax<i.ymin){r=i.ymax;i.ymax=i.ymin,i.ymin=r}return i},t.getCameraView=function(e,t){var i=e.camera,a=i.positionCartographic,n={};n.y=l(g.default.Math.toDegrees(a.latitude),6),n.x=l(g.default.Math.toDegrees(a.longitude),6),n.z=l(a.height,2),n.heading=l(g.default.Math.toDegrees(i.heading||-90),1),n.pitch=l(g.default.Math.toDegrees(i.pitch||0),1),n.roll=l(g.default.Math.toDegrees(i.roll||0),1),t&&(n=e.hchx.point2wgs(n));return n},t.centerOfMass=function(e,t){null==t&&(t=d(e));var i=o.cartesians2lonlats(e);i.push(i[0]);var a=r.centerOfMass(r.polygon([i]));return g.default.Cartesian3.fromDegrees(a.geometry.coordinates[0],a.geometry.coordinates[1],t)};var a,n=i(0),g=(a=n)&&a.__esModule?a:{default:a},r=s(i(22)),o=s(i(2));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function l(e,t){return Number(e.toFixed(t||0))}function u(e){var t=g.default.Cartographic.fromCartesian(e),i={};return i.y=l(g.default.Math.toDegrees(t.latitude),6),i.x=l(g.default.Math.toDegrees(t.longitude),6),i.z=l(t.height,2),i}function c(e){var t=l(g.default.Math.toDegrees(e.west),6),i=l(g.default.Math.toDegrees(e.east),6),a=l(g.default.Math.toDegrees(e.north),6);return{xmin:t,xmax:i,ymin:l(g.default.Math.toDegrees(e.south),6),ymax:a}}function d(e,t){null==t&&(t=0);var i=t;if(null==e||0==e.length)return i;for(var a=0;a<e.length;a++){var n=g.default.Cartographic.fromCartesian(e[a]);n.height>i&&(i=n.height)}return l(i,2)}function h(e,t){var i=e.scene,a=function(e){var t=e.canvas,i=new g.default.Cartesian2(t.clientWidth/2,t.clientHeight/2),a=e.camera.getPickRay(i);return e.globe.pick(a,e)||e.camera.pickEllipsoid(i)}(i);if(!a){var n=i.globe,r=i.camera.positionCartographic.clone(),o=n.getHeight(r);r.height=o||0,a=g.default.Ellipsoid.WGS84.cartographicToCartesian(r)}var s=u(a);t&&(s=e.hchx.point2wgs(s));var l=g.default.Cartesian3.distance(a,e.scene.camera.positionWC);return s.cameraZ=l,s}t.windingPoint={isStart:!1,viewer:null,start:function(e,t){this.viewer=e,t&&t instanceof g.default.Cartesian3?this.position=t:(t=t||h(e),this.position=g.default.Cartesian3.fromDegrees(t.x,t.y,t.z)),this.distance=t.distance||g.default.Cartesian3.distance(this.position,e.camera.positionWC),this.angle=360/(t.time||60),this.time=e.clock.currentTime.clone(),this.heading=e.camera.heading,this.pitch=e.camera.pitch,this.viewer.clock.onTick.addEventListener(this.clock_onTickHandler,this),this.isStart=!0},clock_onTickHandler:function(e){var t=g.default.JulianDate.secondsDifference(this.viewer.clock.currentTime,this.time),i=g.default.Math.toRadians(t*this.angle)+this.heading;this.viewer.scene.camera.setView({destination:this.position,orientation:{heading:i,pitch:this.pitch}}),this.viewer.scene.camera.moveBackward(this.distance)},stop:function(){this.isStart&&(this.viewer&&this.viewer.clock.onTick.removeEventListener(this.clock_onTickHandler,this),this.isStart=!1)}},t.aroundPoint={isStart:!1,viewer:null,start:function(e,t){this.viewer=e,t&&t instanceof g.default.Cartesian3?this.position=t:(t=t||h(e),this.position=g.default.Cartesian3.fromDegrees(t.x,t.y,t.z)),this.angle=360/(t.time||60),this.time=e.clock.currentTime.clone(),this.heading=e.camera.heading,this.pitch=e.camera.pitch,this.viewer.clock.onTick.addEventListener(this.clock_onTickHandler,this),this.isStart=!0},clock_onTickHandler:function(e){var t=g.default.JulianDate.secondsDifference(this.viewer.clock.currentTime,this.time),i=g.default.Math.toRadians(t*this.angle)+this.heading;this.viewer.scene.camera.setView({orientation:{heading:i,pitch:this.pitch}})},stop:function(){this.isStart&&(this.viewer&&this.viewer.clock.onTick.removeEventListener(this.clock_onTickHandler,this),this.isStart=!1)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelFn=t.requestFn=t.emptyImageUrl=t.isArray=t.lastId=t.create=t.freeze=void 0,t.extend=function(e){var t,i,a,n;for(i=1,a=arguments.length;i<a;i++)for(t in n=arguments[i])e[t]=n[t];return e},t.bind=u,t.stamp=function(e){return e._leaflet_id=e._leaflet_id||(t.lastId=c+=1),e._leaflet_id},t.throttle=function(e,t,i){var a,n,r,o;return o=function(){a=!1,n&&(r.apply(i,n),n=!1)},r=function(){a?n=arguments:(e.apply(i,arguments),setTimeout(o,t),a=!0)}},t.wrapNum=function(e,t,i){var a=t[1],n=t[0],r=a-n;return e===a&&i?e:((e-n)%r+r)%r+n},t.falseFn=function(){return!1},t.formatNum=d,t.trim=h,t.splitWords=function(e){return h(e).split(/\s+/)},t.setOptions=function(e,t){e.hasOwnProperty("options")||(e.options=e.options?o(e.options):{});for(var i in t)e.options[i]=t[i];return e.options},t.getParamString=function(e,t,i){var a=[];for(var n in e)a.push(encodeURIComponent(i?n.toUpperCase():n)+"="+encodeURIComponent(e[n]));return(t&&-1!==t.indexOf("?")?"&":"?")+a.join("&")},t.template=function(e,a){return e.replace(f,function(e,t){var i=a[t];if(void 0===i)throw new Error("No value provided for variable "+e);return"function"==typeof i&&(i=i(a)),i})},t.indexOf=function(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1},t.requestAnimFrame=function(e,t,i){{if(!i||y!==v)return y.call(window,u(e,t));e.call(t)}},t.cancelAnimFrame=function(e){e&&_.call(window,e)},t.removeGeoJsonDefVal=function(e){if(!e.properties||!e.properties.type)return e;var t=e.properties.edittype||e.properties.type,i=w[t];if(!i)return e;var a=l.clone(e);if(e.properties.style){var n={};for(var r in e.properties.style){if(null!=(s=e.properties.style[r]))i.style[r]!==s&&(n[r]=s)}a.properties.style=n}if(e.properties.attr){var o={};for(var r in e.properties.attr){var s;if(null!=(s=e.properties.attr[r]))i.attr[r]!==s&&(o[r]=s)}a.properties.attr=o}return a},t.addGeoJsonDefVal=function(e){var t=w[e.edittype||e.type];if(t){for(var i in e.style=e.style||{},t.style){null==e.style[i]&&(e.style[i]=t.style[i])}for(var i in e.attr=e.attr||{},t.attr){null==e.attr[i]&&(e.attr[i]=t.attr[i])}}return e},t.cartesians2lonlats=function(e){for(var t=[],i=0,a=e.length;i<a;i++){var n=b(e[i]);t.push(n)}return t},t.cartesian2lonlat=b,t.getPositionByGeoJSON=function(e,t){var i="Feature"===e.type?e.geometry:e,a=i?i.coordinates:null;if(!a&&!i)return null;switch(i.type){case"Point":return C(a,t);case"MultiPoint":case"LineString":return x(a,t);case"MultiLineString":case"Polygon":return x(a[0],t);case"MultiPolygon":return x(a[0][0],t);default:throw new Error("Invalid GeoJSON object.")}},t.lonlat2cartesian=C,t.lonlats2cartesians=x;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(4));t.freeze=Object.freeze;Object.freeze=function(e){return e};var o=t.create=Object.create||function(e){return s.prototype=e,new s};function s(){}function u(e,t){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var a=i.call(arguments,2);return function(){return e.apply(t,a.length?a.concat(i.call(arguments)):arguments)}}var c=t.lastId=0;function d(e,t){return Number(e.toFixed(t||0))}function h(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}var f=/\{ *([\w_-]+) *\}/g;var p=t.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.emptyImageUrl="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function m(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var g=0;function v(e){var t=+new Date,i=Math.max(0,16-(t-g));return g=t+i,window.setTimeout(e,i)}var y=t.requestFn=window.requestAnimationFrame||m("RequestAnimationFrame")||v,_=t.cancelFn=window.cancelAnimationFrame||m("CancelAnimationFrame")||m("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};var w={label:{edittype:"label",name:"文字",style:{text:"文字",color:"#ffffff",opacity:1,font_family:"楷体",font_size:30,border:!0,border_color:"#000000",border_width:3,background:!1,background_color:"#000000",background_opacity:.5,font_weight:"normal",font_style:"normal",scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},point:{edittype:"point",name:"点标记",style:{pixelSize:10,color:"#3388ff",opacity:1,outline:!0,outlineColor:"#ffffff",outlineOpacity:.6,outlineWidth:2,scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},imagepoint:{edittype:"imagepoint",name:"图标点标记",style:{image:"",opacity:1,scale:1,rotation:0,scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},model:{edittype:"model",name:"模型",style:{modelUrl:"",scale:1,heading:0,pitch:0,roll:0,fill:!1,color:"#3388ff",opacity:1,silhouette:!1,silhouetteColor:"#ffffff",silhouetteSize:2,silhouetteAlpha:.8},attr:{id:"",name:"",remark:""}},polyline:{edittype:"polyline",name:"线",position:{minCount:2},style:{lineType:"solid",color:"#3388ff",width:4,clampToGround:!1,outline:!1,outlineColor:"#ffffff",outlineWidth:2,opacity:1,zIndex:0},attr:{id:"",name:"",remark:""}},polylineVolume:{edittype:"polylineVolume",name:"管道线",position:{height:!0,minCount:2},style:{color:"#00FF00",radius:10,shape:"pipeline",outline:!1,outlineColor:"#ffffff",opacity:1},attr:{id:"",name:"",remark:""}},polygon:{edittype:"polygon",name:"面",position:{height:!0,minCount:3},style:{fill:!0,color:"#3388ff",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,clampToGround:!1,zIndex:0},attr:{id:"",name:"",remark:""}},polygon_clampToGround:{edittype:"polygon_clampToGround",name:"贴地面",position:{height:!1,minCount:3},style:{color:"#ffff00",opacity:.6,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},extrudedPolygon:{edittype:"extrudedPolygon",name:"拉伸面",position:{height:!0,minCount:3},style:{fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,extrudedHeight:100,perPositionHeight:!0,zIndex:0},attr:{id:"",name:"",remark:""}},rectangle:{edittype:"rectangle",name:"矩形",position:{height:!1,minCount:2,maxCount:2},style:{height:0,fill:!0,color:"#3388ff",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,clampToGround:!1,zIndex:0},attr:{id:"",name:"",remark:""}},rectangle_clampToGround:{edittype:"rectangle_clampToGround",name:"贴地矩形",position:{height:!1,minCount:2,maxCount:2},style:{color:"#ffff00",opacity:.6,rotation:0,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},rectangleImg:{edittype:"rectangleImg",name:"贴地图片",position:{height:!1,minCount:2,maxCount:2},style:{image:"",opacity:1,rotation:0,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},extrudedRectangle:{edittype:"extrudedRectangle",name:"拉伸矩形",position:{height:!1,minCount:2,maxCount:2},style:{extrudedHeight:40,height:0,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,zIndex:0},attr:{id:"",name:"",remark:""}},ellipse:{edittype:"ellipse",name:"椭圆",position:{height:!1},style:{semiMinorAxis:200,semiMajorAxis:200,height:0,fill:!0,color:"#3388ff",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,clampToGround:!1,zIndex:0},attr:{id:"",name:"",remark:""}},ellipse_clampToGround:{edittype:"ellipse_clampToGround",name:"椭圆",position:{height:!1},style:{semiMinorAxis:200,semiMajorAxis:200,color:"#ffff00",opacity:.6,rotation:0,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},extrudedEllipse:{edittype:"extrudedEllipse",name:"圆柱体",position:{height:!1},style:{semiMinorAxis:200,semiMajorAxis:200,extrudedHeight:200,height:0,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,zIndex:0},attr:{id:"",name:"",remark:""}},ellipsoid:{edittype:"ellipsoid",name:"球体",style:{extentRadii:200,widthRadii:200,heightRadii:200,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6},attr:{id:"",name:"",remark:""}},wall:{edittype:"wall",name:"墙体",position:{height:!0,minCount:2},style:{extrudedHeight:40,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6},attr:{id:"",name:"",remark:""}}};function b(e){var t=r.default.Cartographic.fromCartesian(e);return null==t?{}:[d(r.default.Math.toDegrees(t.longitude),6),d(r.default.Math.toDegrees(t.latitude),6),d(t.height,2)]}function C(e,t){return r.default.Cartesian3.fromDegrees(e[0],e[1],e[2]||t||0)}function x(e,t){for(var i=[],a=0,n=e.length;a<n;a++){var r=e[a];p(r[0])?i.push(x(r,t)):i.push(C(r,t))}return i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.message=void 0,t.Tooltip=o;var a,n=i(5),r=(a=n)&&a.__esModule?a:{default:a};t.message={draw:{point:{start:"单击 完成绘制"},polyline:{start:"单击 开始绘制",cont:"单击增加点，右击删除点",end:"单击增加点，右击删除点<br/>双击完成绘制",end2:"单击完成绘制"}},edit:{start:"单击后 激活编辑<br/>右击 单击菜单删除",end:"释放后 完成修改"},dragger:{def:"拖动 修改位置",addMidPoint:"拖动 增加点",moveHeight:"拖动 修改高度",editRadius:"拖动 修改半径",editHeading:"拖动 修改方向",editScale:"拖动 修改缩放比例"},del:{def:"<br/>右击 删除该点",min:"无法删除，点数量不能少于"}};function o(e){var t=document.createElement("DIV");t.className="draw-tooltip right";var i=document.createElement("DIV");i.className="draw-tooltip-arrow",t.appendChild(i);var a=document.createElement("DIV");a.className="draw-tooltip-inner",t.appendChild(a),this._div=t,this._title=a,e.appendChild(t),(0,r.default)(".draw-tooltip").mouseover(function(){(0,r.default)(this).hide()})}o.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},o.prototype.showAt=function(e,t){e&&t?(this.setVisible(!0),this._title.innerHTML=t,this._div.style.top=e.y-this._div.clientHeight/2+"px",this._div.style.left=e.x+30+"px"):this.setVisible(!1)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.isNumber=function(e){return"number"==typeof e&&e.constructor==Number},t.isString=function(e){return"string"==typeof e&&e.constructor==String},t.alert=r,t.msg=function(e){window.haoutil&&window.haoutil.msg?window.haoutil.msg(e):window.toastr?toastr.info(e):window.layer?layer.msg(e):r(e)},t.getRequest=function(){var e=location.search,t=new Object;if(-1!=e.indexOf("?"))for(var i=e.substr(1).split("&"),a=0;a<i.length;a++)t[i[a].split("=")[0]]=decodeURI(i[a].split("=")[1]);return t},t.getRequestByName=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(t);return null!=i?decodeURI(i[2]):null},t.clone=function e(t,i){null==i&&(i=5);if(null==t||"object"!=(void 0===t?"undefined":s(t)))return t;if(t instanceof Date){var a=new Date;return a.setTime(t.getTime()),a}if(t instanceof Array&&0<=i){for(var a=[],n=0,r=t.length;n<r;++n)a[n]=e(t[n],i-1);return a}if("object"===(void 0===t?"undefined":s(t))&&0<=i){var a={};for(var o in t)"function"!=typeof o&&"_layer"!=o&&"_layers"!=o&&"_parent"!=o&&t.hasOwnProperty(o)&&(a[o]=e(t[o],i-1));return a}return t},t.template=function(e,t){if(null==e)return e;for(var i in t){var a=t[i];null!=a&&"Null"!=a&&"Unknown"!=a||(a=""),e=e.replace(new RegExp("{"+i+"}","gm"),a)}return e},t.isPCBroswer=function(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),i="iphone"==e.match(/iphone/i),a="midp"==e.match(/midp/i),n="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),r="ucweb"==e.match(/ucweb/i),o="android"==e.match(/android/i),s="windows ce"==e.match(/windows ce/i),l="windows mobile"==e.match(/windows mobile/i);return!(t||i||a||n||r||o||s||l)},t.getExplorerInfo=o,t.webglreport=function(){var e=o();if("IE"==e.type&&e.version<11)return!1;try{var t,i=document.createElement("canvas");if("undefined"!=typeof WebGL2RenderingContext&&(t=i.getContext("webgl2")||i.getContext("experimental-webgl2")||void 0),null==t&&(t=i.getContext("webgl")||i.getContext("experimental-webgl")||void 0),null==t)return!1}catch(e){return!1}return!0},t.terrainPolyline=function(r){var o=r.viewer,s=r.positions;if(null==s||0==s.length)return void(r.calback&&r.calback(s));for(var e=S.default.PolylinePipeline.generateArc({positions:s,granularity:r.granularity||1e-5}),t=[],l=o.scene.globe.ellipsoid,i=0;i<e.length;i+=3){var a=S.default.Cartesian3.unpack(e,i);t.push(l.cartesianToCartographic(a))}var u=S.default.Cartographic.fromCartesian(s[0]).height;S.default.when(S.default.sampleTerrainMostDetailed(o.terrainProvider,t),function(e){for(var t=!1,i=r.offset||2,a=0;a<e.length;++a)null==e[a].height?(t=!0,e[a].height=u):e[a].height=i+e[a].height*o.scene._terrainExaggeration;var n=l.cartographicArrayToCartesianArray(e);r.calback?r.calback(n,t):s.setValue&&s.setValue(n)})},t.getProxyUrl=l,t.getEllipsoidTerrain=function(){return u},t.getTerrainProvider=function(e){e.hasOwnProperty("requestWaterMask")||(e.requestWaterMask=!0);e.hasOwnProperty("requestVertexNormals")||(e.requestVertexNormals=!0);var t;t="ion"==e.type||"ion"==e.url||""==e.url||null==e.url?new S.default.CesiumTerrainProvider({url:S.default.IonResource.fromAssetId(1)}):"ellipsoid"==e.type||"ellipsoid"==e.url?u:"gee"==e.type?new S.default.GoogleEarthEnterpriseTerrainProvider({metadata:new S.default.GoogleEarthEnterpriseMetadata(l(e))}):new S.default.CesiumTerrainProvider(l(e));return t},t.createModel=function(e,t){e=t.hchx.point2map(e);var i=S.default.Cartesian3.fromDegrees(e.x,e.y,e.z||0),a=S.default.Math.toRadians(e.heading||0),n=S.default.Math.toRadians(e.pitch||0),r=S.default.Math.toRadians(e.roll||0),o=new S.default.HeadingPitchRoll(a,n,r),s=e.converter||S.default.Transforms.eastNorthUpToFixedFrame,l=S.default.Transforms.headingPitchRollQuaternion(i,o,t.scene.globe.ellipsoid,s);return t.entities.add({name:e.name||"",position:i,orientation:l,model:e,tooltip:e.tooltip,popup:e.popup})},t.formatDegree=function(e){e=Math.abs(e);var t=Math.floor(e),i=Math.floor(60*(e-t)),a=Math.round(3600*(e-t)%60);return t+"° "+i+"'  "+a+'"'},t.getLinkedPointList=function(e,t,i,a){var n=[],r=S.default.Cartographic.fromCartesian(e),o=S.default.Cartographic.fromCartesian(t),s=180*r.longitude/Math.PI,l=180*r.latitude/Math.PI,u=180*o.longitude/Math.PI,c=180*o.latitude/Math.PI,d=Math.sqrt((s-u)*(s-u)+(l-c)*(l-c))*i,h=S.default.Cartesian3.clone(e),f=S.default.Cartesian3.clone(t),p=S.default.Cartesian3.distance(h,S.default.Cartesian3.ZERO),m=S.default.Cartesian3.distance(f,S.default.Cartesian3.ZERO);if(S.default.Cartesian3.normalize(h,h),S.default.Cartesian3.normalize(f,f),0==S.default.Cartesian3.distance(h,f))return n;var g=S.default.Cartesian3.angleBetween(h,f);n.push(e);for(var v=1;v<a-1;v++){var y=1*v/(a-1),_=1-y,w=Math.sin(_*g)/Math.sin(g),b=Math.sin(y*g)/Math.sin(g),C=S.default.Cartesian3.multiplyByScalar(h,w,new S.default.Cartesian3),x=S.default.Cartesian3.multiplyByScalar(f,b,new S.default.Cartesian3),P=S.default.Cartesian3.add(C,x,new S.default.Cartesian3),M=y*Math.PI,E=p*_+m*y+Math.sin(M)*d;P=S.default.Cartesian3.multiplyByScalar(P,E,P),n.push(P)}return n.push(t),n};var a,n=i(0),S=(a=n)&&a.__esModule?a:{default:a};function r(e,t){window.haoutil&&window.haoutil.alert?window.haoutil.alert(e,t):window.layer?layer.alert(e,{title:t||"提示",skin:"layui-layer-lan layer-hchx-dialog",closeBtn:0,anim:0}):r(e)}function o(){var e=window.navigator.userAgent.toLowerCase();return 0<=e.indexOf("msie")?{type:"IE",version:Number(e.match(/msie ([\d]+)/)[1])}:0<=e.indexOf("firefox")?{type:"Firefox",version:Number(e.match(/firefox\/([\d]+)/)[1])}:0<=e.indexOf("chrome")?{type:"Chrome",version:Number(e.match(/chrome\/([\d]+)/)[1])}:0<=e.indexOf("opera")?{type:"Opera",version:Number(e.match(/opera.([\d]+)/)[1])}:0<=e.indexOf("Safari")?{type:"Safari",version:Number(e.match(/version\/([\d]+)/)[1])}:{type:e,version:-1}}function l(e){if(!e.proxy||!e.url)return e;if(e.url instanceof S.default.Resource)return e;var t={};for(var i in e)t[i]=e[i];return t.url=new S.default.Resource({url:t.url,proxy:new S.default.DefaultProxy(t.proxy)}),t}var u=new S.default.EllipsoidTerrainProvider({ellipsoid:S.default.Ellipsoid.WGS84})},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_5__},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointColor=t.PointType=t.PixelSize=void 0,t.createDragger=function(e,t){var i;if(t.dragger)i=t.dragger;else{var a={scale:1,pixelSize:s,outlineColor:new r.default.Color.fromCssColorString("#ffffff").withAlpha(.5),outlineWidth:2,scaleByDistance:new r.default.NearFarScalar(1e3,1,1e6,.5),disableDepthTestDistance:Number.POSITIVE_INFINITY};a=function(e,t){switch(e){case l.AddMidPoint:t.color=u.AddMidPoint,t.outlineColor=new r.default.Color.fromCssColorString("#ffffff").withAlpha(.4);break;case l.MoveHeight:t.color=u.MoveHeight;break;case l.EditAttr:t.color=u.EditAttr;break;case l.Control:default:t.color=u.Control}return t}(t.type,a),i=e.entities.add({position:r.default.defaultValue(t.position,r.default.Cartesian3.ZERO),point:a,draw_tooltip:t.tooltip||o.message.dragger.def})}return i._isDragger=!0,i._pointType=t.type||l.Control,i.onDragStart=r.default.defaultValue(t.onDragStart,null),i.onDrag=r.default.defaultValue(t.onDrag,null),i.onDragEnd=r.default.defaultValue(t.onDragEnd,null),i};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(3);var s=t.PixelSize=12,l=t.PointType={Control:1,AddMidPoint:2,MoveHeight:3,EditAttr:4,EditRotation:5},u=t.PointColor={Control:new r.default.Color.fromCssColorString("#1c197d"),MoveHeight:new r.default.Color.fromCssColorString("#9500eb"),EditAttr:new r.default.Color.fromCssColorString("#f73163"),AddMidPoint:new r.default.Color.fromCssColorString("#04c2c9").withAlpha(.3)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawStart="draw-start",t.DrawAddPoint="draw-add-point",t.DrawRemovePoint="draw-remove-lastpoint",t.DrawMouseMove="draw-mouse-move",t.DrawCreated="draw-created",t.EditStart="edit-start",t.EditMovePoint="edit-move-point",t.EditRemovePoint="edit-remove-point",t.EditStop="edit-stop"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawPolyline=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(21),s=i(1),l=h(i(7)),u=i(3),c=h(i(10)),d=i(13);function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawPolyline=o.DrawBase.extend({type:"polyline",_minPointNum:2,_maxPointNum:9999,createFeature:function(e){this._positions_draw=[],e.config?(this._minPointNum=e.config.minPointNum||2,this._maxPointNum=e.config.maxPointNum||9999):(this._minPointNum=2,this._maxPointNum=9999);var t=this,i={polyline:c.style2Entity(e.style),attribute:e};return i.polyline.positions=new r.default.CallbackProperty(function(e){return t.getDrawPosition()},!1),this.entity=this.dataSource.entities.add(i),this.entity._positions_draw=this._positions_draw,this.entity},style2Entity:function(e,t){return c.style2Entity(e,t.polyline)},bindEvent:function(){var i=this,a=!1;this.getHandler().setInputAction(function(e){var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.position,i.entity);t&&(a&&i._positions_draw.pop(),a=!1,i.entity.attribute&&i.entity.attribute.config&&i.entity.attribute.config.addHeight&&(t=(0,s.addPositionsHeight)(t,i.entity.attribute.config.addHeight)),i._positions_draw.push(t),i.updateAttrForDrawing(),i.fire(l.DrawAddPoint,{drawtype:i.type,entity:i.entity,position:t,positions:i._positions_draw}),i._positions_draw.length>=i._maxPointNum&&i.disable())},r.default.ScreenSpaceEventType.LEFT_CLICK),this.getHandler().setInputAction(function(e){i._positions_draw.pop();var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.position,i.entity);t&&(a&&i._positions_draw.pop(),a=!0,i.fire(l.DrawRemovePoint,{drawtype:i.type,entity:i.entity,position:t,positions:i._positions_draw}),i._positions_draw.push(t),i.updateAttrForDrawing())},r.default.ScreenSpaceEventType.RIGHT_CLICK),this.getHandler().setInputAction(function(e){i._positions_draw.length<=1?i.tooltip.showAt(e.endPosition,u.message.draw.polyline.start):i._positions_draw.length<i._minPointNum?i.tooltip.showAt(e.endPosition,u.message.draw.polyline.cont):i._positions_draw.length>=i._maxPointNum?i.tooltip.showAt(e.endPosition,u.message.draw.polyline.end2):i.tooltip.showAt(e.endPosition,u.message.draw.polyline.end);var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.endPosition,i.entity);t&&(a&&i._positions_draw.pop(),a=!0,i._positions_draw.push(t),i.updateAttrForDrawing(),i.fire(l.DrawMouseMove,{drawtype:i.type,entity:i.entity,position:t,positions:i._positions_draw}))},r.default.ScreenSpaceEventType.MOUSE_MOVE),this.getHandler().setInputAction(function(e){i._positions_draw.pop(),i._positions_draw.length<i._minPointNum||(i.updateAttrForDrawing(),i.disable())},r.default.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},getEditClass:function(e){var t=new d.EditPolyline(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return c},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),t._positions_draw=this.getDrawPosition(),t.polyline.positions=new r.default.CallbackProperty(function(e){return t._positions_draw},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseLayer=void 0;var a=i(11),n=i(4),r=a.Class.extend({config:{},viewer:null,initialize:function(e,t){this.viewer=t,this.config=e,this.name=e.name,this.config.hasOwnProperty("alpha")?this._opacity=Number(this.config.alpha):this.config.hasOwnProperty("opacity")&&(this._opacity=Number(this.config.opacity)),this.config.hasOwnProperty("hasOpacity")&&(this.hasOpacity=this.config.hasOpacity),this.create(),e.visible?this.setVisible(!0):this._visible=!1,e.visible&&e.flyTo&&this.centerAt(0)},create:function(){},showError:function(e,t){t=t||"未知错误",this.viewer&&this.viewer.cesiumWidget.showErrorPanel(e,void 0,t),console.log("layer错误:"+e+t)},_visible:null,getVisible:function(){return this._visible},setVisible:function(e){null!=this._visible&&this._visible==e||((this._visible=e)?(this.config.msg&&(0,n.msg)(this.config.msg),this.add()):this.remove())},add:function(){this._visible=!0,this.config.onAdd&&this.config.onAdd()},remove:function(){this._visible=!1,this.config.onRemove&&this.config.onRemove()},centerAt:function(e){this.config.extent||this.config.center?this.viewer.hchx.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0}):this.config.onCenterAt&&this.config.onCenterAt(e)},hasOpacity:!1,_opacity:1,setOpacity:function(e){this.config.onSetOpacity&&this.config.onSetOpacity(e)},hasZIndex:!1,setZIndex:function(e){this.config.onSetZIndex&&this.config.onSetZIndex(e)},destroy:function(){this.setVisible(!1)}});t.BaseLayer=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={});for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"lineType":case"color":case"opacity":case"outline":case"outlineWidth":case"outlineColor":case"outlineOpacity":case"flowDuration":case"flowImage":}}if(e.color||e.lineType){var n=new r.default.Color.fromCssColorString(e.color||"#FFFF00").withAlpha(Number(r.default.defaultValue(e.opacity,1)));switch(e.lineType){default:case"solid":e.outline?t.material=new r.default.PolylineOutlineMaterialProperty({color:n,outlineWidth:Number(e.outlineWidth||1),outlineColor:new r.default.Color.fromCssColorString(e.outlineColor||"#FFFF00").withAlpha(Number(e.outlineOpacity||e.opacity||1))}):t.material=n;break;case"dash":e.outline?t.material=new r.default.PolylineDashMaterialProperty({dashLength:e.dashLength||e.outlineWidth||16,color:n,gapColor:new r.default.Color.fromCssColorString(e.outlineColor||"#FFFF00").withAlpha(Number(e.outlineOpacity||e.opacity||1))}):t.material=new r.default.PolylineDashMaterialProperty({dashLength:e.dashLength||16,color:n});break;case"glow":t.material=new r.default.PolylineGlowMaterialProperty({glowPower:e.glowPower||.1,color:n});break;case"arrow":t.material=new r.default.PolylineArrowMaterialProperty(n);break;case"animation":t.material=new l.LineFlowMaterial({color:n,duration:e.animationDuration||2e3,url:e.animationImage})}}return t},t.getPositions=c,t.getCoordinates=d,t.toGeoJSON=function(e){var t=d(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"LineString",coordinates:t}}},t.line2curve=function(e){if(!o)return e;var t=e.map(function(e){return s.cartesian2lonlat(e)}),i=t[t.length-1][2],a=o.lineString(t),n=o.bezierSpline(a);return s.lonlats2cartesians(n.geometry.coordinates,i)};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=u(i(22)),s=u(i(2)),l=i(25);function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function c(e){return e._positions_draw&&0<e._positions_draw.length?e._positions_draw:e.polyline.positions.getValue()}function d(e){var t=c(e);return s.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Class=a;var r=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function a(){}a.extend=function(e){function t(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()}var i=t.__super__=this.prototype,a=r.create(i);for(var n in(a.constructor=t).prototype=a,this)this.hasOwnProperty(n)&&"prototype"!==n&&"__super__"!==n&&(t[n]=this[n]);return e.statics&&(r.extend(t,e.statics),delete e.statics),e.includes&&(r.extend.apply(null,[a].concat(e.includes)),delete e.includes),a.options&&(e.options=r.extend(r.create(a.options),e.options)),r.extend(a,e),a._initHooks=[],a.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=a._initHooks.length;e<t;e++)a._initHooks[e].call(this)}},t},a.include=function(e){return r.extend(this.prototype,e),this},a.mergeOptions=function(e){return r.extend(this.prototype.options,e),this},a.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),i="function"==typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={scale:1,horizontalOrigin:r.default.HorizontalOrigin.CENTER,verticalOrigin:r.default.VerticalOrigin.BOTTOM});for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"font_style":case"font_weight":case"font_size":case"font_family":case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":case"background_opacity":case"pixelOffsetY":break;case"text":t.text=a.replace(new RegExp("<br />","gm"),"\n");break;case"color":t.fillColor=new r.default.Color.fromCssColorString(a||"#ffffff").withAlpha(Number(e.opacity||1));break;case"border":t.style=a?r.default.LabelStyle.FILL_AND_OUTLINE:r.default.LabelStyle.FILL;break;case"border_color":t.outlineColor=new r.default.Color.fromCssColorString(a||"#000000").withAlpha(Number(e.opacity||1));break;case"border_width":t.outlineWidth=a;break;case"background":t.showBackground=a;break;case"background_color":t.backgroundColor=new r.default.Color.fromCssColorString(a||"#000000").withAlpha(Number(e.background_opacity||e.opacity||.5));break;case"pixelOffset":t.pixelOffset=new r.default.Cartesian2(e.pixelOffset[0],e.pixelOffset[1]);break;case"hasPixelOffset":a||(t.pixelOffset=new r.default.Cartesian2(0,0));break;case"pixelOffsetX":t.pixelOffset=new r.default.Cartesian2(a,e.pixelOffsetY);break;case"scaleByDistance":t.scaleByDistance=a?new r.default.NearFarScalar(Number(e.scaleByDistance_near||1e3),Number(e.scaleByDistance_nearValue||1),Number(e.scaleByDistance_far||1e6),Number(e.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=a?new r.default.DistanceDisplayCondition(Number(e.distanceDisplayCondition_near||0),Number(e.distanceDisplayCondition_far||1e5)):null;break;case"heightReference":switch(a){case"NONE":t.heightReference=r.default.HeightReference.NONE;break;case"CLAMP_TO_GROUND":t.heightReference=r.default.HeightReference.CLAMP_TO_GROUND;break;case"RELATIVE_TO_GROUND":t.heightReference=r.default.HeightReference.RELATIVE_TO_GROUND;break;default:t.heightReference=a}break;case"visibleDepth":t.disableDepthTestDistance=a?0:Number.POSITIVE_INFINITY}}var n=(e.font_style||"normal")+" small-caps "+(e.font_weight||"normal")+" "+(e.font_size||"25")+"px "+(e.font_family||"楷体");return t.font=n,t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){return[e.position.getValue()]}function l(e){var t=s(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditPolyline=void 0;var a,n=i(0),c=(a=n)&&a.__esModule?a:{default:a},d=o(i(6)),h=i(3),r=i(18),f=(o(i(2)),i(1));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.EditPolyline=r.EditBase.extend({_positions_draw:[],getPosition:function(){return this._positions_draw},setPositions:function(e){this._positions_draw=e,this.updateAttrForEditing()},changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw||this.entity.polyline.positions.getValue()},finish:function(){this.entity._positions_draw=this.getPosition()},isClampToGround:function(){return this.entity.attribute.style.clampToGround},bindDraggers:function(){for(var a=this,n=this.isClampToGround(),r=this.getPosition(),o=r.length<this._maxPointNum,e=0,t=r.length;e<t;e++){var i=r[e];if(n&&(i=(0,f.updateHeightForClampToGround)(this.viewer,i),r[e]=i),(l=d.createDragger(this.dataSource,{position:i,onDrag:function(e,t){if(r[e.index]=t,o){if(0<e.index){var i=c.default.Cartesian3.midpoint(t,r[e.index-1],new c.default.Cartesian3);n&&(i=(0,f.updateHeightForClampToGround)(a.viewer,i)),a.draggers[2*e.index-1].position=i}if(e.index<r.length-1){i=c.default.Cartesian3.midpoint(t,r[e.index+1],new c.default.Cartesian3);n&&(i=(0,f.updateHeightForClampToGround)(a.viewer,i)),a.draggers[2*e.index+1].position=i}}}})).index=e,this.draggers.push(l),o){var s=e+1;if(s<t){var l,u=c.default.Cartesian3.midpoint(i,r[s],new c.default.Cartesian3);n&&(u=(0,f.updateHeightForClampToGround)(this.viewer,u)),(l=d.createDragger(this.dataSource,{position:u,type:d.PointType.AddMidPoint,tooltip:h.message.dragger.addMidPoint,onDragStart:function(e,t){r.splice(e.index,0,t)},onDrag:function(e,t){r[e.index]=t},onDragEnd:function(e,t){a.updateDraggers()}})).index=s,this.draggers.push(l)}}}}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={scale:1,horizontalOrigin:r.default.HorizontalOrigin.CENTER,verticalOrigin:r.default.VerticalOrigin.BOTTOM});for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":break;case"opacity":t.color=new r.default.Color.fromCssColorString("#FFFFFF").withAlpha(Number(a||1));break;case"rotation":t.rotation=r.default.Math.toRadians(a);break;case"scaleByDistance":t.scaleByDistance=a?new r.default.NearFarScalar(Number(e.scaleByDistance_near||1e3),Number(e.scaleByDistance_nearValue||1),Number(e.scaleByDistance_far||1e6),Number(e.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=a?new r.default.DistanceDisplayCondition(Number(e.distanceDisplayCondition_near||0),Number(e.distanceDisplayCondition_far||1e5)):null;break;case"heightReference":switch(a){case"NONE":t.heightReference=r.default.HeightReference.NONE;break;case"CLAMP_TO_GROUND":t.heightReference=r.default.HeightReference.CLAMP_TO_GROUND;break;case"RELATIVE_TO_GROUND":t.heightReference=r.default.HeightReference.RELATIVE_TO_GROUND;break;default:t.heightReference=a}break;case"visibleDepth":t.disableDepthTestDistance=a?0:Number.POSITIVE_INFINITY}}return t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){return[e.position.getValue()]}function l(e){var t=s(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={fill:!0,classificationType:r.default.ClassificationType.BOTH});for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"opacity":case"outlineOpacity":break;case"color":t.material=new r.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(Number(e.opacity||1));break;case"outlineColor":t.outlineColor=new r.default.Color.fromCssColorString(a||e.color||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"extrudedHeight":var n=0;t.hierarchy&&(n=(0,s.getMaxHeight)(t.hierarchy.getValue?t.hierarchy.getValue():t.hierarchy)),t.extrudedHeight=Number(a)+n;break;case"clampToGround":t.perPositionHeight=!a}}null==e.color&&(t.material=r.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=l,t.getCoordinates=u,t.toGeoJSON=function(e){var t=u(e);0<t.length&&t.push(t[0]);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Polygon",coordinates:[t]}}};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2)),s=i(1);function l(e){var t=e.polygon.hierarchy.getValue();return t.positions&&o.isArray(t.positions)?t.positions:t}function u(e){var t=l(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Draw=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(49),s=i(3),f=M(i(4)),p=M(i(2)),l=M(i(7)),u=i(17),c=i(51),d=i(52),h=i(53),m=i(8),g=i(54),v=i(56),y=i(58),_=i(61),w=i(62),b=i(64),C=i(66),x=i(68),P=i(70);function M(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}var E=t.Draw=o.Evented.extend({dataSource:null,primitives:null,drawCtrl:null,initialize:function(e,t){this.viewer=e,this.options=t||{},this.dataSource=new r.default.CustomDataSource,this.viewer.dataSources.add(this.dataSource),this.primitives=new r.default.PrimitiveCollection,this.viewer.scene.primitives.add(this.primitives),r.default.defaultValue(this.options.removeScreenSpaceEvent,!0)&&(this.viewer.screenSpaceEventHandler.removeInputAction(r.default.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.viewer.screenSpaceEventHandler.removeInputAction(r.default.ScreenSpaceEventType.LEFT_CLICK)),this.tooltip=new s.Tooltip(this.viewer.container),this.hasEdit(r.default.defaultValue(this.options.hasEdit,!0));var i={viewer:this.viewer,dataSource:this.dataSource,primitives:this.primitives,tooltip:this.tooltip};this.drawCtrl={},this.drawCtrl.point=new u.DrawPoint(i),this.drawCtrl.billboard=new c.DrawBillboard(i),this.drawCtrl.label=new d.DrawLabel(i),this.drawCtrl.model=new h.DrawModel(i),this.drawCtrl.polyline=new m.DrawPolyline(i),this.drawCtrl.curve=new g.DrawCurve(i),this.drawCtrl.polylineVolume=new v.DrawPolylineVolume(i),this.drawCtrl.corridor=new y.DrawCorridor(i),this.drawCtrl.polygon=new _.DrawPolygon(i),this.drawCtrl.rectangle=new w.DrawRectangle(i),this.drawCtrl.ellipse=new b.DrawCircle(i),this.drawCtrl.circle=this.drawCtrl.ellipse,this.drawCtrl.ellipsoid=new C.DrawEllipsoid(i),this.drawCtrl.wall=new x.DrawWall(i),this.drawCtrl["model-p"]=new P.DrawPModel(i);var a=this;for(var n in this.drawCtrl)this.drawCtrl[n]._fire=function(e,t,i){a.fire(e,t,i)};this.on(l.DrawCreated,function(e){this.startEditing(e.entity)},this)},startDraw:function(e){if("string"==typeof e)e={type:e};else if(null==e||null==e.type)return void console.error("需要传入指定绘制的type类型！");var t=e.type;if(null!=this.drawCtrl[t]){var i;e.success&&(i=e.success,delete e.success),e=p.addGeoJsonDefVal(e),this.stopDraw();var a=this.drawCtrl[t].activate(e,i);return this.bindDeleteContextmenu(a),a}console.error("不能进行type为【"+t+"】的绘制，无该类型！")},stopDraw:function(){for(var e in this.stopEditing(),this.drawCtrl)this.drawCtrl[e].disable(!0)},clearDraw:function(){this.stopDraw(),this.dataSource.entities.removeAll(),this.primitives.removeAll()},currEditFeature:null,getCurrentEntity:function(){return this.currEditFeature},_hasEdit:null,hasEdit:function(e){null!==this._hasEdit&&this._hasEdit===e||((this._hasEdit=e)?this.bindSelectEvent():(this.stopEditing(),this.destroySelectEvent()))},bindSelectEvent:function(){var n=this,e=new r.default.ScreenSpaceEventHandler(this.viewer.scene.canvas);e.setInputAction(function(e){var t=n.viewer.scene.pick(e.position);if(r.default.defined(t)){var i=t.id||t.primitive.id||t.primitive;if(i&&n.isMyEntity(i)){if(n.currEditFeature&&n.currEditFeature===i)return;if(!r.default.defaultValue(i.inProgress,!1))return void n.startEditing(i)}}n.stopEditing()},r.default.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(e){if(n._hasEdit){n.tooltip.setVisible(!1);var t=n.viewer.scene.pick(e.endPosition);if(r.default.defined(t)){var i=t.id||t.primitive.id||t.primitive;if(i&&i.editing&&!r.default.defaultValue(i.inProgress,!1)&&n.isMyEntity(i)){var a=n.tooltip;setTimeout(function(){a.showAt(e.endPosition,s.message.edit.start)},100)}}}},r.default.ScreenSpaceEventType.MOUSE_MOVE),this.selectHandler=e},destroySelectEvent:function(){this.selectHandler&&this.selectHandler.destroy(),this.selectHandler=void 0},startEditing:function(e){this.stopEditing(),null!=e&&this._hasEdit&&(e.editing&&e.editing.activate&&e.editing.activate(),this.currEditFeature=e)},stopEditing:function(){this.currEditFeature&&this.currEditFeature.editing&&this.currEditFeature.editing.disable&&this.currEditFeature.editing.disable(),this.currEditFeature=null},updateAttribute:function(e,t){if(null==t&&(t=this.currEditFeature),null!=t&&null!=e){e.style=e.style||{},e.attr=e.attr||{};var i=t.attribute.type;if(this.drawCtrl[i].style2Entity(e.style,t),t.attribute=e,t.editing&&(t.editing.updateAttrForEditing&&t.editing.updateAttrForEditing(),t.editing.updateDraggers&&t.editing.updateDraggers()),this.options.nameTooltip){var a=this;t.attribute.attr&&t.attribute.attr.name?t.tooltip={html:t.attribute.attr.name,check:function(){return!a._hasEdit}}:t.tooltip=null}return t}},setPositions:function(e,t){if(null==t&&(t=this.currEditFeature),null!=t&&null!=e)return t.editing&&(t.editing.setPositions(e),t.editing.updateDraggers()),t},bindDeleteContextmenu:function(e){var i=this;e.contextmenuItems=[{text:"删除对象",iconCls:"fa fa-trash-o",visible:function(){return i._hasEdit},calback:function(e){var t=e.target;t.editing&&t.editing.disable&&t.editing.disable(),i.deleteEntity(t)}}]},deleteEntity:function(e){null==e&&(e=this.currEditFeature),null!=e&&(e.editing&&e.editing.disable(),this.dataSource.entities.contains(e)&&this.dataSource.entities.remove(e),this.primitives.contains(e)&&this.primitives.remove(e))},isMyEntity:function(e){return!!this.dataSource.entities.contains(e)||!!this.primitives.contains(e)},deleteAll:function(){this.clearDraw()},toGeoJSON:function(e){if(this.stopDraw(),null==e){var t=this.getEntitys();if(0==t.length)return null;for(var i=[],a=0,n=t.length;a<n;a++){if(null!=(e=t[a]).attribute&&null!=e.attribute.type){var r=e.attribute.type;null!=(o=this.drawCtrl[r].toGeoJSON(e))&&(o=p.removeGeoJsonDefVal(o),i.push(o))}}return 0<i.length?{type:"FeatureCollection",features:i}:null}r=e.attribute.type;var o=this.drawCtrl[r].toGeoJSON(e);return o=p.removeGeoJsonDefVal(o)},jsonToEntity:function(e,t,i,a){a=a||0;var n=e;try{f.isString(e)&&(n=JSON.parse(e))}catch(e){return void f.alert(e.name+": "+e.message+" \n请确认json文件格式正确!!!")}t&&this.clearDraw();for(var r=[],o=n.features?n.features:[n],s=0,l=o.length;s<l;s++){var u=o[s];if(!u.properties||!u.properties.type)switch(u.properties=u.properties||{},u.geometry.type){case"MultiPolygon":case"Polygon":u.properties.type="polygon";break;case"MultiLineString":case"LineString":u.properties.type="polyline";break;case"MultiPoint":case"Point":u.properties.type="point"}var c=u.properties.type;if(null!=this.drawCtrl[c]){u.properties.style=u.properties.style||{},u.properties=p.addGeoJsonDefVal(u.properties);var d=this.drawCtrl[c].jsonToEntity(u);if(this.bindDeleteContextmenu(d),this.options.nameTooltip)if(d.attribute.attr&&d.attribute.attr.name){var h=this;d.tooltip={html:d.attribute.attr.name,check:function(){return!h._hasEdit}}}else d.tooltip=null;r.push(d)}else console.log("数据无法识别或者数据的["+c+"]类型参数有误")}return i&&(0<a?this.viewer.flyTo(r,{duration:a}):this.viewer.flyTo(r)),r},attributeToEntity:function(e,t){return this.drawCtrl[e.type].attributeToEntity(e,t)},bindExtraEntity:function(e,t){e=this.drawCtrl[t.type].attributeToEntity(e,t);this.dataSource.entities.add(e)},_visible:!0,setVisible:function(e){(this._visible=e)?(this.viewer.dataSources.contains(this.dataSource)||this.viewer.dataSources.add(this.dataSource),this.viewer.scene.primitives.contains(this.primitives)||this.viewer.scene.primitives.add(this.primitives)):(this.stopDraw(),this.viewer.dataSources.contains(this.dataSource)&&this.viewer.dataSources.remove(this.dataSource,!1),this.viewer.scene.primitives.contains(this.dataSource)&&this.viewer.scene.primitives.remove(this.primitives))},hasDraw:function(){return 0<this.getEntitys().length},getEntitys:function(){this.stopDraw();var e=this.dataSource.entities.values;return e=e.concat(this.primitives._primitives)},getDataSource:function(){return this.dataSource},getEntityById:function(e){for(var t=this.getEntitys(),i=0,a=t.length;i<a;i++){var n=t[i];if(e==n.attribute.attr.id)return n}return null},getCoordinates:function(e){var t=e.attribute.type;return this.drawCtrl[t].getCoordinates(e)},getPositions:function(e){var t=e.attribute.type;return this.drawCtrl[t].getPositions(e)},destroy:function(){this.stopDraw(),this.hasEdit(!1),this.clearDraw(),this.viewer.dataSources.contains(this.dataSource)&&this.viewer.dataSources.remove(this.dataSource,!0)}});E.Point=u.DrawPoint,E.Billboard=c.DrawBillboard,E.Label=d.DrawLabel,E.Model=h.DrawModel,E.Polyline=m.DrawPolyline,E.Curve=g.DrawCurve,E.PolylineVolume=v.DrawPolylineVolume,E.Polygon=_.DrawPolygon,E.Rectangle=w.DrawRectangle,E.Circle=b.DrawCircle,E.Ellipsoid=C.DrawEllipsoid,E.Wall=x.DrawWall},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawPoint=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(21),s=i(1),l=h(i(23)),u=i(3),c=h(i(7)),d=i(50);function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawPoint=o.DrawBase.extend({type:"point",createFeature:function(e){this._positions_draw=null;var t=this,i={show:!1,position:new r.default.CallbackProperty(function(e){return t.getDrawPosition()},!1),point:l.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return l.style2Entity(e,t.point)},bindEvent:function(){var i=this;this.getHandler().setInputAction(function(e){var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.endPosition,i.entity);t&&(i._positions_draw=t),i.tooltip.showAt(e.endPosition,u.message.draw.point.start),i.fire(c.DrawMouseMove,{drawtype:i.type,entity:i.entity,position:t})},r.default.ScreenSpaceEventType.MOUSE_MOVE),this.getHandler().setInputAction(function(e){var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.position,i.entity);t&&(i._positions_draw=t,i.disable())},r.default.ScreenSpaceEventType.LEFT_CLICK)},getEditClass:function(e){var t=new d.EditPoint(e,this.viewer,this.dataSource);return this._bindEdit(t)},getAttrClass:function(){return l},finish:function(){this.entity.show=!0,this.entity.editing=this.getEditClass(this.entity),this.entity.position=this.getDrawPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditBase=void 0;var a,n=i(0),m=(a=n)&&a.__esModule?a:{default:a},r=i(11),o=l(i(7)),g=l(i(6)),v=i(3),s=l(i(2)),y=i(1);function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.EditBase=r.Class.extend({_dataSource:null,_minPointNum:1,_maxPointNum:9999,initialize:function(e,t,i){this.entity=e,this.viewer=t,this.dataSource=i,this.draggers=[]},fire:function(e,t,i){this._fire&&this._fire(e,t,i)},formatNum:function(e,t){return s.formatNum(e,t)},setCursor:function(e){this.viewer._container.style.cursor=e?"crosshair":""},activate:function(){return this._enabled||(this._enabled=!0,this.entity.inProgress=!0,this.changePositionsToCallback(),this.bindDraggers(),this.bindEvent(),this.fire(o.EditStart,{edittype:this.entity.attribute.type,entity:this.entity})),this},disable:function(){return this._enabled&&(this._enabled=!1,this.destroyEvent(),this.destroyDraggers(),this.finish(),this.entity.inProgress=!1,this.fire(o.EditStop,{edittype:this.entity.attribute.type,entity:this.entity}),this.tooltip.setVisible(!1)),this},changePositionsToCallback:function(){},finish:function(){},bindEvent:function(){var d=this,h=new m.default.BoundingSphere,f=new m.default.Cartesian3,p=new m.default.ScreenSpaceEventHandler(this.viewer.canvas);p.dragger=null,p.setInputAction(function(e){var t=d.viewer.scene.pick(e.position);if(m.default.defined(t)){var i=t.id||t.primitive.id||t.primitive;if(i&&m.default.defaultValue(i._isDragger,!1)&&(d.viewer.scene.screenSpaceCameraController.enableRotate=!1,d.viewer.scene.screenSpaceCameraController.enableTilt=!1,d.viewer.scene.screenSpaceCameraController.enableTranslate=!1,d.viewer.scene.screenSpaceCameraController.enableInputs=!1,d.viewer.hchx&&d.viewer.hchx.popup.close(i),p.dragger=i,p.dragger.point&&(p.dragger.show=!1),d.setCursor(!0),p.dragger.onDragStart)){var a=p.dragger.position;a&&a.getValue&&(a=a.getValue()),p.dragger.onDragStart(p.dragger,a)}}},m.default.ScreenSpaceEventType.LEFT_DOWN),p.setInputAction(function(e){var t=p.dragger;if(t)switch(t._pointType){case g.PointType.MoveHeight:var i=e.endPosition.y-e.startPosition.y,a=t.position;a&&a.getValue&&(a=a.getValue());var n=new m.default.EllipsoidTangentPlane(a);h.center=a,h.radius=1;var r=1.5*d.viewer.scene.frameState.camera.getPixelSize(h,d.viewer.scene.frameState.context.drawingBufferWidth,d.viewer.scene.frameState.context.drawingBufferHeight);m.default.Cartesian3.multiplyByScalar(n.zAxis,-i*r,f);var o=m.default.Cartesian3.clone(a);m.default.Cartesian3.add(a,f,o),t.position=o,t.onDrag&&t.onDrag(t,o,a),d.updateAttrForEditing();break;default:d.tooltip.showAt(e.endPosition,v.message.edit.end);var s=(0,y.getCurrentMousePosition)(d.viewer.scene,e.endPosition,d.entity);s&&(t.position=s,t.onDrag&&t.onDrag(t,s),d.updateAttrForEditing())}else{d.tooltip.setVisible(!1);var l=d.viewer.scene.pick(e.endPosition);if(m.default.defined(l)){var u=l.id;if(u&&m.default.defaultValue(u._isDragger,!1)&&u.draw_tooltip){var c=u.draw_tooltip;g.PointType.Control==u._pointType&&d._positions_draw&&d._positions_draw.length&&d._positions_draw.length>d._minPointNum&&(c+=v.message.del.def),d.tooltip.showAt(e.endPosition,c)}}}},m.default.ScreenSpaceEventType.MOUSE_MOVE),p.setInputAction(function(e){var t=p.dragger;if(t){d.setCursor(!1),t.show=!0;var i=t.position;i&&i.getValue&&(i=i.getValue()),t.onDragEnd&&t.onDragEnd(t,i),d.fire(o.EditMovePoint,{edittype:d.entity.attribute.type,entity:d.entity,position:i}),p.dragger=null,d.viewer.scene.screenSpaceCameraController.enableRotate=!0,d.viewer.scene.screenSpaceCameraController.enableTilt=!0,d.viewer.scene.screenSpaceCameraController.enableTranslate=!0,d.viewer.scene.screenSpaceCameraController.enableInputs=!0}},m.default.ScreenSpaceEventType.LEFT_UP),p.setInputAction(function(e){var t=d.viewer.scene.pick(e.position);if(m.default.defined(t)){var i=t.id;if(i&&m.default.defaultValue(i._isDragger,!1)&&g.PointType.Control==i._pointType)d.deletePointForDragger(i,e.position)&&d.fire(o.EditRemovePoint,{edittype:d.entity.attribute.type,entity:d.entity})}},m.default.ScreenSpaceEventType.RIGHT_CLICK),this.draggerHandler=p},destroyEvent:function(){this.viewer.scene.screenSpaceCameraController.enableRotate=!0,this.viewer.scene.screenSpaceCameraController.enableTilt=!0,this.viewer.scene.screenSpaceCameraController.enableTranslate=!0,this.viewer.scene.screenSpaceCameraController.enableInputs=!0,this.setCursor(!1),this.draggerHandler&&(this.draggerHandler.dragger&&(this.draggerHandler.dragger.show=!0),this.draggerHandler.destroy(),this.draggerHandler=null)},bindDraggers:function(){},updateDraggers:function(){if(!this._enabled)return this;this.destroyDraggers(),this.bindDraggers()},destroyDraggers:function(){for(var e=0,t=this.draggers.length;e<t;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},deletePointForDragger:function(e,t){if(this._positions_draw.length-1<this._minPointNum)return this.tooltip.showAt(t,v.message.del.min+this._minPointNum),!1;var i=e.index;return 0<i&&i<this._positions_draw.length&&(this._positions_draw.splice(i,1),this.updateDraggers(),!0)},updateAttrForEditing:function(){}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bd2gcj=a,t.gcj2bd=n,t.wgs2gcj=r,t.gcj2wgs=o,t.bd2wgs=function(e){return o(a(e))},t.wgs2bd=function(e){return n(r(e))},t.jwd2mct=function(e){var t=Number(e[0]),i=Number(e[1]),a=20037508.34*t/180,n=Math.log(Math.tan((90+i)*c/360))/(c/180);return n=20037508.34*n/180,a=Number(a.toFixed(2)),n=Number(n.toFixed(2)),[a,n]},t.mct2jwd=function(e){var t=Number(e[0]),i=Number(e[1]),a=t/20037508.34*180,n=i/20037508.34*180;return n=180/c*(2*Math.atan(Math.exp(n*c/180))-c/2),a=Number(a.toFixed(6)),n=Number(n.toFixed(6)),[a,n]};var s=52.35987755982988,c=3.141592653589793,d=6378245,h=.006693421622965943;function f(e,t){var i=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*c)+20*Math.sin(2*e*c))/3,i+=2*(20*Math.sin(t*c)+40*Math.sin(t/3*c))/3,i+=2*(160*Math.sin(t/12*c)+320*Math.sin(t*c/30))/3}function p(e,t){var i=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*c)+20*Math.sin(2*e*c))/3,i+=2*(20*Math.sin(e*c)+40*Math.sin(e/3*c))/3,i+=2*(150*Math.sin(e/12*c)+300*Math.sin(e/30*c))/3}function m(e,t){return e<72.004||137.8347<e||t<.8293||55.8271<t||!1}function a(e){var t=52.35987755982988,i=Number(e[0])-.0065,a=Number(e[1])-.006,n=Math.sqrt(i*i+a*a)-2e-5*Math.sin(a*t),r=Math.atan2(a,i)-3e-6*Math.cos(i*t),o=n*Math.cos(r),s=n*Math.sin(r);return[o=Number(o.toFixed(6)),s=Number(s.toFixed(6))]}function n(e){var t=Number(e[0]),i=Number(e[1]),a=Math.sqrt(t*t+i*i)+2e-5*Math.sin(i*s),n=Math.atan2(i,t)+3e-6*Math.cos(t*s),r=a*Math.cos(n)+.0065,o=a*Math.sin(n)+.006;return[r=Number(r.toFixed(6)),o=Number(o.toFixed(6))]}function r(e){var t=Number(e[0]),i=Number(e[1]);if(m(t,i))return[t,i];var a=f(t-105,i-35),n=p(t-105,i-35),r=i/180*c,o=Math.sin(r);o=1-h*o*o;var s=Math.sqrt(o),l=i+(a=180*a/(d*(1-h)/(o*s)*c)),u=t+(n=180*n/(d/s*Math.cos(r)*c));return[u=Number(u.toFixed(6)),l=Number(l.toFixed(6))]}function o(e){var t=Number(e[0]),i=Number(e[1]);if(m(t,i))return[t,i];var a=f(t-105,i-35),n=p(t-105,i-35),r=i/180*c,o=Math.sin(r);o=1-h*o*o;var s=Math.sqrt(o);a=180*a/(d*(1-h)/(o*s)*c);var l=2*t-(t+(n=180*n/(d/s*Math.cos(r)*c))),u=2*i-(i+a);return[l=Number(l.toFixed(6)),u=Number(u.toFixed(6))]}},function(e,t,i){"use strict";var a,n=i(0),h=(a=n)&&a.__esModule?a:{default:a},f=i(4),r=i(9),l=i(75),u=i(39),c=i(76),d=i(40),p=i(78),m=i(28),g=i(79),v=i(80),y=i(81),_=i(82),w=i(83),b=i(84),C=i(85),x=i(86);t.BaseLayer=r.BaseLayer,t.GroupLayer=l.GroupLayer,t.TileLayer=u.TileLayer,t.GraticuleLayer=c.GraticuleLayer,t.CustomFeatureGridLayer=d.CustomFeatureGridLayer,t.POILayer=p.POILayer,t.GeoJsonLayer=m.GeoJsonLayer,t.GltfLayer=g.GltfLayer,t.Tiles3dLayer=v.Tiles3dLayer,t.KmlLayer=y.KmlLayer,t.CzmlLayer=_.CzmlLayer,t.TerrainLayer=w.TerrainLayer,t.DrawLayer=b.DrawLayer;var P={};t.regLayerForConfig=function(e,t){P[e]=t},t.createLayer=function e(t,i,a){var n;switch(t.url&&(a&&(t.url=t.url.replace("$serverURL$",a)),t.url=t.url.replace("$hostname$",location.hostname).replace("$host$",location.host)),t.type){case"group":if(t.layers&&0<t.layers.length){for(var r=[],o=0;o<t.layers.length;o++){var s=e(t.layers[o],i,a);null!=s&&r.push(s)}t._layers=r,n=new l.GroupLayer(t,i)}break;case"www_bing":case"www_osm":case"www_google":case"www_gaode":case"www_baidu":case"www_tdt":case"arcgis_cache":case"arcgis":case"arcgis_tile":case"arcgis_dynamic":case"wmts":case"tms":case"wms":case"xyz":case"tile":case"single":case"image":case"gee":case"mapbox":case"custom_tilecoord":case"custom_grid":(n=new u.TileLayer(t,i)).isTile=!0;break;case"www_poi":n=new p.POILayer(t,i);break;case"custom_featuregrid":n=new d.CustomFeatureGridLayer(t,i);break;case"custom_graticule":n=new c.GraticuleLayer(t,i);break;case"3dtiles":n=new v.Tiles3dLayer(t,i);break;case"gltf":n=new g.GltfLayer(t,i);break;case"geojson":n=new m.GeoJsonLayer(t,i);break;case"geojson-draw":n=new b.DrawLayer(t,i);break;case"kml":n=new y.KmlLayer(t,i);break;case"czml":n=new _.CzmlLayer(t,i);break;case"terrain":n=new w.TerrainLayer(t,i);break;default:if(P[t.type]&&(n=new P[t.type](t,i)),null==n)try{console.log("配置中的图层未处理："+JSON.stringify(t))}catch(e){}}return null!==n&&(t._layer=n),n},t.createImageryProvider=function(e,t){e.url&&(t&&(e.url=e.url.replace("$serverURL$",t)),e.url=e.url.replace("$hostname$",location.hostname).replace("$host$",location.host));var i,a={};for(var n in e){var r=e[n];if(null!=r)switch(n){default:a[n]=r;break;case"crs":"4326"==r||"EPSG4326"==r.toUpperCase()||"EPSG:4326"==r.toUpperCase()?a.tilingScheme=new h.default.GeographicTilingScheme({numberOfLevelZeroTilesX:e.numberOfLevelZeroTilesX||2,numberOfLevelZeroTilesY:e.numberOfLevelZeroTilesY||1}):a.tilingScheme=new h.default.WebMercatorTilingScheme({numberOfLevelZeroTilesX:e.numberOfLevelZeroTilesX||1,numberOfLevelZeroTilesY:e.numberOfLevelZeroTilesY||1});break;case"rectangle":a.rectangle=h.default.Rectangle.fromDegrees(r.xmin,r.ymin,r.xmax,r.ymax)}}switch(a.url&&a.proxy&&(a=(0,f.getProxyUrl)(a)),a.type_new||a.type){case"single":case"image":i=new h.default.SingleTileImageryProvider(a);break;case"xyz":case"tile":a.customTags={"z&1":function(e,t,i,a){return a+1}},i=new h.default.UrlTemplateImageryProvider(a);break;case"wms":i=new h.default.WebMapServiceImageryProvider(a);break;case"tms":a.url||(a.url=h.default.buildModuleUrl("Assets/Textures/NaturalEarthII")),i=new h.default.createTileMapServiceImageryProvider(a);break;case"wmts":i=new h.default.WebMapTileServiceImageryProvider(a);break;case"gee":i=new h.default.GoogleEarthEnterpriseImageryProvider({metadata:new h.default.GoogleEarthEnterpriseMetadata(a)});break;case"mapbox":i=new h.default.MapboxImageryProvider(a);break;case"arcgis":case"arcgis_tile":case"arcgis_dynamic":i=new h.default.ArcGisMapServerImageryProvider(a);break;case"arcgis_cache":h.default.UrlTemplateImageryProvider.prototype.padLeft0||(h.default.UrlTemplateImageryProvider.prototype.padLeft0=function(e,t){for(var i=(e=String(e)).length;i<t;)e="0"+e,i++;return e}),a.customTags={arc_x:function(e,t,i,a){return e.padLeft0(t.toString(16),8)},arc_y:function(e,t,i,a){return e.padLeft0(i.toString(16),8)},arc_z:function(e,t,i,a){return e.padLeft0(a.toString(),2)},arc_X:function(e,t,i,a){return e.padLeft0(t.toString(16),8).toUpperCase()},arc_Y:function(e,t,i,a){return e.padLeft0(i.toString(16),8).toUpperCase()},arc_Z:function(e,t,i,a){return e.padLeft0(a.toString(),2).toUpperCase()}},i=new h.default.UrlTemplateImageryProvider(a);break;case"www_tdt":var o,s;switch(a.layer){default:case"vec_d":o="vec";break;case"vec_z":o="cva";break;case"img_d":o="img";break;case"img_z":o="cia";break;case"ter_d":o="ter";break;case"ter_z":o="cta"}s=null==a.key||0==a.key.length?"87949882c75775b5069a0076357b7530":function(e){var t=Math.floor(Math.random()*e.length+1)-1;return e[t]}(a.key);if("4326"==e.crs){for(var l=new Array(18),u=0;u<=18;u++)l[u]=(u+1).toString();var c="http://t{s}.tianditu.gov.cn/"+o+"_c/wmts?service=WMTS&version=1.0.0&request=GetTile&tilematrix={TileMatrix}&layer="+o+"&style={style}&tilerow={TileRow}&tilecol={TileCol}&tilematrixset={TileMatrixSet}&format=tiles&tk="+s;i=new h.default.WebMapTileServiceImageryProvider({url:a.proxy?new h.default.Resource({url:c,proxy:a.proxy}):c,layer:o,style:"default",format:"tiles",tileMatrixSetID:"c",subdomains:["0","1","2","3","4","5","6","7"],tileMatrixLabels:l,tilingScheme:new h.default.GeographicTilingScheme,maximumLevel:18})}else{for(l=new Array(18),u=0;u<=18;u++)l[u]=u.toString();c="http://t{s}.tianditu.gov.cn/"+o+"_w/wmts?service=WMTS&version=1.0.0&request=GetTile&tilematrix={TileMatrix}&layer="+o+"&style={style}&tilerow={TileRow}&tilecol={TileCol}&tilematrixset={TileMatrixSet}&format=tiles&tk="+s;i=new h.default.WebMapTileServiceImageryProvider({url:a.proxy?new h.default.Resource({url:c.replace("{s}","0"),proxy:a.proxy}):c,layer:o,style:"default",format:"tiles",tileMatrixSetID:"w",subdomains:["0","1","2","3","4","5","6","7"],tileMatrixLabels:l,tilingScheme:new h.default.WebMercatorTilingScheme,maximumLevel:18})}break;case"www_gaode":switch(a.layer){case"vec":default:c="http://"+(a.bigfont?"wprd":"webrd")+"0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}";break;case"img_d":c="http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}";break;case"img_z":c="http://webst0{s}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8";break;case"time":c="http://tm.amap.com/trafficengine/mapabc/traffictile?v=1.0&;t=1&x={x}&y={y}&z={z}&&t="+(new Date).getTime()}i=new h.default.UrlTemplateImageryProvider({url:a.proxy?new h.default.Resource({url:c,proxy:a.proxy}):c,subdomains:["1","2","3","4"],maximumLevel:18});break;case"www_baidu":i=new C.BaiduImageryProvider(a);break;case"www_google":if("4326"==e.crs||"wgs84"==e.crs)switch(a.layer){default:case"img_d":c="http://www.google.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}"}else switch(a.layer){case"vec":default:c="http://mt{s}.google.cn/vt/lyrs=m@207000000&hl=zh-CN&gl=CN&src=app&x={x}&y={y}&z={z}&s=Galile";break;case"img_d":c="http://mt{s}.google.cn/vt/lyrs=s&hl=zh-CN&gl=CN&x={x}&y={y}&z={z}&s=Gali";break;case"img_z":c="http://mt{s}.google.cn/vt/imgtp=png32&lyrs=h@207000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galil";break;case"ter":c="http://mt{s}.google.cn/vt/lyrs=t@131,r@227000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galile"}i=new h.default.UrlTemplateImageryProvider({url:a.proxy?new h.default.Resource({url:c,proxy:a.proxy}):c,subdomains:["1","2","3"],maximumLevel:20});break;case"www_osm":c="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";i=new h.default.UrlTemplateImageryProvider({url:a.proxy?new h.default.Resource({url:c,proxy:a.proxy}):c,subdomains:"abc",maximumLevel:18});break;case"www_bing":c="https://dev.virtualearth.net";var d=a.layer||h.default.BingMapsStyle.Aerial;i=new h.default.BingMapsImageryProvider({url:a.proxy?new h.default.Resource({url:c,proxy:a.proxy}):c,key:a.key||"AtkX3zhnRe5fyGuLU30uZw8r3sxdBDnpQly7KfFTCB2rGlDgXBG3yr-qEiQEicEc",mapStyle:d});break;case"custom_grid":a.cells=a.cells||2,a.color=h.default.Color.fromCssColorString(a.color||"rgba(255,255,255,0.5)"),a.glowWidth=a.glowWidth||3,a.glowColor=h.default.Color.fromCssColorString(a.glowColor||"rgba(255,255,255,0.1)"),a.backgroundColor=h.default.Color.fromCssColorString(a.backgroundColor||"rgba(0,0,0,0)"),i=new h.default.GridImageryProvider(a);break;case"custom_tilecoord":i=new h.default.TileCoordinatesImageryProvider(a);break;case"custom_featuregrid":i=new x.FeatureGridImageryProvider(a);break;default:console.log("config配置图层未处理:"+e)}return i.config=a,i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawBase=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=(i(1),i(11)),s=u(i(2)),l=u(i(7));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawBase=o.Class.extend({type:null,dataSource:null,initialize:function(e){this.viewer=e.viewer,this.dataSource=e.dataSource,this.primitives=e.primitives,this.dataSource||(this.dataSource=new r.default.CustomDataSource,this.viewer.dataSources.add(this.dataSource)),this.tooltip=e.tooltip||new Tooltip(this.viewer.container)},fire:function(e,t,i){this._fire&&this._fire(e,t,i)},formatNum:function(e,t){return s.formatNum(e,t)},activate:function(e,t){return this._enabled?this:(this._enabled=!0,this.drawOkCalback=t,this.createFeature(e),this.entity.inProgress=!0,this.setCursor(!0),this.bindEvent(),this.fire(l.DrawStart,{drawtype:this.type,entity:this.entity}),this.entity)},disable:function(e){return this._enabled&&(this._enabled=!1,this.setCursor(!1),e&&this.entity.inProgress?(this.dataSource&&this.dataSource.entities.contains(this.entity)&&this.dataSource.entities.remove(this.entity),this.primitives&&this.primitives.contains(this.entity)&&this.primitives.remove(this.entity)):(this.entity.inProgress=!1,this.finish(),this.drawOkCalback&&(this.drawOkCalback(this.entity),delete this.drawOkCalback),this.fire(l.DrawCreated,{drawtype:this.type,entity:this.entity})),this.destroyHandler(),this._positions_draw=null,this.entity=null,this.tooltip.setVisible(!1)),this},createFeature:function(e){},getHandler:function(){return this.handler&&!this.handler.isDestroyed()||(this.handler=new r.default.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.handler},destroyHandler:function(){this.handler&&this.handler.destroy(),this.handler=void 0},setCursor:function(e){this.viewer._container.style.cursor=e?"crosshair":""},bindEvent:function(){},_positions_draw:null,getDrawPosition:function(){return this._positions_draw},_bindEdit:function(e){return e._fire=this._fire,e.tooltip=this.tooltip,e},updateAttrForDrawing:function(){},finish:function(){},getCoordinates:function(e){return this.getAttrClass().getCoordinates(e)},getPositions:function(e){return this.getAttrClass().getPositions(e)},toGeoJSON:function(e){return this.getAttrClass().toGeoJSON(e)},attributeToEntity:function(e,t){var i=this.createFeature(e);return this._positions_draw=t,this.updateAttrForDrawing(!0),this.finish(),i},jsonToEntity:function(e){var t=e.properties,i=s.getPositionByGeoJSON(e);return this.attributeToEntity(t,i)},bindExtraEntity:function(e,t){return t&&t.style&&this.style2Entity(t.style,e),this._positions_draw=this.getPositions(e),this.updateAttrForDrawing(!0),this.finish(),e}})},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_22__},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={});for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"opacity":case"outlineOpacity":case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":break;case"outlineColor":t.outlineColor=new r.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"color":t.color=new r.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(Number(e.opacity||1));break;case"scaleByDistance":t.scaleByDistance=a?new r.default.NearFarScalar(Number(e.scaleByDistance_near||1e3),Number(e.scaleByDistance_nearValue||1),Number(e.scaleByDistance_far||1e6),Number(e.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=a?new r.default.DistanceDisplayCondition(Number(e.distanceDisplayCondition_near||0),Number(e.distanceDisplayCondition_far||1e5)):null;break;case"heightReference":switch(a){case"NONE":t.heightReference=r.default.HeightReference.NONE;break;case"CLAMP_TO_GROUND":t.heightReference=r.default.HeightReference.CLAMP_TO_GROUND;break;case"RELATIVE_TO_GROUND":t.heightReference=r.default.HeightReference.RELATIVE_TO_GROUND;break;default:t.heightReference=a}break;case"visibleDepth":t.disableDepthTestDistance=a?0:Number.POSITIVE_INFINITY}}e.outline||(t.outlineWidth=0);return t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){return[e.position.getValue()]}function l(e){var t=s(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={});for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"silhouette":case"silhouetteColor":case"silhouetteAlpha":case"silhouetteSize":case"fill":case"color":case"opacity":break;case"modelUrl":t.uri=a;break;case"heightReference":switch(a){case"NONE":t.heightReference=r.default.HeightReference.NONE;break;case"CLAMP_TO_GROUND":t.heightReference=r.default.HeightReference.CLAMP_TO_GROUND;break;case"RELATIVE_TO_GROUND":t.heightReference=r.default.HeightReference.RELATIVE_TO_GROUND;break;default:t.heightReference=a}}}e.silhouette?(t.silhouetteColor=new r.default.Color.fromCssColorString(e.silhouetteColor||"#FFFFFF").withAlpha(Number(e.silhouetteAlpha||1)),t.silhouetteSize=Number(e.silhouetteSize||1)):t.silhouetteSize=0;var n=e.hasOwnProperty("opacity")?Number(e.opacity):1;e.fill?t.color=new r.default.Color.fromCssColorString(e.color||"#FFFFFF").withAlpha(n):t.color=new r.default.Color.fromCssColorString("#FFFFFF").withAlpha(n);return t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){var t=e.position;return t&&t.getValue&&(t=t.getValue()),[t]}function l(e){var t=s(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineFlowMaterial=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r};var l=new s.default.Color(0,0,0,0),u=t.LineFlowMaterial=(a(c,[{key:"getType",value:function(e){return this._materialType}},{key:"getValue",value:function(e,t){return s.default.defined(t)||(t={}),t.color=s.default.Property.getValueOrClonedDefault(this._color,e,l,t.color),t.image=this._materialImage,void 0===this._time&&(this._time=(new Date).getTime()),t.time=((new Date).getTime()-this._time)/this._duration,t}},{key:"equals",value:function(e){return this===e||e instanceof c&&s.default.Property.equals(this._color,e._color)}},{key:"isConstant",get:function(){return!1}},{key:"definitionChanged",get:function(){return this._definitionChanged}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),e=s.default.defaultValue(e,s.default.defaultValue.EMPTY_OBJECT),this._definitionChanged=new s.default.Event,this._color=void 0,this._colorSubscription=void 0,this.color=s.default.defaultValue(e.color,l),this._duration=e.duration||1e3;var t=function(e,t,i){var a=h+ ++d+"Type",n=h+d+"Image";return s.default.Material[a]=a,s.default.Material[n]=e,s.default.Material._materialCache.addMaterial(s.default.Material[a],{fabric:{type:s.default.Material.PolylineArrowLinkType,uniforms:{color:new s.default.Color(1,0,0,1),image:s.default.Material[n],time:0,repeat:t||new s.default.Cartesian2(1,1),axisY:i},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                        {\n                            czm_material material = czm_getDefaultMaterial(materialInput);\n                            vec2 st = repeat * materialInput.st;\n                            vec4 colorImage = texture2D(image, vec2(fract((axisY?st.t:st.s) - time), st.t));\n                            if(color.a == 0.0)\n                            {\n                                material.alpha = colorImage.a;\n                                material.diffuse = colorImage.rgb; \n                            }\n                            else\n                            {\n                                material.alpha = colorImage.a * color.a;\n                                material.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb); \n                            }\n                            return material;\n                        }"},translucent:function(){return!0}}),{type:s.default.Material[a],image:s.default.Material[n]}}(e.url,e.repeat,Boolean(e.axisY));this._materialType=t.type,this._materialImage=t.image,this.axisY=Boolean(e.axisY),this._time=void 0}s.default.defineProperties(u.prototype,{color:s.default.createPropertyDescriptor("color")});var d=0,h="AnimationLine"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditPolygon=void 0;var a,n=i(0),d=(a=n)&&a.__esModule?a:{default:a},h=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6)),f=i(3),r=i(13),p=i(1);t.EditPolygon=r.EditPolyline.extend({changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw||this.entity.polygon.hierarchy.getValue()},finish:function(){this.entity._positions_draw=this.getPosition()},isClampToGround:function(){return this.entity.attribute.style.hasOwnProperty("clampToGround")?this.entity.attribute.style.clampToGround:!this.entity.attribute.style.perPositionHeight},bindDraggers:function(){for(var o=this,s=this.getPosition(),l=s.length<this._maxPointNum,u=this.isClampToGround(),e=0,c=s.length;e<c;e++){var t=s[e];u&&(t=(0,p.updateHeightForClampToGround)(this.viewer,t),s[e]=t);var i=h.createDragger(this.dataSource,{position:t,onDrag:function(e,t){if(s[e.index]=t,o.heightDraggers&&0<o.heightDraggers.length){var i=o.entity.polygon.extrudedHeight.getValue();o.heightDraggers[e.index].position=(0,p.setPositionsHeight)(t,i)}if(l){var a,n;n=0==e.index?(a=2*c-1,c-1):(a=2*e.index-1,e.index-1);var r=d.default.Cartesian3.midpoint(t,s[n],new d.default.Cartesian3);u&&(r=(0,p.updateHeightForClampToGround)(o.viewer,r)),o.draggers[a].position=r,n=e.index==c-1?(a=2*e.index+1,0):(a=2*e.index+1,e.index+1);r=d.default.Cartesian3.midpoint(t,s[n],new d.default.Cartesian3);u&&(r=(0,p.updateHeightForClampToGround)(o.viewer,r)),o.draggers[a].position=r}}});if(i.index=e,this.draggers.push(i),l){var a=(e+1)%c,n=d.default.Cartesian3.midpoint(t,s[a],new d.default.Cartesian3);u&&(n=(0,p.updateHeightForClampToGround)(this.viewer,n));var r=h.createDragger(this.dataSource,{position:n,type:h.PointType.AddMidPoint,tooltip:f.message.dragger.addMidPoint,onDragStart:function(e,t){s.splice(e.index,0,t)},onDrag:function(e,t){s[e.index]=t},onDragEnd:function(e,t){o.updateDraggers()}});r.index=a,this.draggers.push(r)}}this.entity.polygon.extrudedHeight&&this.bindHeightDraggers(this.entity.polygon)},heightDraggers:null,bindHeightDraggers:function(n,e){var r=this;this.heightDraggers=[],e=e||this.getPosition();for(var t=n.extrudedHeight.getValue(),i=0,a=e.length;i<a;i++){var o=e[i];o=(0,p.setPositionsHeight)(o,t);var s=h.createDragger(this.dataSource,{position:o,type:h.PointType.MoveHeight,tooltip:f.message.dragger.moveHeight,onDrag:function(e,t){var i=d.default.Cartographic.fromCartesian(t).height;n.extrudedHeight=i;var a=(0,p.getMaxHeight)(r.getPosition());r.entity.attribute.style.extrudedHeight=r.formatNum(i-a,2),r.updateHeightDraggers(i)}});this.draggers.push(s),this.heightDraggers.push(s)}},updateHeightDraggers:function(e){for(var t=0;t<this.heightDraggers.length;t++){var i=this.heightDraggers[t],a=(0,p.setPositionsHeight)(i.position.getValue(),e);i.position.setValue(a)}}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){null==t&&(t={fill:!0});(e=e||{}).clampToGround&&(e.hasOwnProperty("height")&&delete e.height,e.hasOwnProperty("extrudedHeight")&&delete e.extrudedHeight);for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"opacity":case"outlineOpacity":case"color":case"animation":break;case"outlineColor":t.outlineColor=new r.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"rotation":t.rotation=r.default.Math.toRadians(a);break;case"height":t.height=Number(a),e.extrudedHeight&&(t.extrudedHeight=Number(e.extrudedHeight)+Number(a));break;case"extrudedHeight":t.extrudedHeight=Number(t.height||e.height||0)+Number(a);break;case"radius":t.semiMinorAxis=Number(a),t.semiMajorAxis=Number(a)}}e.animation?t.material=new s.CircleWaveMaterial({duration:e.animationDuration||2e3,color:new r.default.Color.fromCssColorString(e.color||"#FFFF00").withAlpha(Number(e.opacity||1)),gradient:e.animationGradient||0,count:e.animationCount||1}):e.color&&(t.material=new r.default.Color.fromCssColorString(e.color||"#FFFF00").withAlpha(Number(e.opacity||1)));null==t.material&&(t.material=r.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=l,t.getCoordinates=u,t.toGeoJSON=function(e){var t=u(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2)),s=i(35);function l(e){return[e.position.getValue()]}function u(e){var t=l(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonLayer=void 0;var c=n(i(0)),d=n(i(5)),h=i(4),f=i(1),a=i(9),p=i(14),m=i(12),g=i(10),v=i(15);function n(e){return e&&e.__esModule?e:{default:e}}var r=a.BaseLayer.extend({dataSource:null,add:function(){this.dataSource?this.viewer.dataSources.add(this.dataSource):this.queryData()},remove:function(){this.viewer.dataSources.remove(this.dataSource)},centerAt:function(e){if(this.config.extent||this.config.center)this.viewer.hchx.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else{if(null==this.dataSource)return;this.viewer.flyTo(this.dataSource.entities.values,{duration:e})}},hasOpacity:!0,_opacity:1,setOpacity:function(e){if(this._opacity=e,null!=this.dataSource)for(var t=this.dataSource.entities.values,i=0,a=t.length;i<a;i++){var n=t[i];if(n.polygon&&n.polygon.material&&n.polygon.material.color&&(this._updatEntityAlpha(n.polygon.material.color,this._opacity),n.polygon.outlineColor&&this._updatEntityAlpha(n.polygon.outlineColor,this._opacity)),n.polyline&&n.polyline.material&&n.polyline.material.color&&this._updatEntityAlpha(n.polyline.material.color,this._opacity),n.billboard&&(n.billboard.color=new c.default.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity)),n.model&&(n.model.color=new c.default.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity)),n.label){var r=this._opacity;n.attribute&&n.attribute.label&&n.attribute.label.opacity&&(r=n.attribute.label.opacity),n.label.fillColor&&this._updatEntityAlpha(n.label.fillColor,r),n.label.outlineColor&&this._updatEntityAlpha(n.label.outlineColor,r),n.label.backgroundColor&&this._updatEntityAlpha(n.label.backgroundColor,r)}}},_updatEntityAlpha:function(e,t){var i=e.getValue();if(!i||!i.withAlpha)return e;i=i.withAlpha(t),e.setValue(i)},queryData:function(){var t=this,e=(0,h.getProxyUrl)(this.config);c.default.GeoJsonDataSource.load(e.url,e).then(function(e){t.showResult(e)}).otherwise(function(e){t.showError("服务出错",e)})},showResult:function(e){var i=this;this.dataSource&&this.viewer.dataSources.remove(this.dataSource),this.dataSource=e,this.viewer.dataSources.add(e),this.config.flyTo&&this.centerAt();for(var t=e.entities.values,a=0,n=t.length;a<n;a++){var r=t[a];this.config.symbol&&("default"==this.config.symbol?this.setDefSymbol(r):this.setConfigSymbol(r,this.config.symbol)),(this.config.columns||this.config.popup)&&(r.popup={html:function(e){var t=i.getEntityAttr(e);return(0,h.isString)(t)?t:i.viewer.hchx.popup.getPopupForConfig(i.config,t)},anchor:this.config.popupAnchor||[0,-15]}),this.config.tooltip&&(r.tooltip={html:function(e){var t=i.getEntityAttr(e);return(0,h.isString)(t)?t:i.viewer.hchx.popup.getPopupForConfig({popup:i.config.tooltip},t)},anchor:this.config.tooltipAnchor||[0,-15]}),this.config.click&&(r.click=this.config.click),this.config.mouseover&&(r.mouseover=this.config.mouseover),this.config.mouseout&&(r.mouseout=this.config.mouseout)}1!=this._opacity&&this.setOpacity(this._opacity)},getEntityAttr:function(e){return e.properties},colorHash:{},setDefSymbol:function(e){var t=this.getEntityAttr(e)||{};if(e.polygon){var i=t.id||t.OBJECTID||0;(a=this.colorHash[i])||(a=c.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[i]=a),e.polygon.material=a,e.polygon.outline=!0,e.polygon.outlineColor=c.default.Color.WHITE}else if(e.polyline){var a;i=t.id||t.OBJECTID||0;(a=this.colorHash[i])||(a=c.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[i]=a),e.polyline.material=a,e.polyline.width=2}else e.billboard&&(e.billboard.scale=.5,e.billboard.horizontalOrigin=c.default.HorizontalOrigin.CENTER,e.billboard.verticalOrigin=c.default.VerticalOrigin.BOTTOM)},setConfigSymbol:function(e,t){var i=this.getEntityAttr(e)||{},a=t.styleOptions;if(t.styleField){var n=i[t.styleField];null!=(r=t.styleFieldOptions[n])&&(a=(0,h.clone)(a),a=d.default.extend(a,r))}if("function"==typeof t.calback){var r;if(!(r=t.calback(i,e,t)))return;a=(0,h.clone)(a),a=d.default.extend(a,r)}if(a=a||{},e.polyline&&(0,g.style2Entity)(a,e.polyline),e.polygon){if((0,v.style2Entity)(a,e.polygon),a.outlineWidth&&1<a.outlineWidth){e.polygon.outline=!1;var o={color:a.outlineColor,width:a.outlineWidth,opacity:a.outlineOpacity,lineType:"solid",clampToGround:!0,outline:!1},s=(0,g.style2Entity)(o);s.positions=e.polygon.hierarchy._value.positions,this.dataSource._entityCollection.add({polyline:s})}if(a.label&&a.label.field&&(a.label.heightReference=a.label.heightReference||c.default.HeightReference.RELATIVE_TO_GROUND,e.position=(0,f.centerOfMass)((0,v.getPositions)(e)),e.label=(0,m.style2Entity)(a.label),e.label.text=i[a.label.field]||""),this.config.buildings){var l=Number(i[this.config.buildings.cloumn]||1),u=Number(this.config.buildings.height||5);e.polygon.extrudedHeight=l*u}}e.label&&(a.heightReference=a.heightReference||c.default.HeightReference.RELATIVE_TO_GROUND,(0,m.style2Entity)(a,e.label)),e.billboard&&(a.heightReference=a.heightReference||c.default.HeightReference.RELATIVE_TO_GROUND,(0,p.style2Entity)(a,e.billboard),a.label&&a.label.field&&(a.label.heightReference=a.label.heightReference||c.default.HeightReference.RELATIVE_TO_GROUND,e.label=(0,m.style2Entity)(a.label),e.label.text=i[a.label.field]||"")),e.attribute=a}});t.GeoJsonLayer=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.init=s,t.getDefWindowOptions=function(){return function e(t,i){if(null==t||"object"!=(void 0===t?"undefined":n(t)))return t;if(t.constructor!=Object&&t.constructor!=Array)return t;if(t.constructor==Date||t.constructor==RegExp||t.constructor==Function||t.constructor==String||t.constructor==Number||t.constructor==Boolean)return new t.constructor(t);i=i||new t.constructor;for(var a in t)i[a]=void 0===i[a]?e(t[a],null):i[a];return i}(c.windowOptions)},t.activate=v,t.getWidget=l,t.getClass=y,t.isActivate=_,t.disable=w,t.disableAll=b,t.disableGroup=C,t.eachWidget=function(e){for(var t=0;t<m.length;t++){var i=m[t];e(i)}},t.bindClass=function(e){{if(null!=x)return x.isloading=!1,x._class=new e(x,f),x._class.activateBase(),x._class;for(var t=function(){for(var e,t=document.scripts,i=t.length-1;0<=i;i--)if(null!=(e=t[i].src)&&""!=e&&-1!=e.indexOf("widgets"))return e;return""}(),i=0;i<m.length;i++){var a=m[i];if(t.endsWith(a.uri))return a.isloading=!1,a._class=new e(a,f),a._class.activateBase(),a._class}}},t.removeDebugeBar=S,t.getCacheVersion=function(){return d},t.getBasePath=function(){return p};var a,r=i(5),u=(a=r)&&a.__esModule?a:{default:a},o=i(30);var c,d,h,f,p="",m=[];function s(e,t,i){f=e,p=i||"",m=[],c=(t=t||{}).defaultOptions||{windowOptions:{position:"rt",maxmin:!1,resize:!0},autoDisable:!0,disableOhter:!0},"time"==(d=t.version)&&(d=(new Date).getTime());var a=t.widgetsAtStart;if(a&&0<a.length)for(var n=0;n<a.length;n++){(l=a[n]).hasOwnProperty("uri")&&""!=l.uri?l.hasOwnProperty("visible")&&!l.visible||(l.autoDisable=!1,l.openAtStart=!0,l._nodebug=!0,g(l),m.push(l)):console.log("widget未配置uri："+JSON.stringify(l))}if(h=t.debugger){var r='<div id="widget-testbar" class="widgetbar animation-slide-bottom no-print-view" >      <div style="height: 30px; line-height:30px;"><b style="color: #4db3ff;">widget测试栏</b>&nbsp;&nbsp;<button  id="widget-testbar-remove"  type="button" class="btn btn-link btn-xs">关闭</button> </div>     <button id="widget-testbar-disableAll" type="button" class="btn btn-info" ><i class="fa fa-globe"></i>漫游</button></div>';(0,u.default)("body").append(r),(0,u.default)("#widget-testbar-remove").click(function(e){S()}),(0,u.default)("#widget-testbar-disableAll").click(function(e){b()})}if((a=t.widgets)&&0<a.length){for(n=0;n<a.length;n++){if("group"==(l=a[n]).type){r=' <div class="btn-group dropup">  <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-align-justify"></i>'+l.name+' <span class="caret"></span></button> <ul class="dropdown-menu">';for(var o=0;o<l.children.length;o++){var s=l.children[o];s.hasOwnProperty("uri")&&""!=s.uri?(r+=' <li data-widget="'+s.uri+'" class="widget-btn" ><a href="#"><i class="fa fa-star"></i>'+s.name+"</a></li>",g(s),m.push(s)):console.log("widget未配置uri："+JSON.stringify(s))}r+="</ul></div>",h&&!l._nodebug&&(0,u.default)("#widget-testbar").append(r)}else{if(!l.hasOwnProperty("uri")||""==l.uri){console.log("widget未配置uri："+JSON.stringify(l));continue}if(h&&!l._nodebug){r='<button type="button" class="btn btn-primary widget-btn" data-widget="'+l.uri+'"  > <i class="fa fa-globe"></i>'+l.name+" </button>";(0,u.default)("#widget-testbar").append(r)}g(l),m.push(l)}}h&&(0,u.default)("#widget-testbar .widget-btn").each(function(){(0,u.default)(this).click(function(e){var t=(0,u.default)(this).attr("data-widget");null!=t&&""!=t&&(_(t)?w(t):v(t))})})}for(n=0;n<m.length;n++){var l;((l=m[n]).openAtStart||l.createAtStart)&&M.push(l)}(0,u.default)(window).resize(function(){for(var e=0;e<m.length;e++){var t=m[e];t._class&&t._class.indexResize()}}),E()}function g(e){if(c)for(var t in c)"windowOptions"==t||e.hasOwnProperty(t)||(e[t]=c[t]);e.path=function(e){var t=e.lastIndexOf("/");return e.substring(0,t+1)}(p+e.uri),e.name=e.name||e.label}function v(e,t){var i;null==f&&e.viewer&&s(e.viewer),"string"==typeof e?(e={uri:e},null!=t&&(e.disableOhter=!t)):null==e.uri&&console.error("activate激活widget时需要uri参数！");for(var a=0;a<m.length;a++){var n=m[a];if(e.uri==n.uri||n.id&&e.uri==n.id){if((i=n).isloading)return i;for(var r in e)"uri"!=r&&(i[r]=e[r]);break}}if(null==i&&(g(e),i=e,m.push(e)),h&&console.log("开始激活widget："+i.uri),i.disableOhter?b(i.uri,i.group):C(i.group,i.uri),i._class)if(i._class.isActivate)if(i._class.update)i._class.update();else{i._class.disableBase();var o=setInterval(function(){i._class.isActivate||(i._class.activateBase(),clearInterval(o))},200)}else i._class.activateBase();else{for(a=0;a<M.length;a++)if(M[a].uri==i.uri)return M[a];M.push(i),1==M.length&&E()}return i}function l(e){for(var t=0;t<m.length;t++){var i=m[t];if(e==i.uri||e==i.id)return i}}function y(e){var t=l(e);return t?t._class:null}function _(e){var t=y(e);return null!=t&&t.isActivate}function w(e){if(null!=e)for(var t=0;t<m.length;t++){var i=m[t];if(i._class&&(e==i.uri||e==i.id)){i._class.disableBase();break}}}function b(e,t){for(var i=0;i<m.length;i++){var a=m[i];if(t&&a.group==t);else if(!a.autoDisable)continue;(!e||e!=a.uri&&e!=a.id)&&a._class&&a._class.disableBase()}}function C(e,t){if(null!=e)for(var i=0;i<m.length;i++){var a=m[i];if(a.group==e){if(t&&(t==a.uri||t==a.id))continue;a._class&&a._class.disableBase()}}}var x,P,M=[];function E(){if(0!=M.length)if(P)setTimeout(E,500);else{P=!0,(x=M[0]).isloading=!0;var e=x.uri;d&&(-1==e.indexOf("?")?e+="?time="+d:e+="&time="+d),window.NProgress&&NProgress.start(),h&&console.log("开始加载js："+p+e),o.Loader.async([p+e],function(){P=!1,x.isloading=!1,h&&console.log("完成js加载："+p+e),window.NProgress&&NProgress.done(!0),M.shift(),E()})}}function S(){(0,u.default)("#widget-testbar").remove()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new RegExp("\\.css"),o=document.head||document.getElementsByTagName("head")[0],s=+navigator.userAgent.replace(/.*(?:AppleWebKit|AndroidWebKit)\/?(\d+).*/i,"$1")<536;function l(e){return"complete"===e.readyState||"loaded"===e.readyState}function u(e,t,i){var a="onload"in e;function n(){e.onload=e.onreadystatechange=null,e=null,t()}"css"===i&&(s||!a)?setTimeout(function(){!function e(t,i){var a;t.sheet&&(a=!0),setTimeout(function(){a?i():e(t,i)},20)}(e,t)},1):a?(e.onload=n,e.onerror=function(){e.onerror=null,"css"==i?console.error("该css文件不存在："+e.href):console.error("该js文件不存在："+e.src),n()}):e.onreadystatechange=function(){l(e)&&n()}}function c(t,i,e,a){function n(){var e=i.indexOf(t);-1<e&&i.splice(e,1),0===i.length&&a()}t?r.test(t)?function(e,t,i){var a=document.createElement("link");a.rel="stylesheet",u(a,i,"css"),a.async=!0,a.href=e,o.appendChild(a)}(t,0,n):function(e,t,i){var a=document.createElement("script");a.charset="utf-8",u(a,i,"js"),a.async=!t.sync,a.src=e,o.appendChild(a)}(t,e,n):setTimeout(function(){n()})}function a(e,t,i){function a(){i&&i()}if(0!==(e=Array.prototype.slice.call(e||[])).length)for(var n=0,r=e.length;n<r;n++)c(e[n],e,t,a);else a()}function n(e,t){if(l(e))t();else{var i=!1;window.addEventListener("load",function(){i||(t(),i=!0)}),setTimeout(function(){i||(t(),i=!0)},1500)}}var d={async:function(e,t){n(document,function(){a(e,{},t)})},sync:function(e,t){n(document,function(){a(e,{sync:!0},t)})}};t.Loader=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addImage=function(e){};t.image={url:null,rectangle:null}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewerEx=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var d=_(i(0)),h=_(i(5)),r=i(16),o=y(i(72)),s=y(i(73)),l=y(i(74)),u=y(i(38)),f=y(i(4)),p=y(i(1)),c=y(i(19)),m=i(20),g=i(87),v=i(31);function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _(e){return e&&e.__esModule?e:{default:e}}d.default.Camera.DEFAULT_VIEW_RECTANGLE=d.default.Rectangle.fromDegrees(89.5,20.4,110.4,61.2),d.default.BingMapsApi.defaultKey="AtkX3zhnRe5fyGuLU30uZw8r3sxdBDnpQly7KfFTCB2rGlDgXBG3yr-qEiQEicEc",setTimeout(g.addLog,6e5);t.ViewerEx=(a(w,[{key:"_optimization",value:function(){var t=this.viewer;if(this.viewer.sceneModePicker&&(this.viewer.sceneModePicker.viewModel.duration=0),this.viewer._cesiumWidget._supportsImageRenderingPixelated=d.default.FeatureDetection.supportsImageRenderingPixelated(),this.viewer._cesiumWidget._forceResize=!0,d.default.FeatureDetection.supportsImageRenderingPixelated()){for(var e=window.devicePixelRatio;2<=e;)e/=2;this.viewer.resolutionScale=e}this.viewer.camera.changed.addEventListener(function(){if(t.camera._suspendTerrainAdjustment&&t.scene.mode===d.default.SceneMode.SCENE3D&&(t.camera._suspendTerrainAdjustment=!1,t.camera._adjustHeightForTerrain()),t.scene.camera.positionCartographic.height<-100){var e=p.setPositionsHeight(t.camera.positionWC,0);t.scene.camera.setView({destination:e,orientation:{heading:t.camera.heading,pitch:t.camera.pitch}})}})}},{key:"_initForOpts",value:function(){var t=this;this.viewer.cesiumWidget.creditContainer.style.display="none",this.viewer.homeButton&&this.viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function(e){t.centerAt(),e.cancel=!0}),this.centerAt(null,{duration:0});var e=this.viewer.scene;e.globe.baseColor=new d.default.Color.fromCssColorString(this.config.baseColor||"#546a53"),this.config.style&&(e.globe.depthTestAgainstTerrain=this.config.style.testTerrain,e.globe.enableLighting=this.config.style.lighting,e.skyAtmosphere.show=this.config.style.atmosphere,e.globe.showGroundAtmosphere=this.config.style.atmosphere,e.fog.enabled=this.config.style.fog,e.globe.show=d.default.defaultValue(this.config.style.globe,!0),e.moon.show=d.default.defaultValue(this.config.style.moon,e.globe.show),e.sun.show=d.default.defaultValue(this.config.style.sun,e.globe.show),e.skyBox.show=d.default.defaultValue(this.config.style.skyBox,e.globe.show),e.globe.show||(e.backgroundColor=e.globe.baseColor)),e.screenSpaceCameraController.maximumZoomDistance=this.config.maxzoom||2e7,e.screenSpaceCameraController.minimumZoomDistance=this.config.minzoom||1,e.screenSpaceCameraController._zoomFactor=2,e.screenSpaceCameraController.minimumCollisionTerrainHeight=15e6}},{key:"_addControls",value:function(){if(o.init(this.viewer),this._popup=o,s.init(this.viewer),this._tooltip=s,this.config.contextmenu&&(l.init(this.viewer),this.contextmenuItems=this.config.contextmenuItems||l.defaultContextmenuItems,this._contextmenu=l),this.config.navigation&&this._addNavigationWidget(this.config.navigation),this.config.location&&this._addLocationWidget(this.config.location),this.config.mouseZoom&&f.isPCBroswer()){(0,h.default)("#"+this.viewer._container.id).append('<div class="cesium-mousezoom"><div class="zoomimg"/></div>');var t=!0,i=-1,a=this.viewer,e=new d.default.ScreenSpaceEventHandler(this.viewer.scene.canvas);e.setInputAction(function(e){t&&(0,h.default)(".cesium-mousezoom").css({top:e.endPosition.y+"px",left:e.endPosition.x+"px"})},d.default.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(function(e){(0,h.default)(".cesium-mousezoom").addClass("cesium-mousezoom-visible"),clearTimeout(i),i=setTimeout(function(){(0,h.default)(".cesium-mousezoom").removeClass("cesium-mousezoom-visible")},200)},d.default.ScreenSpaceEventType.WHEEL),e.setInputAction(function(e){p.getCurrentMousePosition(a.scene,e.position)&&(a.camera.positionCartographic.height>a.scene.screenSpaceCameraController.minimumCollisionTerrainHeight||(t=!1,clearTimeout(i),(0,h.default)(".cesium-mousezoom").css({top:e.position.y+"px",left:e.position.x+"px"}),(0,h.default)(".cesium-mousezoom").addClass("cesium-mousezoom-visible")))},d.default.ScreenSpaceEventType.MIDDLE_DOWN),e.setInputAction(function(e){(0,h.default)(".cesium-mousezoom").removeClass("cesium-mousezoom-visible"),t=!0},d.default.ScreenSpaceEventType.MIDDLE_UP)}}},{key:"_initLayers",value:function(){var e=[],t=[];if(!this.config.baseLayerPicker&&(r=this.config.basemaps)&&0<r.length)for(var i=0;i<r.length;i++)if((l=r[i]).visible&&l.crs&&(this.crs=l.crs),(s=(0,m.createLayer)(l,this.viewer,this.config.serverURL))&&t.push(s),e.push(l),"group"==l.type&&l.layers)for(var a=0;a<l.layers.length;a++){var n=l.layers[a];e.push(n)}this.arrBasemaps=t;var r,o=[];if((r=this.config.operationallayers)&&0<r.length)for(i=0;i<r.length;i++){var s,l=r[i];if((s=(0,m.createLayer)(l,this.viewer,this.config.serverURL))&&o.push(s),e.push(l),"group"==l.type&&l.layers)for(a=0;a<l.layers.length;a++)n=l.layers[a],e.push(n)}for(this.arrOperationallayers=o,i=0;i<e.length;i++){l=e[i];var u=Number(l.order);isNaN(u)&&(u=i),l.order=u,null!=l._layer&&l._layer.setZIndex(u)}}},{key:"getConfig",value:function(){return f.clone(this.config,5)}},{key:"keyboard",value:function(e,t){e?u.bind(this.viewer,t):u.unbind(this.viewer)}},{key:"keyboardEnabled",value:function(){return u.isEnable()}},{key:"getLayer",value:function(e,t){null==t&&(t="name");var i=this.arrBasemaps;if(i&&0<i.length)for(var a=0;a<i.length;a++)if(null!=(n=i[a])&&n.config[t]==e)return n;if((i=this.arrOperationallayers)&&0<i.length)for(a=0;a<i.length;a++){var n;if(null!=(n=i[a])&&n.config[t]==e)return n}return null}},{key:"getAll3dTileLayers",value:function(){var e=this.arrOperationallayers,t=[];if(e&&0<e.length)for(var i=0;i<e.length;i++){var a=e[i];null!=a&&"3dtiles"!=a.config.type||t.push(a.config.name)}return t}},{key:"changeBasemap",value:function(e){for(var t=this.arrBasemaps,i=0;i<t.length;i++){var a=t[i];"group"==a.config.type&&null==a._layers||(e==a.config.name||e==a.config.id?a.setVisible(!0):a.setVisible(!1))}}},{key:"hasTerrain",value:function(){return null!=this.terrainProvider&&this.viewer.terrainProvider!=f.getEllipsoidTerrain()}},{key:"updateTerrainProvider",value:function(e){if(e){if(null==this.terrainProvider){var t=this.config.terrain;t.url&&(this.config.serverURL&&(t.url=t.url.replace("$serverURL$",this.config.serverURL)),t.url=t.url.replace("$hostname$",location.hostname).replace("$host$",location.host)),this.terrainProvider=f.getTerrainProvider(t)}this.viewer.terrainProvider=this.terrainProvider}else this.viewer.terrainProvider=f.getEllipsoidTerrain()}},{key:"getCrs",value:function(){return this.crs}},{key:"point2map",value:function(e){if("gcj"!=this.crs)return"baidu"!=this.crs?e:(t=f.clone(e),i=c.wgs2bd([t.x,t.y]),t.x=i[0],t.y=i[1],t);var t=f.clone(e),i=c.wgs2gcj([t.x,t.y]);return t.x=i[0],t.y=i[1],t}},{key:"point2wgs",value:function(e){if("gcj"!=this.crs)return"baidu"!=this.crs?e:(t=f.clone(e),i=c.bd2gcj([t.x,t.y]),t.x=i[0],t.y=i[1],t);var t=f.clone(e),i=c.gcj2wgs([t.x,t.y]);return t.x=i[0],t.y=i[1],t}},{key:"centerAtArr",value:function(e,t){this.cancelCenterAt(),this.arrCenterTemp=e,this._isCenterAtArr=!0,this._centerAtArrItem(0,t)}},{key:"_centerAtArrItem",value:function(t,i){var a=this;if(!this._isCenterAtArr||t<0||t>=this.arrCenterTemp.length)return this._isCenterAtArr=!1,void(i&&i());var n=this.arrCenterTemp[t];n.onStart&&n.onStart(),this.centerAt(n,{duration:n.duration,complete:function(){n.onEnd&&n.onEnd();var e=n.stop||1;setTimeout(function(){a._centerAtArrItem(++t,i)},1e3*e)},cancle:function(){this._isCenterAtArr=!1,i&&i()}})}},{key:"cancelCenterAt",value:function(){this._isCenterAtArr=!1,this.viewer.camera.flyTo({destination:this.viewer.camera.position,orientation:{heading:this.viewer.camera.heading,pitch:this.viewer.camera.pitch,roll:this.viewer.camera.roll},duration:0})}},{key:"centerAt",value:function(e,t){if(null==t?t={}:f.isNumber(t)&&(t={duration:t}),null==e&&(t.isWgs84=!0,e=this.config.extent||this.config.center||{y:17.196575,x:114.184276,z:9377198,heading:0,pitch:-80,roll:0}),e.xmin&&e.xmax&&e.ymin&&e.ymax){var i=e.xmin,a=e.xmax,n=e.ymin,r=e.ymax;if(t.isWgs84){var o=this.point2map({x:i,y:n});i=o.x,n=o.y;var s=this.point2map({x:a,y:r});a=s.x,r=s.y}var l=d.default.Rectangle.fromDegrees(i,n,a,r);this.viewer.camera.flyTo({destination:l,duration:t.duration,complete:t.complete})}else{t.isWgs84&&(e=this.point2map(e));var u=t.minz||2500;this.viewer.camera.positionCartographic.height<u&&(u=this.viewer.camera.positionCartographic.height),null!=e.z&&0!=e.z&&(u=e.z),this.viewer.camera.flyTo({destination:d.default.Cartesian3.fromDegrees(e.x,e.y,u),orientation:{heading:d.default.Math.toRadians(e.heading||0),pitch:d.default.Math.toRadians(e.pitch||-90),roll:d.default.Math.toRadians(e.roll||0)},duration:t.duration,complete:t.complete})}}},{key:"isFlyAnimation",value:function(){return this._isFlyAnimation}},{key:"openFlyAnimation",value:function(t,e){var i=this,a=this.viewer,n=e||p.getCameraView(a);this._isFlyAnimation=!0,a.camera.setView({destination:d.default.Cartesian3.fromDegrees(-85.16,13.71,23e6)}),a.camera.flyTo({destination:d.default.Cartesian3.fromDegrees(n.x,n.y,23e6),duration:2,easingFunction:d.default.EasingFunction.LINEAR_NONE,complete:function(){var e=1.2*(n.z||9e4)+8e3;23e6<e&&(e=23e6),a.camera.flyTo({destination:d.default.Cartesian3.fromDegrees(n.x,n.y,e),complete:function(){i.centerAt(n,{duration:2,complete:function(){i._isFlyAnimation=!1,t&&t()}})}})}})}},{key:"rotateAnimation",value:function(e,t){var i=this.viewer,a=p.getCameraView(i),n=t/3;i.camera.flyTo({destination:d.default.Cartesian3.fromDegrees(a.x+120,a.y,a.z),orientation:{heading:d.default.Math.toRadians(a.heading),pitch:d.default.Math.toRadians(a.pitch),roll:d.default.Math.toRadians(a.roll)},duration:n,easingFunction:d.default.EasingFunction.LINEAR_NONE,complete:function(){i.camera.flyTo({destination:d.default.Cartesian3.fromDegrees(a.x+240,a.y,a.z),orientation:{heading:d.default.Math.toRadians(a.heading),pitch:d.default.Math.toRadians(a.pitch),roll:d.default.Math.toRadians(a.roll)},duration:n,easingFunction:d.default.EasingFunction.LINEAR_NONE,complete:function(){i.camera.flyTo({destination:d.default.Cartesian3.fromDegrees(a.x,a.y,a.z),orientation:{heading:d.default.Math.toRadians(a.heading),pitch:d.default.Math.toRadians(a.pitch),roll:d.default.Math.toRadians(a.roll)},duration:n,easingFunction:d.default.EasingFunction.LINEAR_NONE,complete:function(){e&&e()}})}})}})}},{key:"_addLocationWidget",value:function(l){var u=this.viewer;(0,h.default)("#"+u._container.id).prepend('<div id="location_hchx_jwd"  class="location-bar animation-slide-bottom no-print" ></div>'),l.style?(0,h.default)("#location_hchx_jwd").css(l.style):(0,h.default)("#location_hchx_jwd").css({left:u.animation?"170px":"0",right:"0",bottom:u.timeline?"25px":"0"}),l.format=l.format||"<div>视高：{height}米</div><div>俯仰角：{pitch}度</div><div>方向：{heading}度</div><div>海拔：{z}米</div><div>纬度:{y}</div><div>经度:{x}</div>";var c={};c.height=u.camera.positionCartographic.height.toFixed(1),c.heading=d.default.Math.toDegrees(u.camera.heading).toFixed(0),c.pitch=d.default.Math.toDegrees(u.camera.pitch).toFixed(0),new d.default.ScreenSpaceEventHandler(u.scene.canvas).setInputAction(function(e){var t=p.getCurrentMousePosition(u.scene,e.endPosition);if(t){var i=d.default.Cartographic.fromCartesian(t);c.z=i.height.toFixed(1);var a=d.default.Math.toDegrees(i.longitude),n=d.default.Math.toDegrees(i.latitude);switch(l.crs){default:var r=l.hasOwnProperty("toFixed")?l.toFixed:6;c.x=a.toFixed(r),c.y=n.toFixed(r);break;case"degree":c.x=f.formatDegree(a),c.y=f.formatDegree(n);break;case"project":r=l.hasOwnProperty("toFixed")?l.toFixed:0,c.x=t.x.toFixed(r),c.y=t.y.toFixed(r);break;case"wgs":r=l.hasOwnProperty("toFixed")?l.toFixed:6;var o=point2wgs({x:a,y:n});c.x=o.x.toFixed(r),c.y=o.y.toFixed(r);break;case"wgs-degree":o=point2wgs({x:a,y:n}),c.x=f.formatDegree(o.x),c.y=f.formatDegree(o.y)}var s=f.template(l.format,c);(0,h.default)("#location_hchx_jwd").html(s)}},d.default.ScreenSpaceEventType.MOUSE_MOVE),u.scene.camera.changed.addEventListener(function(e){if(c.height=u.camera.positionCartographic.height.toFixed(1),c.heading=d.default.Math.toDegrees(u.camera.heading).toFixed(0),c.pitch=d.default.Math.toDegrees(u.camera.pitch).toFixed(0),null!=c.x){var t=f.template(l.format,c);(0,h.default)("#location_hchx_jwd").html(t)}})}},{key:"_addNavigationWidget",value:function(e){d.default.viewerCesiumNavigationMixin&&(this.viewer.extend(d.default.viewerCesiumNavigationMixin,{defaultResetView:d.default.Rectangle.fromDegrees(110,20,120,30),enableZoomControls:!0}),this.viewer.animation?(0,h.default)(".distance-legend").css({left:"150px",bottom:"25px",border:"none",background:"rgba(0, 0, 0, 0)","z-index":"992"}):(0,h.default)(".distance-legend").css({left:"-10px",bottom:"-1px",border:"none",background:"rgba(0, 0, 0, 0)","z-index":"992"}),e.legend?(0,h.default)(".distance-legend").css(e.legend):(0,h.default)(".distance-legend").remove(),e.compass?(0,h.default)(".compass").css(e.compass):(0,h.default)(".compass").remove(),(0,h.default)(".navigation-controls").remove())}},{key:"destroy",value:function(){this._tooltip.destroy(),this._popup.destroy(),this._contextmenu&&this._contextmenu.destroy()}},{key:"popup",get:function(){return this._popup}},{key:"tooltip",get:function(){return this._tooltip}},{key:"contextmenu",get:function(){return this._contextmenu}},{key:"contextmenuItems",get:function(){return this._contextmenuItems},set:function(e){this._contextmenuItems=e}},{key:"draw",get:function(){return null==this._drawControl&&(this._drawControl=new r.Draw(this.viewer,{hasEdit:!1})),this._drawControl}},{key:"top",get:function(){this.viewer.camera.direction=new Cesium.Cartesian3(0,0,-1)}},{key:"east",get:function(){this.viewer.camera.direction=new Cesium.Cartesian3(-1,0,0)}},{key:"west",get:function(){this.viewer.camera.direction=new Cesium.Cartesian3(1,0,0)}},{key:"south",get:function(){this.viewer.camera.direction=new Cesium.Cartesian3(0,-1,0)}},{key:"north",get:function(){this.viewer.camera.direction=new Cesium.Cartesian3(0,1,0)}}]),w);function w(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w),this.viewer=e,this.config=t||{},(this.viewer.hchx=this)._isFlyAnimation=!1,this.crs=this.config.crs||"3857",(0,v.addImage)(e),this._optimization(),this._initForOpts(),this._addControls(),this._initLayers()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={});for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"opacity":case"outlineOpacity":case"radius":case"shape":break;case"outlineColor":t.outlineColor=new s.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"color":t.material=new s.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(Number(e.opacity||1))}}switch(e.radius=e.radius||10,e.shape){default:case"pipeline":t.shape=function(e){for(var t=e/3,i=[],a=0;a<=360;a++){var n=s.default.Math.toRadians(a);i.push(new s.default.Cartesian2(e*Math.cos(n),e*Math.sin(n)))}for(a=360;0<=a;a--){n=s.default.Math.toRadians(a);i.push(new s.default.Cartesian2((e-t)*Math.cos(n),(e-t)*Math.sin(n)))}return i}(e.radius);break;case"circle":t.shape=function(e){for(var t=[],i=0;i<=360;i++){var a=s.default.Math.toRadians(i);t.push(new s.default.Cartesian2(e*Math.cos(a),e*Math.sin(a)))}return t}(e.radius);break;case"star":t.shape=function(e,t){t=t||6;for(var i=Math.PI/t,a=2*t,n=new Array(a),r=0;r<a;r++){var o=r%2==0?e:e/3;n[r]=new s.default.Cartesian2(Math.cos(r*i)*o,Math.sin(r*i)*o)}return n}(e.radius)}return t},t.getPositions=o,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"LineString",coordinates:t}}};var a,n=i(0),s=(a=n)&&a.__esModule?a:{default:a},r=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function o(e){return e._positions_draw&&0<e._positions_draw.length?e._positions_draw:e.polylineVolume.positions.getValue()}function l(e){var t=o(e);return r.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){null==t&&(t={fill:!0});(e=e||{}).clampToGround&&(e.hasOwnProperty("height")&&delete e.height,e.hasOwnProperty("extrudedHeight")&&delete e.extrudedHeight);for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new r.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"height":t.height=Number(a),e.extrudedHeight&&(t.extrudedHeight=Number(e.extrudedHeight)+Number(a));break;case"extrudedHeight":t.extrudedHeight=Number(t.height||e.height||0)+Number(a);break;case"color":t.material=new r.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(Number(e.opacity||1));break;case"image":t.material=new r.default.ImageMaterialProperty({image:e.image,color:new r.default.Color.fromCssColorString("#FFFFFF").withAlpha(Number(e.opacity||1))});break;case"rotation":t.rotation=r.default.Math.toRadians(a),e.stRotation||(t.stRotation=r.default.Math.toRadians(a));break;case"stRotation":t.stRotation=r.default.Math.toRadians(a)}}null==t.material&&(t.material=r.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"MultiPoint",coordinates:t}}};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){if(e._positions_draw&&0<e._positions_draw.length)return e._positions_draw;var t=e.rectangle.coordinates.getValue(),i=e.rectangle.height?e.rectangle.height.getValue():0;return[r.default.Cartesian3.fromRadians(t.west,t.south,i),r.default.Cartesian3.fromRadians(t.east,t.north,i)]}function l(e){var t=s(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CircleWaveMaterial=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r};var l=new s.default.Color(0,0,0,0),u=t.CircleWaveMaterial=(a(c,[{key:"getType",value:function(e){return s.default.Material.CircleWaveMaterialType}},{key:"getValue",value:function(e,t){return s.default.defined(t)||(t={}),t.color=s.default.Property.getValueOrClonedDefault(this._color,e,l,t.color),void 0===this._time&&(this._time=(new Date).getTime()),t.time=((new Date).getTime()-this._time)/this._duration,t.count=this._count,t.gradient=1+10*(1-this._gradient),t}},{key:"equals",value:function(e){return this===e||e instanceof c&&s.default.Property.equals(this._color,e._color)}},{key:"isConstant",get:function(){return!1}},{key:"definitionChanged",get:function(){return this._definitionChanged}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),e=s.default.defaultValue(e,s.default.defaultValue.EMPTY_OBJECT),this._definitionChanged=new s.default.Event,this._color=void 0,this._colorSubscription=void 0,this.color=s.default.defaultValue(e.color,l),this._duration=s.default.defaultValue(e.duration,1e3),this._count=s.default.defaultValue(e.count,2),this._count<=0&&(this._count=1),this._gradient=s.default.defaultValue(e.gradient,.1),this._gradient<0&&(this._gradient=0),1<this._gradient&&(this._gradient=1),this._time=void 0}s.default.defineProperties(u.prototype,{color:s.default.createPropertyDescriptor("color")}),s.default.Material.CircleWaveMaterialType="CircleWaveMaterial",s.default.Material._materialCache.addMaterial(s.default.Material.CircleWaveMaterialType,{fabric:{type:s.default.Material.CircleWaveMaterialType,uniforms:{color:new s.default.Color(1,0,0,1),time:1,count:2,gradient:.1},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                {\n                    czm_material material = czm_getDefaultMaterial(materialInput);\n                    material.diffuse = 1.5 * color.rgb;\n                    vec2 st = materialInput.st;\n                    vec3 str = materialInput.str;\n                    float dis = distance(st, vec2(0.5, 0.5));\n                    float per = fract(time);\n                    if(abs(str.z)>0.001){\n                        discard;\n                    }\n                    if(dis >0.5){\n                        discard;\n                    }else {\n                        float perDis = 0.5/count;\n                        float disNum;\n                        float bl = .0;\n                        for(int i=0;i<=999;i++){\n                            if(float(i)<=count){\n                                disNum = perDis*float(i) - dis + per/count;\n                                if(disNum>0.0){\n                                    if(disNum<perDis){\n                                        bl = 1.0-disNum/perDis;\n                                    }\n                                    else if(disNum-perDis<perDis){\n                                        bl = 1.0 - abs(1.0-disNum/perDis);\n                                    }\n                                    material.alpha = pow(bl,gradient);\n                                }\n                            }\n                        }\n                    }\n                    return material;\n                }"},translucent:function(){return!0}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={fill:!0});for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"opacity":case"outlineOpacity":case"widthRadii":case"heightRadii":break;case"outlineColor":t.outlineColor=new s.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"color":t.material=new s.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(Number(e.opacity||1));break;case"extentRadii":var n=e.extentRadii||100,r=e.widthRadii||100,o=e.heightRadii||100;t.radii=new s.default.Cartesian3(n,r,o)}}null==t.material&&(t.material=s.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=o,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"Point",coordinates:t[0]}}};var a,n=i(0),s=(a=n)&&a.__esModule?a:{default:a},r=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function o(e){return[e.position.getValue()]}function l(e){var t=o(e);return r.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},t=t||{fill:!0};for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"opacity":case"outlineOpacity":case"color":case"materialType":case"animationDuration":case"animationImage":case"animationAxisY":break;case"outlineColor":t.outlineColor=new r.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1)}}if(e.color||e.materialType){var n=new r.default.Color.fromCssColorString(e.color||"#FFFF00").withAlpha(Number(r.default.defaultValue(e.opacity,1)));switch(e.materialType){default:case"color":t.material=n;break;case"animation":t.material=new s.LineFlowMaterial({color:n,duration:e.animationDuration||2e3,url:e.animationImage,repeat:new r.default.Cartesian2(e.animationRepeatX||1,e.animationRepeatY||1),axisY:e.animationAxisY})}}null==t.material&&(t.material=r.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=l,t.getCoordinates=u,t.toGeoJSON=function(e){var t=u(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"LineString",coordinates:t}}};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2)),s=i(25);function l(e){return e.wall.positions.getValue()}function u(e){var t=l(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bind=r,t.unbind=o,t.isEnable=function(){return b},t.enable=function(e){b?o(viewer):r(viewer,e)};var a,u,w,b,n=i(0),C=(a=n)&&a.__esModule?a:{default:a};var x={options:{able:!1,step:200},events:{LEFT_DOWN:void 0,MOUSE_MOVE:void 0,LEFT_UP:void 0,keydown:void 0,keyup:void 0,clock:void 0},type:{ENLARGE:0,NARROW:1,LEFT_ROTATE:2,RIGHT_ROTATE:3,TOP_ROTATE:4,BOTTOM_ROTATE:5}};function r(d,e){if(!b){b=!0;var c=(e=e||{}).speedRatio||150,n=e.minPitch||.1,r=e.maxPitch||.95,h=e.dirStep||25,f=e.rotateStep||1,t=d.scene,p=d.canvas;p.setAttribute("tabindex","0"),p.onclick=function(){p.focus()};var m,g,v=t.globe.ellipsoid;t.screenSpaceCameraController.enableRotate=!1,t.screenSpaceCameraController.enableTranslate=!1,t.screenSpaceCameraController.enableZoom=!1,t.screenSpaceCameraController.enableTilt=!1;var y={looking:t.screenSpaceCameraController.enableLook=!1,moveForward:!1,moveBackward:!1,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1};(w=new C.default.ScreenSpaceEventHandler(p)).setInputAction(function(e){y.looking=!0,g=m=C.default.Cartesian3.clone(e.position)},C.default.ScreenSpaceEventType.LEFT_DOWN),w.setInputAction(function(e){g=e.endPosition},C.default.ScreenSpaceEventType.MOUSE_MOVE),w.setInputAction(function(e){y.looking=!1},C.default.ScreenSpaceEventType.LEFT_UP),w.setInputAction(function(e){0<e?(c*=.9,f*=1.1,h*=.9):(c*=1.1,f*=.9,h*=1.1)},C.default.ScreenSpaceEventType.WHEEL),document.addEventListener("keydown",function(e){var t=i(e.keyCode);void 0!==t&&(y[t]=!0)},!1),document.addEventListener("keyup",function(e){var t=i(e.keyCode);void 0!==t&&(y[t]=!1)},!1),u=function(e){var t=d.camera;if(y.looking){var i=p.clientWidth,a=p.clientHeight,n=(g.x-m.x)/i,r=-(g.y-m.y)/a;t.lookRight(.05*n),t.lookUp(.05*r);var o=t.direction,s=C.default.Cartesian3.normalize(t.position,new C.default.Cartesian3),l=C.default.Cartesian3.cross(o,s,new C.default.Cartesian3);s=C.default.Cartesian3.cross(l,o,new C.default.Cartesian3),t.up=s,t.right=l}var u=v.cartesianToCartographic(t.position).height/c;y.moveForward&&_(u),y.moveBackward&&_(-u),y.moveUp&&t.moveUp(u),y.moveDown&&t.moveDown(u),y.moveLeft&&t.moveLeft(u),y.moveRight&&t.moveRight(u)},d.clock.onTick.addEventListener(u)}function i(e){switch(e){case"W".charCodeAt(0):return"moveForward";case"S".charCodeAt(0):return"moveBackward";case"D".charCodeAt(0):return"moveRight";case"A".charCodeAt(0):return"moveLeft";case"Q".charCodeAt(0):return"moveUp";case"E".charCodeAt(0):return"moveDown";case 38:l(x.type.TOP_ROTATE);break;case 37:l(x.type.LEFT_ROTATE);break;case 39:l(x.type.RIGHT_ROTATE);break;case 40:l(x.type.BOTTOM_ROTATE);break;case"I".charCodeAt(0):case 104:s(x.type.ENLARGE);break;case"K".charCodeAt(0):case 101:s(x.type.NARROW);break;case"J".charCodeAt(0):case 100:s(x.type.LEFT_ROTATE);break;case"L".charCodeAt(0):case 102:s(x.type.RIGHT_ROTATE);break;case"U".charCodeAt(0):case 103:s(x.type.TOP_ROTATE);break;case"O".charCodeAt(0):case 105:s(x.type.BOTTOM_ROTATE)}}function _(e){var t=d.camera,i=t.direction,a=C.default.Cartesian3.normalize(t.position,new C.default.Cartesian3),n=C.default.Cartesian3.cross(i,a,new C.default.Cartesian3);i=C.default.Cartesian3.cross(a,n,new C.default.Cartesian3),i=C.default.Cartesian3.normalize(i,i),i=C.default.Cartesian3.multiplyByScalar(i,e,i),t.position=C.default.Cartesian3.add(t.position,i,t.position)}function a(e,t,i){var a=C.default.Cartesian3.dot(e,C.default.Cartesian3.normalize(t,new C.default.Cartesian3));return!("up"==i&&a<n)&&!("down"==i&&r<a)}function o(e,t,i){var a=e.position,n=hchx3d.point.getCenter(d);if(n){var r=C.default.Cartesian3.fromDegrees(n.x,n.y,n.z);if(r){var o=C.default.Cartesian3.distance(r,a),s=o/100;s=i?s*f:s;var l={},u=new C.default.Ray(a,t);if(l.position=C.default.Ray.getPoint(u,s),l.direction=e.direction,l.right=e.right,l.up=e.up,i){var c=C.default.Cartesian3.normalize(C.default.Cartesian3.subtract(l.position,r,new C.default.Cartesian3),new C.default.Cartesian3);u=new C.default.Ray(r,c),l.position=C.default.Ray.getPoint(u,o),l.direction=C.default.Cartesian3.negate(c,new C.default.Cartesian3),l.up=C.default.Cartesian3.normalize(l.position,new C.default.Cartesian3),l.right=C.default.Cartesian3.cross(l.direction,l.up,new C.default.Cartesian3)}return l}}}function s(e){var t,i=d.scene.camera;switch(e){case x.type.ENLARGE:t=o(i,i.direction);break;case x.type.NARROW:t=o(i,C.default.Cartesian3.negate(i.direction,new C.default.Cartesian3));break;case x.type.LEFT_ROTATE:t=o(i,C.default.Cartesian3.negate(i.right,new C.default.Cartesian3),!0);break;case x.type.RIGHT_ROTATE:t=o(i,i.right,!0);break;case x.type.TOP_ROTATE:if(!a(C.default.clone(i.up),C.default.clone(i.position),"up"))return;t=o(i,C.default.clone(i.up),!0);break;case x.type.BOTTOM_ROTATE:if(!a(C.default.clone(i.up),C.default.clone(i.position),"down"))return;t=o(i,C.default.Cartesian3.negate(i.up,new C.default.Cartesian3),!0)}t&&function(e){e&&(d.scene.camera.position=e.position,d.scene.camera.direction=e.direction,d.scene.camera.right=e.right,d.scene.camera.up=e.up)}(t)}function l(e){if(d){var t=[0,0],i=d.scene.canvas.clientWidth,a=d.scene.canvas.clientHeight,n=(i+a)/h;switch(e){case x.type.LEFT_ROTATE:t=[-n*i/a,0];break;case x.type.RIGHT_ROTATE:t=[n*i/a,0];break;case x.type.TOP_ROTATE:t=[0,n];break;case x.type.BOTTOM_ROTATE:t=[0,-n];break;default:return}var r=t[0]/i,o=t[1]/a,s=d.camera;s.lookRight(.05*r),s.lookUp(.05*o);var l=s.direction,u=C.default.Cartesian3.normalize(s.position,new C.default.Cartesian3),c=C.default.Cartesian3.cross(l,u,new C.default.Cartesian3);u=C.default.Cartesian3.cross(c,l,new C.default.Cartesian3),s.up=u,s.right=c}}}function o(e){if(b){b=!1;var t=e.scene;e.canvas;t.screenSpaceCameraController.enableRotate=!0,t.screenSpaceCameraController.enableTranslate=!0,t.screenSpaceCameraController.enableZoom=!0,t.screenSpaceCameraController.enableTilt=!0,t.screenSpaceCameraController.enableLook=!0,u&&(e.clock.onTick.removeEventListener(u),u=void 0),w&&(w.destroy(),w=void 0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileLayer=void 0;var a,n=i(0),l=(a=n)&&a.__esModule?a:{default:a},r=i(9),o=i(20);var s=r.BaseLayer.extend({layer:null,add:function(){null!=this.layer&&this.remove(),this.addEx();var e=this.createImageryProvider(this.config);if(null!=e){var t=this.config,i={show:!0,alpha:this._opacity};if(t.rectangle&&t.rectangle.xmin&&t.rectangle.xmax&&t.rectangle.ymin&&t.rectangle.ymax){var a=t.rectangle.xmin,n=t.rectangle.xmax,r=t.rectangle.ymin,o=t.rectangle.ymax,s=l.default.Rectangle.fromDegrees(a,r,n,o);this.rectangle=s,i.rectangle=s}t.brightness&&(i.brightness=t.brightness),t.contrast&&(i.contrast=t.contrast),t.hue&&(i.hue=t.hue),t.saturation&&(i.saturation=t.saturation),t.gamma&&(i.gamma=t.gamma),t.maximumAnisotropy&&(i.maximumAnisotropy=t.maximumAnisotropy),t.minimumTerrainLevel&&(i.minimumTerrainLevel=t.minimumTerrainLevel),t.maximumTerrainLevel&&(i.maximumTerrainLevel=t.maximumTerrainLevel),this.layer=new l.default.ImageryLayer(e,i),this.layer.config=this.config,this.viewer.imageryLayers.add(this.layer),this.setZIndex(this.config.order)}},createImageryProvider:function(e){return(0,o.createImageryProvider)(e)},addEx:function(){},remove:function(){null!=this.layer&&(this.removeEx(),this.viewer.imageryLayers.remove(this.layer,!0),this.layer=null)},removeEx:function(){},centerAt:function(e){if(null!=this.layer)if(this.config.extent||this.config.center)this.viewer.hchx.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else if(this.rectangle)this.viewer.camera.flyTo({destination:this.rectangle,duration:e});else{var t=this.layer.imageryProvider.rectangle;t&&t!=l.default.Rectangle.MAX_VALUE&&0<t.west&&0<t.south&&0<t.east&&0<t.north&&this.viewer.camera.flyTo({destination:t,duration:e})}},hasOpacity:!0,_opacity:1,setOpacity:function(e){this._opacity=e,null!=this.layer&&(this.layer.alpha=e)},hasZIndex:!0,setZIndex:function(e){if(null!=this.layer&&null!=e){this.viewer.imageryLayers.raiseToTop(this.layer);for(var t=this.viewer.imageryLayers._layers,i=t.length-1;0<=i;i--)if(t[i]!=this.layer){var a=t[i].config;a&&a.order&&e<a.order&&this.viewer.imageryLayers.lower(this.layer)}}}});t.TileLayer=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CustomFeatureGridLayer=void 0;var c=n(i(0)),d=n(i(5)),h=i(4),a=i(77),f=i(14),p=i(12),m=i(10),g=i(15);function n(e){return e&&e.__esModule?e:{default:e}}var r=a.FeatureGridLayer.extend({_cacheGrid:{},_cacheFeature:{},_addImageryCache:function(t){this._cacheGrid[t.key]={opts:t,isLoading:!0};var i=this;this.getDataForGrid(t,function(e){i._visible&&i._showData(t,e)})},getDataForGrid:function(e,t){this.config.getDataForGrid&&this.config.getDataForGrid(e,t)},checkHasBreak:function(e){return!this._visible||!this._cacheGrid[e]},_showData:function(e,t){var i=e.key;if(!this.checkHasBreak[i]){for(var a=this,n=[],r=0,o=t.length;r<o;r++){var s=t[r],l=s[this.config.IdName||"id"],u=this._cacheFeature[l];if(u)u.grid.push(i),this.updateEntity(u.entity,s);else{var c=this.createEntity(e,s,function(e){a.config.debuggerTileInfo&&(e._temp_id=l,e.popup=function(e){return JSON.stringify(a._cacheFeature[e._temp_id].grid)}),a._cacheFeature[l]={grid:[i],entity:e}});null!=c&&(a.config.debuggerTileInfo&&(c._temp_id=l,c.popup=function(e){return JSON.stringify(a._cacheFeature[e._temp_id].grid)}),a._cacheFeature[l]={grid:[i],entity:c})}n.push(l)}this._cacheGrid[i]=this._cacheGrid[i]||{},this._cacheGrid[i].ids=n,this._cacheGrid[i].isLoading=!1}},createEntity:function(e,t,i){return this.config.createEntity?this.config.createEntity(e,t,i):null},updateEntity:function(e,t){this.config.updateEntity&&this.config.updateEntity(e,t)},removeEntity:function(e){this.config.removeEntity?this.config.removeEntity(e):this.dataSource.entities.remove(e)},_removeImageryCache:function(e){var t=e.key,i=this._cacheGrid[t];if(i){if(i.ids)for(var a=0;a<i.ids.length;a++){var n=i.ids[a],r=this._cacheFeature[n];r&&(r.grid.remove(t),0==r.grid.length&&(delete this._cacheFeature[n],this.removeEntity(r.entity)))}delete this._cacheGrid[t]}},_removeAllImageryCache:function(){this.config.removeAllEntity?this.config.removeAllEntity():(this.dataSource.entities.removeAll(),this.primitives.removeAll()),this._cacheFeature={},this._cacheGrid={}},removeEx:function(){this.config.removeAllEntity?this.config.removeAllEntity():(this.dataSource.entities.removeAll(),this.primitives.removeAll()),this._cacheFeature={},this._cacheGrid={},this.viewer.dataSources.remove(this.dataSource),this.viewer.scene.primitives.remove(this.primitives)},reload:function(){var t=this;for(var e in this._cacheGrid){var i=this._cacheGrid[e];if(null!=i&&null!=i.opts&&!i.isLoading){var a=i.opts;this.getDataForGrid(a,function(e){t._showData(a,e)})}}},hasOpacity:!0,_opacity:1,setOpacity:function(e){for(var t in this._opacity=e,this._cacheFeature){var i=this._cacheFeature[t].entity;i.polygon&&i.polygon.material&&i.polygon.material.color?(this._updatEntityAlpha(i.polygon.material.color,this._opacity),i.polygon.outlineColor&&this._updatEntityAlpha(i.polygon.outlineColor,this._opacity)):i.polyline&&i.polyline.material&&i.polyline.material.color?this._updatEntityAlpha(i.polyline.material.color,this._opacity):i.billboard&&(i.billboard.color=new c.default.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity),i.label&&(i.label.fillColor&&this._updatEntityAlpha(i.label.fillColor,this._opacity),i.label.outlineColor&&this._updatEntityAlpha(i.label.outlineColor,this._opacity),i.label.backgroundColor&&this._updatEntityAlpha(i.label.backgroundColor,this._opacity)))}},_updatEntityAlpha:function(e,t){var i=e.getValue().withAlpha(t);e.setValue(i)},colorHash:{},setDefSymbol:function(e){if(e.polygon){var t=e.properties.OBJECTID;(i=this.colorHash[t])||(i=c.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polygon.material=i,e.polygon.outline=!0,e.polygon.outlineColor=c.default.Color.WHITE}else if(e.polyline){var i;t=e.properties.OBJECTID;(i=this.colorHash[t])||(i=c.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polyline.material=i,e.polyline.width=2}else e.billboard&&(e.billboard.scale=.5,e.billboard.horizontalOrigin=c.default.HorizontalOrigin.CENTER,e.billboard.verticalOrigin=c.default.VerticalOrigin.BOTTOM)},setConfigSymbol:function(e,t){var i=e.properties,a=t.styleOptions;if(t.styleField){var n=i[t.styleField];null!=(r=t.styleFieldOptions[n])&&(a=(0,h.clone)(a),a=d.default.extend(a,r))}if("function"==typeof t.calback){var r;if(!(r=t.calback(i,e,t)))return;a=(0,h.clone)(a),a=d.default.extend(a,r)}if(a=a||{},this._opacity=a.opacity||1,e.polygon){if((0,g.style2Entity)(a,e.polygon),a.outlineWidth&&1<a.outlineWidth){e.polygon.outline=!1;var o={color:a.outlineColor,width:a.outlineWidth,opacity:a.outlineOpacity,lineType:"solid",outline:!1},s=(0,m.style2Entity)(o);s.positions=e.polygon.hierarchy._value.positions,this.dataSource.entities.add({polyline:s})}if(this.config.buildings){var l=Number(i[this.config.buildings.cloumn]||1),u=Number(this.config.buildings.height||5);e.polygon.extrudedHeight=l*u}}else e.polyline?(0,m.style2Entity)(a,e.polyline):e.billboard&&(e.billboard.heightReference=c.default.HeightReference.RELATIVE_TO_GROUND,(0,f.style2Entity)(a,e.billboard),a.label&&a.label.field&&(a.label.heightReference=c.default.HeightReference.RELATIVE_TO_GROUND,e.label=(0,p.style2Entity)(a.label),e.label.text=i[a.label.field]))}});t.CustomFeatureGridLayer=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCenter=function(e,t){var i={},a=e.boundingSphere.center,n=y.default.Cartographic.fromCartesian(a),r=Number(n.height.toFixed(2)),o=Number(y.default.Math.toDegrees(n.longitude).toFixed(6)),s=Number(y.default.Math.toDegrees(n.latitude).toFixed(6));if(i={x:o,y:s,z:r},console.log("模型内部原始位置:"+JSON.stringify(i)),t){var l=y.default.Matrix4.fromArray(e._root.transform),u=y.default.Matrix4.getTranslation(l,new y.default.Cartesian3),c=y.default.Cartographic.fromCartesian(u);if(c){i.x=Number(y.default.Math.toDegrees(c.longitude).toFixed(6)),i.y=Number(y.default.Math.toDegrees(c.latitude).toFixed(6)),i.z=Number(c.height.toFixed(2));var d=y.default.Matrix4.getRotation(l,new y.default.Matrix3),h=y.default.Matrix4.getRotation(y.default.Transforms.eastNorthUpToFixedFrame(u),new y.default.Matrix3),f=y.default.Matrix3.getColumn(h,0,new y.default.Cartesian3),p=y.default.Matrix3.getColumn(h,1,new y.default.Cartesian3),m=y.default.Matrix3.getColumn(h,2,new y.default.Cartesian3),g=y.default.Matrix3.getColumn(d,0,new y.default.Cartesian3);g=y.default.Cartesian3.cross(g,m,g),g=y.default.Cartesian3.cross(m,g,g),g=y.default.Cartesian3.normalize(g,g);var v=y.default.Cartesian3.angleBetween(f,g);y.default.Cartesian3.angleBetween(p,g)>.5*Math.PI&&(v=2*Math.PI-v),i.heading=Number(y.default.Math.toDegrees(v).toFixed(1)),console.log("模型内部世界矩阵:"+JSON.stringify(i))}}return i},t.updateMatrix=function(e,t){var i;if(e._root&&e._root.transform&&t.transform){var a=y.default.Cartesian3.fromDegrees(t.x,t.y,t.z);i=y.default.Transforms.eastNorthUpToFixedFrame(a);var n=y.default.Matrix4.fromRotationTranslation(y.default.Matrix3.fromRotationZ(y.default.Math.toRadians(t.heading||0)));y.default.Matrix4.multiply(i,n,i),0<t.scale&&1!=t.scale&&y.default.Matrix4.multiplyByUniformScale(i,t.scale,i),t.axis&&(i=function(e,t){if(null==t)return e;var i;switch(t.toUpperCase()){case"Y_UP_TO_Z_UP":i=y.default.Axis.Y_UP_TO_Z_UP;break;case"Z_UP_TO_Y_UP":i=y.default.Axis.Z_UP_TO_Y_UP;break;case"X_UP_TO_Z_UP":i=y.default.Axis.X_UP_TO_Z_UP;break;case"Z_UP_TO_X_UP":i=y.default.Axis.Z_UP_TO_X_UP;break;case"X_UP_TO_Y_UP":i=y.default.Axis.X_UP_TO_Y_UP;break;case"Y_UP_TO_X_UP":i=y.default.Axis.Y_UP_TO_X_UP}return null==i?e:y.default.Matrix4.multiplyTransformation(e,i,e)}(i,t.axis)),e._root.transform=i}else{var r=e.boundingSphere,o=y.default.Cartographic.fromCartesian(r.center),s=y.default.Cartesian3.fromRadians(o.longitude,o.latitude,0),l=y.default.Cartesian3.fromDegrees(t.x,t.y,t.z),u=y.default.Cartesian3.subtract(l,s,new y.default.Cartesian3);i=y.default.Matrix4.fromTranslation(u),e.modelMatrix=i}return i};var a,n=i(0),y=(a=n)&&a.__esModule?a:{default:a}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RectangularSensorPrimitive=void 0;var T=a(i(0)),D=a(i(104)),k=a(i(105)),O=a(i(106)),A=a(i(107));function a(e){return e&&e.__esModule?e:{default:e}}var L=T.default.BoundingSphere,R=T.default.Cartesian3,n=T.default.Color,h=T.default.combine,F=T.default.ComponentDatatype,r=T.default.defaultValue,o=T.default.defined,V=T.default.DeveloperError,N=T.default.Matrix4,s=T.default.PrimitiveType,I=T.default.Buffer,z=T.default.BufferUsage,l=T.default.DrawCommand,H=T.default.Pass,B=T.default.RenderState,j=T.default.ShaderProgram,W=T.default.ShaderSource,G=T.default.VertexArray,U=T.default.BlendingState,q=T.default.CullFace,u=T.default.Material,J=T.default.SceneMode,Z=T.default.VertexFormat,Y=T.default.Math,X=T.default.Matrix3,K=(N=T.default.Matrix4,T.default.JulianDate),p=Math.sin,Q=Math.cos,$=Math.tan,ee=Math.atan,te=(Math.asin,{position:0,normal:1});function c(e){var t=this;e=r(e,r.EMPTY_OBJECT),this.show=r(e.show,!0),this.slice=r(e.slice,32),this.modelMatrix=N.clone(e.modelMatrix,new N),this._modelMatrix=new N,this._computedModelMatrix=new N,this._computedScanPlaneModelMatrix=new N,this.radius=r(e.radius,Number.POSITIVE_INFINITY),this._radius=void 0,this.xHalfAngle=r(e.xHalfAngle,0),this._xHalfAngle=void 0,this.yHalfAngle=r(e.yHalfAngle,0),this._yHalfAngle=void 0,this.lineColor=r(e.lineColor,n.WHITE),this.showSectorLines=r(e.showSectorLines,!0),this.showSectorSegmentLines=r(e.showSectorSegmentLines,!0),this.showLateralSurfaces=r(e.showLateralSurfaces,!0),this.material=o(e.material)?e.material:u.fromType(u.ColorType),this._material=void 0,this._translucent=void 0,this.lateralSurfaceMaterial=o(e.lateralSurfaceMaterial)?e.lateralSurfaceMaterial:u.fromType(u.ColorType),this._lateralSurfaceMaterial=void 0,this._lateralSurfaceTranslucent=void 0,this.showDomeSurfaces=r(e.showDomeSurfaces,!0),this.domeSurfaceMaterial=o(e.domeSurfaceMaterial)?e.domeSurfaceMaterial:u.fromType(u.ColorType),this._domeSurfaceMaterial=void 0,this.showDomeLines=r(e.showDomeLines,!0),this.showIntersection=r(e.showIntersection,!0),this.intersectionColor=r(e.intersectionColor,n.WHITE),this.intersectionWidth=r(e.intersectionWidth,5),this.showThroughEllipsoid=r(e.showThroughEllipsoid,!1),this._showThroughEllipsoid=void 0,this.showScanPlane=r(e.showScanPlane,!0),this.scanPlaneColor=r(e.scanPlaneColor,n.WHITE),this.scanPlaneMode=r(e.scanPlaneMode,"horizontal"),this.scanPlaneRate=r(e.scanPlaneRate,10),this._scanePlaneXHalfAngle=0,this._scanePlaneYHalfAngle=0,this._time=K.now(),this._boundingSphere=new L,this._boundingSphereWC=new L,this._sectorFrontCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._sectorBackCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._sectorVA=void 0,this._sectorLineCommand=new l({owner:this,primitiveType:s.LINES,boundingVolume:this._boundingSphereWC}),this._sectorLineVA=void 0,this._sectorSegmentLineCommand=new l({owner:this,primitiveType:s.LINES,boundingVolume:this._boundingSphereWC}),this._sectorSegmentLineVA=void 0,this._domeFrontCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._domeBackCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._domeVA=void 0,this._domeLineCommand=new l({owner:this,primitiveType:s.LINES,boundingVolume:this._boundingSphereWC}),this._domeLineVA=void 0,this._scanPlaneFrontCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._scanPlaneBackCommand=new l({owner:this,primitiveType:s.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._scanRadialCommand=void 0,this._colorCommands=[],this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._uniforms={u_type:function(){return 0},u_xHalfAngle:function(){return t.xHalfAngle},u_yHalfAngle:function(){return t.yHalfAngle},u_radius:function(){return t.radius},u_showThroughEllipsoid:function(){return t.showThroughEllipsoid},u_showIntersection:function(){return t.showIntersection},u_intersectionColor:function(){return t.intersectionColor},u_intersectionWidth:function(){return t.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return t.lineColor}},this._scanUniforms={u_xHalfAngle:function(){return t._scanePlaneXHalfAngle},u_yHalfAngle:function(){return t._scanePlaneYHalfAngle},u_radius:function(){return t.radius},u_color:function(){return t.scanPlaneColor},u_showThroughEllipsoid:function(){return t.showThroughEllipsoid},u_showIntersection:function(){return t.showIntersection},u_intersectionColor:function(){return t.intersectionColor},u_intersectionWidth:function(){return t.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return t.lineColor}}}c.prototype.update=function(e){var t=e.mode;if(this.show&&t===J.SCENE3D){var i=!1,a=!1,n=!1,r=this.xHalfAngle,o=this.yHalfAngle;if(r<0||o<0)throw new V("halfAngle must be greater than or equal to zero.");if(0!=r&&0!=o){this._xHalfAngle===r&&this._yHalfAngle===o||(this._xHalfAngle=r,this._yHalfAngle=o,i=!0);var s=this.radius;if(s<0)throw new V("this.radius must be greater than or equal to zero.");var l=!1;this._radius!==s&&(l=!0,this._radius=s,this._boundingSphere=new L(R.ZERO,this.radius)),N.equals(this.modelMatrix,this._modelMatrix)&&!l||(N.clone(this.modelMatrix,this._modelMatrix),N.multiplyByUniformScale(this.modelMatrix,this.radius,this._computedModelMatrix),L.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC));var u=this.showThroughEllipsoid;this._showThroughEllipsoid!==this.showThroughEllipsoid&&(this._showThroughEllipsoid=u,a=!0);var c=this.material;this._material!==c&&(this._material=c,n=a=!0);var d=c.isTranslucent();if(this._translucent!==d&&(this._translucent=d,a=!0),this.showScanPlane){var h=e.time,f=K.secondsDifference(h,this._time);f<0&&(this._time=K.clone(h,this._time));var p,m=Math.max(f%this.scanPlaneRate/this.scanPlaneRate,0);if("horizontal"==this.scanPlaneMode){var g=Q(p=2*o*m-o),v=$(r),y=ee(g*v);this._scanePlaneXHalfAngle=y,this._scanePlaneYHalfAngle=p,T.default.Matrix3.fromRotationX(this._scanePlaneYHalfAngle,ie)}else{p=2*r*m-r;var _=$(o),w=Q(p),b=ee(w*_);this._scanePlaneXHalfAngle=p,this._scanePlaneYHalfAngle=b,T.default.Matrix3.fromRotationY(this._scanePlaneXHalfAngle,ie)}T.default.Matrix4.multiplyByMatrix3(this.modelMatrix,ie,this._computedScanPlaneModelMatrix),N.multiplyByUniformScale(this._computedScanPlaneModelMatrix,this.radius,this._computedScanPlaneModelMatrix)}i&&function(e,t){var i=t.context,a=ne(e,e.xHalfAngle,e.yHalfAngle),n=function(e,t){var i=e.xHalfAngle,a=e.yHalfAngle,n=t.zoy,r=t.zox,o=[],s=X.fromRotationY(i,ie);o.push(n.map(function(e){return X.multiplyByVector(s,e,new T.default.Cartesian3)}));s=X.fromRotationX(-a,ie);o.push(r.map(function(e){return X.multiplyByVector(s,e,new T.default.Cartesian3)}).reverse());s=X.fromRotationY(-i,ie);o.push(n.map(function(e){return X.multiplyByVector(s,e,new T.default.Cartesian3)}).reverse());s=X.fromRotationX(a,ie);return o.push(r.map(function(e){return X.multiplyByVector(s,e,new T.default.Cartesian3)})),o}(e,a);e.showLateralSurfaces&&(e._sectorVA=function(e,t){for(var i=Array.prototype.concat.apply([],t).length-t.length,a=new Float32Array(18*i),n=0,r=0,o=t.length;r<o;r++){var s=t[r],l=R.normalize(R.cross(s[0],s[s.length-1],ae),ae),u=0;for(i=s.length-1;u<i;u++)a[n++]=0,a[n++]=0,a[n++]=0,a[n++]=-l.x,a[n++]=-l.y,a[n++]=-l.z,a[n++]=s[u].x,a[n++]=s[u].y,a[n++]=s[u].z,a[n++]=-l.x,a[n++]=-l.y,a[n++]=-l.z,a[n++]=s[u+1].x,a[n++]=s[u+1].y,a[n++]=s[u+1].z,a[n++]=-l.x,a[n++]=-l.y,a[n++]=-l.z}var c=I.createVertexBuffer({context:e,typedArray:a,usage:z.STATIC_DRAW}),d=6*Float32Array.BYTES_PER_ELEMENT,h=[{index:te.position,vertexBuffer:c,componentsPerAttribute:3,componentDatatype:F.FLOAT,offsetInBytes:0,strideInBytes:d},{index:te.normal,vertexBuffer:c,componentsPerAttribute:3,componentDatatype:F.FLOAT,offsetInBytes:3*Float32Array.BYTES_PER_ELEMENT,strideInBytes:d}];return new G({context:e,attributes:h})}(i,n));e.showSectorLines&&(e._sectorLineVA=function(e,t){for(var i=t.length,a=new Float32Array(9*i),n=0,r=0,o=t.length;r<o;r++){var s=t[r];a[n++]=0,a[n++]=0,a[n++]=0,a[n++]=s[0].x,a[n++]=s[0].y,a[n++]=s[0].z}var l=I.createVertexBuffer({context:e,typedArray:a,usage:z.STATIC_DRAW}),u=3*Float32Array.BYTES_PER_ELEMENT,c=[{index:te.position,vertexBuffer:l,componentsPerAttribute:3,componentDatatype:F.FLOAT,offsetInBytes:0,strideInBytes:u}];return new G({context:e,attributes:c})}(i,n));e.showSectorSegmentLines&&(e._sectorSegmentLineVA=function(e,t){for(var i=Array.prototype.concat.apply([],t).length-t.length,a=new Float32Array(9*i),n=0,r=0,o=t.length;r<o;r++){var s=t[r],l=0;for(i=s.length-1;l<i;l++)a[n++]=s[l].x,a[n++]=s[l].y,a[n++]=s[l].z,a[n++]=s[l+1].x,a[n++]=s[l+1].y,a[n++]=s[l+1].z}var u=I.createVertexBuffer({context:e,typedArray:a,usage:z.STATIC_DRAW}),c=3*Float32Array.BYTES_PER_ELEMENT,d=[{index:te.position,vertexBuffer:u,componentsPerAttribute:3,componentDatatype:F.FLOAT,offsetInBytes:0,strideInBytes:c}];return new G({context:e,attributes:d})}(i,n));e.showDomeSurfaces&&(e._domeVA=function(e){var t=T.default.EllipsoidGeometry.createGeometry(new T.default.EllipsoidGeometry({vertexFormat:Z.POSITION_ONLY,stackPartitions:32,slicePartitions:32}));return G.fromGeometry({context:e,geometry:t,attributeLocations:te,bufferUsage:z.STATIC_DRAW,interleave:!1})}(i));e.showDomeLines&&(e._domeLineVA=function(e){var t=T.default.EllipsoidOutlineGeometry.createGeometry(new T.default.EllipsoidOutlineGeometry({vertexFormat:Z.POSITION_ONLY,stackPartitions:32,slicePartitions:32}));return G.fromGeometry({context:e,geometry:t,attributeLocations:te,bufferUsage:z.STATIC_DRAW,interleave:!1})}(i));if(e.showScanPlane)if("horizontal"==e.scanPlaneMode){var r=ne(e,Y.PI_OVER_TWO,0);e._scanPlaneVA=re(i,r.zox)}else{r=ne(e,0,Y.PI_OVER_TWO);e._scanPlaneVA=re(i,r.zoy)}}(this,e),a&&function(e,t,i){i?(e._frontFaceRS=B.fromCache({depthTest:{enabled:!t},depthMask:!1,blending:U.ALPHA_BLEND,cull:{enabled:!0,face:q.BACK}}),e._backFaceRS=B.fromCache({depthTest:{enabled:!t},depthMask:!1,blending:U.ALPHA_BLEND,cull:{enabled:!0,face:q.FRONT}}),e._pickRS=B.fromCache({depthTest:{enabled:!t},depthMask:!1,blending:U.ALPHA_BLEND})):(e._frontFaceRS=B.fromCache({depthTest:{enabled:!t},depthMask:!0}),e._pickRS=B.fromCache({depthTest:{enabled:!0},depthMask:!0}))}(this,u,d),n&&function(e,t,i){(function(e,t,i){var a=t.context,n=D.default,r=new W({sources:[O.default,i.shaderSource,k.default]});e._sp=j.replaceCache({context:a,shaderProgram:e._sp,vertexShaderSource:n,fragmentShaderSource:r,attributeLocations:te});var o=new W({sources:[O.default,i.shaderSource,k.default],pickColorQualifier:"uniform"});e._pickSP=j.replaceCache({context:a,shaderProgram:e._pickSP,vertexShaderSource:n,fragmentShaderSource:o,attributeLocations:te})})(e,t,i),e.showScanPlane&&function(e,t,i){var a=t.context,n=D.default,r=new W({sources:[O.default,i.shaderSource,A.default]});e._scanePlaneSP=j.replaceCache({context:a,shaderProgram:e._scanePlaneSP,vertexShaderSource:n,fragmentShaderSource:r,attributeLocations:te})}(e,t,i)}(this,e,c),(a||n)&&function(e,t){e._colorCommands.length=0;var i=t?H.TRANSLUCENT:H.OPAQUE;e.showLateralSurfaces&&oe(e,e._sectorFrontCommand,e._sectorBackCommand,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorVA,e._uniforms,e._computedModelMatrix,t,i);e.showSectorLines&&oe(e,e._sectorLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showSectorSegmentLines&&oe(e,e._sectorSegmentLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorSegmentLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showDomeSurfaces&&oe(e,e._domeFrontCommand,e._domeBackCommand,e._frontFaceRS,e._backFaceRS,e._sp,e._domeVA,e._uniforms,e._computedModelMatrix,t,i);e.showDomeLines&&oe(e,e._domeLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._domeLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showScanPlane&&oe(e,e._scanPlaneFrontCommand,e._scanPlaneBackCommand,e._frontFaceRS,e._backFaceRS,e._scanePlaneSP,e._scanPlaneVA,e._scanUniforms,e._computedScanPlaneModelMatrix,t,i)}(this,d);var C=e.commandList,x=e.passes,P=this._colorCommands;if(x.render)for(var M=0,E=P.length;M<E;M++){var S=P[M];C.push(S)}}}};var ie=new X,ae=new R;function ne(e,t,i){for(var a=e.slice,n=Q(i),r=$(i),o=Q(t),s=$(t),l=ee(o*r),u=ee(n*s),c=[],d=0;d<a;d++){var h=2*l*d/(a-1)-l;c.push(new R(0,p(h),Q(h)))}var f=[];for(d=0;d<a;d++){h=2*u*d/(a-1)-u;f.push(new R(p(h),0,Q(h)))}return{zoy:c,zox:f}}function re(e,t){for(var i=t.length-1,a=new Float32Array(9*i),n=0,r=0;r<i;r++)a[n++]=0,a[n++]=0,a[n++]=0,a[n++]=t[r].x,a[n++]=t[r].y,a[n++]=t[r].z,a[n++]=t[r+1].x,a[n++]=t[r+1].y,a[n++]=t[r+1].z;var o=I.createVertexBuffer({context:e,typedArray:a,usage:z.STATIC_DRAW}),s=3*Float32Array.BYTES_PER_ELEMENT,l=[{index:te.position,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:F.FLOAT,offsetInBytes:0,strideInBytes:s}];return new G({context:e,attributes:l})}function oe(e,t,i,a,n,r,o,s,l,u,c,d){u&&i&&(i.vertexArray=o,i.renderState=n,i.shaderProgram=r,i.uniformMap=h(s,e._material._uniforms),i.uniformMap.u_normalDirection=function(){return-1},i.pass=c,i.modelMatrix=l,e._colorCommands.push(i)),t.vertexArray=o,t.renderState=a,t.shaderProgram=r,t.uniformMap=h(s,e._material._uniforms),d&&(t.uniformMap.u_type=function(){return 1}),t.pass=c,t.modelMatrix=l,e._colorCommands.push(t)}t.RectangularSensorPrimitive=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RectangularSensorGraphics=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a};function o(e){this._show=void 0,this._radius=void 0,this._xHalfAngle=void 0,this._yHalfAngle=void 0,this._lineColor=void 0,this._showSectorLines=void 0,this._showSectorSegmentLines=void 0,this._showLateralSurfaces=void 0,this._material=void 0,this._showDomeSurfaces=void 0,this._showDomeLines=void 0,this._showIntersection=void 0,this._intersectionColor=void 0,this._intersectionWidth=void 0,this._showThroughEllipsoid=void 0,this._gaze=void 0,this._showScanPlane=void 0,this._scanPlaneColor=void 0,this._scanPlaneMode=void 0,this._scanPlaneRate=void 0,this._definitionChanged=new r.default.Event,this.merge(r.default.defaultValue(e,r.default.defaultValue.EMPTY_OBJECT))}r.default.defineProperties(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:r.default.createPropertyDescriptor("show"),radius:r.default.createPropertyDescriptor("radius"),xHalfAngle:r.default.createPropertyDescriptor("xHalfAngle"),yHalfAngle:r.default.createPropertyDescriptor("yHalfAngle"),lineColor:r.default.createPropertyDescriptor("lineColor"),showSectorLines:r.default.createPropertyDescriptor("showSectorLines"),showSectorSegmentLines:r.default.createPropertyDescriptor("showSectorSegmentLines"),showLateralSurfaces:r.default.createPropertyDescriptor("showLateralSurfaces"),material:r.default.createMaterialPropertyDescriptor("material"),showDomeSurfaces:r.default.createPropertyDescriptor("showDomeSurfaces"),showDomeLines:r.default.createPropertyDescriptor("showDomeLines "),showIntersection:r.default.createPropertyDescriptor("showIntersection"),intersectionColor:r.default.createPropertyDescriptor("intersectionColor"),intersectionWidth:r.default.createPropertyDescriptor("intersectionWidth"),showThroughEllipsoid:r.default.createPropertyDescriptor("showThroughEllipsoid"),gaze:r.default.createPropertyDescriptor("gaze"),showScanPlane:r.default.createPropertyDescriptor("showScanPlane"),scanPlaneColor:r.default.createPropertyDescriptor("scanPlaneColor"),scanPlaneMode:r.default.createPropertyDescriptor("scanPlaneMode"),scanPlaneRate:r.default.createPropertyDescriptor("scanPlaneRate")}),o.prototype.clone=function(e){return r.default.defined(e)||(e=new o),e.show=this.show,e.radius=this.radius,e.xHalfAngle=this.xHalfAngle,e.yHalfAngle=this.yHalfAngle,e.lineColor=this.lineColor,e.showSectorLines=this.showSectorLines,e.showSectorSegmentLines=this.showSectorSegmentLines,e.showLateralSurfaces=this.showLateralSurfaces,e.material=this.material,e.showDomeSurfaces=this.showDomeSurfaces,e.showDomeLines=this.showDomeLines,e.showIntersection=this.showIntersection,e.intersectionColor=this.intersectionColor,e.intersectionWidth=this.intersectionWidth,e.showThroughEllipsoid=this.showThroughEllipsoid,e.gaze=this.gaze,e.showScanPlane=this.showScanPlane,e.scanPlaneColor=this.scanPlaneColor,e.scanPlaneMode=this.scanPlaneMode,e.scanPlaneRate=this.scanPlaneRate,e},o.prototype.merge=function(e){if(!r.default.defined(e))throw new r.default.DeveloperError("source is required.");this.slice=r.default.defaultValue(this.slice,e.slice),this.show=r.default.defaultValue(this.show,e.show),this.radius=r.default.defaultValue(this.radius,e.radius),this.xHalfAngle=r.default.defaultValue(this.xHalfAngle,e.xHalfAngle),this.yHalfAngle=r.default.defaultValue(this.yHalfAngle,e.yHalfAngle),this.lineColor=r.default.defaultValue(this.lineColor,e.lineColor),this.showSectorLines=r.default.defaultValue(this.showSectorLines,e.showSectorLines),this.showSectorSegmentLines=r.default.defaultValue(this.showSectorSegmentLines,e.showSectorSegmentLines),this.showLateralSurfaces=r.default.defaultValue(this.showLateralSurfaces,e.showLateralSurfaces),this.material=r.default.defaultValue(this.material,e.material),this.showDomeSurfaces=r.default.defaultValue(this.showDomeSurfaces,e.showDomeSurfaces),this.showDomeLines=r.default.defaultValue(this.showDomeLines,e.showDomeLines),this.showIntersection=r.default.defaultValue(this.showIntersection,e.showIntersection),this.intersectionColor=r.default.defaultValue(this.intersectionColor,e.intersectionColor),this.intersectionWidth=r.default.defaultValue(this.intersectionWidth,e.intersectionWidth),this.showThroughEllipsoid=r.default.defaultValue(this.showThroughEllipsoid,e.showThroughEllipsoid),this.gaze=r.default.defaultValue(this.gaze,e.gaze),this.showScanPlane=r.default.defaultValue(this.showScanPlane,e.showScanPlane),this.scanPlaneColor=r.default.defaultValue(this.scanPlaneColor,e.scanPlaneColor),this.scanPlaneMode=r.default.defaultValue(this.scanPlaneMode,e.scanPlaneMode),this.scanPlaneRate=r.default.defaultValue(this.scanPlaneRate,e.scanPlaneRate)},t.RectangularSensorGraphics=o},function(e,t,i){"use strict";i(45),i(46);var a=G(i(0)),n=i(11),r=W(i(29)),o=i(47),s=W(i(31)),l=i(48),u=i(32),c=G(i(20)),d=W(i(19)),h=W(i(4)),f=W(i(41)),p=W(i(90)),m=W(i(1)),g=i(91),v=i(92),y=i(16),_=W(i(95)),w=W(i(7)),b=i(3),C=W(i(2)),x=W(i(6)),P=i(96),M=i(97),E=i(98),S=i(99),T=G(i(100)),D=G(i(101)),k=i(102),O=i(35),A=i(25),L=i(103),R=i(42),F=i(43),V=i(108),N=i(110),I=i(111),z=i(112),H=i(113),B=i(115),j=i(117);function W(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function G(e){return e&&e.__esModule?e:{default:e}}t.name="HchxGIS for Cesium三维地球框架",t.version="1.8.1",t.author="HCHX JJ",t.website="http://www.hchxtech.com",console.log("当前Cesium版本："+a.default.VERSION+" ， HchxGIS版本："+t.version),t.Class=n.Class,t.widget=r,t.widget.BaseWidget=o.BaseWidget,t.image=s.image,t.createMap=l.createMap,t.ViewerEx=u.ViewerEx,t.layer=c.default,t.pointconvert=d,t.util=h,t.util.tileset=f,t.matrix=p,t.point=m,t.FlowEcharts=g.FlowEcharts,t.MapVLayer=v.MapVLayer,t.Draw=y.Draw,t.draw={},t.draw.util=C,t.draw.event=w,t.draw.tooltip=b.message,t.draw.dragger=x,t.draw.attr=_,t.Measure=P.Measure,t.DivPoint=M.DivPoint,t.FlyLine=E.FlyLine,t.TilesEditor=S.TilesEditor,t.shaders={},t.shaders.Rain=T.default,t.shaders.Snow=D.default,t.CircleFadeMaterial=k.CircleFadeMaterial,t.CircleWaveMaterial=O.CircleWaveMaterial,t.LineFlowMaterial=A.LineFlowMaterial,t.TextMaterial=L.TextMaterial,t.AnimationLineMaterialProperty=A.LineFlowMaterial,t.ElliposidFadeMaterialProperty=k.CircleFadeMaterial,t.RectangularSensorPrimitive=R.RectangularSensorPrimitive,t.RectangularSensorGraphics=F.RectangularSensorGraphics,t.RectangularSensorVisualizer=V.RectangularSensorVisualizer;var U=a.default.DataSourceDisplay.defaultVisualizersCallback;a.default.DataSourceDisplay.defaultVisualizersCallback=function(e,t,i){var a=i.entities;return U(e,t,i).concat([new V.RectangularSensorVisualizer(e,a)])},t.analysi={},t.analysi.TerrainClipPlan=N.TerrainClipPlan,t.analysi.TilesetClipPlan=I.TilesetClipPlan,t.analysi.FloodByEntity=z.FloodByEntity,t.analysi.ViewShed3D=H.ViewShed3D,t.analysi.VideoShed3D=B.VideoShed3D,t.analysi.Underground=j.Underground},function(e,t){},function(e,t){},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseWidget=void 0;var a,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=i(5),l=(a=n)&&a.__esModule?a:{default:a},r=i(11),o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2)),s=i(30),c=i(29);var d=[];t.BaseWidget=r.Class.extend({viewer:null,options:{},config:{},path:"",isActivate:!1,isCreate:!1,initialize:function(e,t){this.viewer=t,this.config=e,this.path=e.path||"",this.init()},addCacheVersion:function(e){if(null==e)return e;var t=(0,c.getCacheVersion)();return t&&(-1==e.indexOf("?")?e+="?time="+t:-1==e.indexOf("time="+t)&&(e+="&time="+t)),e},activateBase:function(){var e=this;if(!this.isActivate){if(this.beforeActivate(),this.isActivate=!0,!this.isCreate){if(this.options.resources&&0<this.options.resources.length){for(var t=[],i=0;i<this.options.resources.length;i++){var a=this.options.resources[i];a=this._getUrl(a),-1==d.indexOf(a)&&t.push(a)}return d=d.concat(t),void s.Loader.async(t,function(){if(!e.create(function(){e._createWidgetView(),e.isCreate=!0})){if(e.config.createAtStart)return e.config.createAtStart=!1,e.isActivate=!1,void(e.isCreate=!0);e._createWidgetView(),e.isCreate=!0}})}if(this.create(function(){e._createWidgetView(),this.isCreate=!0}))return;if(e.config.createAtStart)return e.config.createAtStart=!1,e.isActivate=!1,void(e.isCreate=!0);this.isCreate=!0}return this._createWidgetView(),this}this.changeWidgetView(function(e){e._dom&&((0,l.default)(".layui-layer").each(function(){(0,l.default)(this).css("z-index",19891e3)}),(0,l.default)(e._dom).css("z-index",19891014))})},_createWidgetView:function(){var e=this.options.view;if(null==e)this._startActivate();else if(o.isArray(e)){this._viewcreate_allcount=e.length;for(var t=this._viewcreate_okcount=0;t<e.length;t++)this.createItemView(e[t])}else this._viewcreate_allcount=1,this._viewcreate_okcount=0,this.createItemView(e)},changeWidgetView:function(e){var t=this.options.view;if(null==t)return!1;if(o.isArray(t)){for(var i=!1,a=0;a<t.length;a++)i=i||e(t[a]);return i}return e(t)},createItemView:function(t){switch(t.type){default:case"window":this._openWindow(t);break;case"divwindow":this._openDivWindow(t);break;case"append":this._appendView(t);break;case"custom":var e=this._getUrl(t.url),i=this;t.open(e,function(e){i.winCreateOK(t,e),i._viewcreate_okcount++,i._viewcreate_okcount>=i._viewcreate_allcount&&i._startActivate(e)},this)}},_viewcreate_allcount:0,_viewcreate_okcount:0,_openWindow:function(i){var a=this,n=this._getUrl(i.url),e={type:2,content:[n,"no"],success:function(e){i._layerOpening=!1,i._dom=e;var t=window[e.find("iframe")[0].name];a.config.hasOwnProperty("visible")&&!a.config.visible&&(0,l.default)(e).hide(),layer.setTop(e),a.winCreateOK(i,t),a._viewcreate_okcount++,a._viewcreate_okcount>=a._viewcreate_allcount&&a._startActivate(e),t&&t.initWidgetView?t.initWidgetView(a):console.error(n+"页面没有定义function initWidgetView(widget)方法，无法初始化widget页面!")}};i._layerIdx,i._layerOpening=!0,i._layerIdx=layer.open(this._getWinOpt(i,e))},_openDivWindow:function(i){var e=this._getUrl(i.url),a=this;this.getHtml(e,function(e){var t={type:1,content:e,success:function(e){i._layerOpening=!1,i._dom=e,a.config.hasOwnProperty("visible")&&!a.config.visible&&(0,l.default)(e).hide(),layer.setTop(e),a.winCreateOK(i,e),a._viewcreate_okcount++,a._viewcreate_okcount>=a._viewcreate_allcount&&a._startActivate(e)}};i._layerOpening=!0,i._layerIdx=layer.open(a._getWinOpt(i,t))})},_getUrl:function(e){return(e=this.addCacheVersion(e)).startsWith("/")||e.startsWith(".")||e.startsWith("http")?e:this.path+e},_getWinOpt:function(e,t){var i=(0,c.getDefWindowOptions)(),a=l.default.extend(i,e.windowOptions);a=l.default.extend(a,this.config.windowOptions),e.windowOptions=a;var n=this,r=this._getWinSize(a),o={title:!a.noTitle&&(this.config.name||" "),area:r.area,offset:r.offset,shade:0,maxmin:!1,zIndex:layer.zIndex,end:function(){e._layerIdx=-1,e._dom=null,n.disableBase()},full:function(e){n.winFull(e)},min:function(e){n.winMin(e)},restore:function(e){n.winRestore(e)}},s=l.default.extend(o,a);return l.default.extend(s,t||{})},_getWinSize:function(e){var t=this.bfb2Number(e.width,document.documentElement.clientWidth,e),i=this.bfb2Number(e.height,document.documentElement.clientHeight,e),a="",n=e.position;if(n)if("string"==typeof n)a=n;else if("object"==(void 0===n?"undefined":u(n))){var r,o;if(n.hasOwnProperty("top")&&null!=n.top&&(r=this.bfb2Number(n.top,document.documentElement.clientHeight,e)),n.hasOwnProperty("bottom")&&null!=n.bottom){e._hasresize=!0;var s=this.bfb2Number(n.bottom,document.documentElement.clientHeight,e);null!=r?i=document.documentElement.clientHeight-r-s:r=document.documentElement.clientHeight-i-s}if(n.hasOwnProperty("left")&&null!=n.left&&(o=this.bfb2Number(n.left,document.documentElement.clientWidth,e)),n.hasOwnProperty("right")&&null!=n.right){e._hasresize=!0;var l=this.bfb2Number(n.right,document.documentElement.clientWidth,e);null!=o?t=document.documentElement.clientWidth-o-l:o=document.documentElement.clientWidth-t-l}null==r&&(r=(document.documentElement.clientHeight-i)/2),null==o&&(o=(document.documentElement.clientWidth-t)/2),a=[r+"px",o+"px"]}return e.hasOwnProperty("minHeight")&&i<e.minHeight&&(e._hasresize=!0,i=e.minHeight),e.hasOwnProperty("maxHeight")&&i>e.maxHeight&&(e._hasresize=!0,i=e.maxHeight),e.hasOwnProperty("minHeight")&&t<e.minWidth&&(e._hasresize=!0,t=e.minWidth),e.hasOwnProperty("maxWidth")&&t>e.maxWidth&&(e._hasresize=!0,t=e.maxWidth),{area:t&&i?[t+"px",i+"px"]:t+"px",offset:a}},bfb2Number:function(e,t,i){return"string"==typeof e&&-1!=e.indexOf("%")?(i._hasresize=!0,t*Number(e.replace("%",""))/100):e},_appendView:function(t){if(this.isCreate&&t._dom)(0,l.default)(t._dom).show({duration:500}),this._startActivate(t._dom);else{var e=this._getUrl(t.url),i=this;i.getHtml(e,function(e){t._dom=(0,l.default)(e).appendTo(t.parent||"body"),i.winCreateOK(t,e),i._viewcreate_okcount++,i._viewcreate_okcount>=i._viewcreate_allcount&&i._startActivate(e)})}},disableBase:function(){this.isActivate&&(this.beforeDisable(),this.changeWidgetView(function(e){return null!=e._layerIdx&&-1!=e._layerIdx?(e._layerOpening,layer.close(e._layerIdx),!0):("append"==e.type&&e._dom&&(0,l.default)(e._dom).hide({duration:1e3}),"custom"==e.type&&e.close&&e.close(),!1)})||(this.disable(),this.isActivate=!1))},setViewVisible:function(t){this.changeWidgetView(function(e){null!=e._layerIdx&&-1!=e._layerIdx?t?(0,l.default)("#layui-layer"+e._layerIdx).show():(0,l.default)("#layui-layer"+e._layerIdx).hide():"append"==e.type&&e._dom&&(t?(0,l.default)(e._dom).show():(0,l.default)(e._dom).hide())})},setViewCss:function(t){this.changeWidgetView(function(e){null!=e._layerIdx&&-1!=e._layerIdx?(0,l.default)("#layui-layer"+e._layerIdx).css(t):"append"==e.type&&e._dom&&(0,l.default)(e._dom).css(t)})},indexResize:function(){if(this.isActivate){var a=this;this.changeWidgetView(function(e){if(null!=e._layerIdx&&-1!=e._layerIdx&&null!=e.windowOptions&&e.windowOptions._hasresize){var t=a._getWinSize(e.windowOptions),i={width:t.area[0],height:t.area[1],top:t.offset[0],left:t.offset[1]};(0,l.default)(e._dom).attr("myTopLeft",!0),layer.style(e._layerIdx,i),"divwindow"==e.type&&layer.iframeAuto(e._layerIdx)}})}},_startActivate:function(e){this.activate(e),this.config.success&&this.config.success(this),this.isActivate||this.disableBase()},init:function(){},create:function(e){},beforeActivate:function(){},activate:function(e){},beforeDisable:function(){},disable:function(){},winCreateOK:function(e,t){},winFull:function(){},winMin:function(){},winRestore:function(){},getHtml:function(e,t){l.default.ajax({url:e,type:"GET",dataType:"html",timeout:0,success:function(e){t(e)}})}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createMap=createMap;var _Cesium=__webpack_require__(0),_Cesium2=_interopRequireDefault(_Cesium),_jquery=__webpack_require__(5),_jquery2=_interopRequireDefault(_jquery),_util2=__webpack_require__(4),_util=_interopRequireWildcard(_util2),_ViewerEx=__webpack_require__(32),_GaodePOIGeocoder=__webpack_require__(88),_layer=__webpack_require__(20),_alert=__webpack_require__(89);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function createMap(a){if((0,_alert.testTk)()){if(a.url)return _jquery2.default.ajax({type:"get",dataType:"json",url:a.url,timeout:0,success:function(t){t.serverURL&&(a.serverURL=t.serverURL);var i=initMap(t.map3d,a);a.success&&(a.urlWidget?_jquery2.default.ajax({type:"get",dataType:"json",url:a.urlWidget,timeout:0,success:function(e){a.success(i,t,e)}}):a.success(i,t,t))},error:function(e,t,i){console.log(a.url+"文件加载失败！"),_util.alert(a.url+"文件加载失败！")}}),null;var e=initMap(a.data,a);return a.success&&a.success(e,a.data),e}}function initMap(e,t){var i,a=t.id,n={animation:!1,timeline:!1,fullscreenButton:!0,vrButton:!1,geocoder:!1,sceneModePicker:!1,homeButton:!0,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!1,infoBox:!0,selectionIndicator:!1,shouldAnimate:!0,showRenderLoopErrors:!0,baseLayerPicker:!1,contextmenu:!0};for(var r in e)n[r]=e[r];if(n)for(var r in t)"id"!==r&&"success"!==r&&(n[r]=t[r]);_Cesium2.default.Ion&&(_Cesium2.default.Ion.defaultAccessToken=n.ionToken||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1NjM5MjMxOS1lMWVkLTQyNDQtYTM4Yi0wZjA4ZDMxYTlmNDMiLCJpZCI6MTQ4MiwiaWF0IjoxNTI4Njc3NDQyfQ.vVoSexHMqQhKK5loNCv6gCA5d5_z3wE2M0l_rWnIP_w"),_Cesium2.default.AnimationViewModel.defaultTicks=n.animationTicks||[.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600],!0===n.geocoder&&(n.geocoder=new _GaodePOIGeocoder.GaodePOIGeocoder(n.geocoderConfig)),n.terrain&&n.terrain.visible&&(i=getTerrainProvider(n.terrain,n.serverURL),n.terrainProvider=i);var o=!1;if(n.baseLayerPicker){if(!n.imageryProviderViewModels&&n.basemaps&&0<n.basemaps.length){var s=getImageryProviderArr(n.basemaps);n.imageryProviderViewModels=s.imageryProviderViewModels,n.selectedImageryProviderViewModel=s.imageryProviderViewModels[s.index]}n.terrainProviderViewModels||(n.terrainProviderViewModels=getTerrainProviderViewModelsArr(n.terrain,n.serverURL),n.selectedTerrainProviderViewModel=n.terrainProviderViewModels[1])}else null==n.imageryProvider&&(o=!0,n.imageryProvider=_Cesium2.default.createTileMapServiceImageryProvider({url:_Cesium2.default.buildModuleUrl("Assets/Textures/NaturalEarthII")}));var l=new _Cesium2.default.Viewer(a,n);if(o)for(var u=l.imageryLayers,c=u.length,d=0;d<c;d++){var h=u.get(0);u.remove(h,!0)}return n.geocoder&&(n.geocoder.viewer=l),delete n.geocoder,delete n.imageryProviderViewModels,delete n.selectedImageryProviderViewModel,delete n.terrainProviderViewModels,delete n.selectedTerrainProviderViewModel,delete n.terrainProvider,delete n.imageryProvider,l.hchx=new _ViewerEx.ViewerEx(l,n),i&&(l.hchx.terrainProvider=i),l.gisdata={config:l.hchx.config},l}function getTerrainProvider(e,t){return e.url&&(t&&(e.url=e.url.replace("$serverURL$",t)),e.url=e.url.replace("$hostname$",location.hostname).replace("$host$",location.host)),_util.getTerrainProvider(e)}function getImageryProviderArr(layersCfg){var providerViewModels=[],selectedIndex=0;window._temp_createImageryProvider=_layer.createImageryProvider;for(var i=0;i<layersCfg.length;i++){var item=layersCfg[i];if("group"!=item.type||null!=item.layers){item.visible&&(selectedIndex=providerViewModels.length);var funstr="window._temp_basemaps"+i+" = function () {                        var item = "+JSON.stringify(item)+';                        if (item.type == "group") {                            var arrVec = [];                            for (var index = 0; index < item.layers.length; index++) {                                var temp = window._temp_createImageryProvider(item.layers[index]);                                if (temp == null) continue;                                arrVec.push(temp);                            }                            return arrVec;                        }                        else {                            return window._temp_createImageryProvider(item);                        }                     }';eval(funstr);var imgModel=new _Cesium2.default.ProviderViewModel({name:item.name||"未命名",tooltip:item.name||"未命名",iconUrl:item.icon||"",creationFunction:eval("window._temp_basemaps"+i)});providerViewModels.push(imgModel)}}return{imageryProviderViewModels:providerViewModels,index:selectedIndex}}function getTerrainProviderViewModelsArr(e,t){return[new _Cesium2.default.ProviderViewModel({name:"无地形",iconUrl:_Cesium2.default.buildModuleUrl("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84标准椭球，即 EPSG:4326",category:"",creationFunction:function(){return new _Cesium2.default.EllipsoidTerrainProvider({ellipsoid:_Cesium2.default.Ellipsoid.WGS84})}}),new _Cesium2.default.ProviderViewModel({name:"中国地形",iconUrl:_Cesium2.default.buildModuleUrl("Widgets/Images/TerrainProviders/CesiumWorldTerrain.png"),tooltip:"火星科技 提供的高分辨率中国地形",category:"",creationFunction:function(){return getTerrainProvider(e,t)}}),new _Cesium2.default.ProviderViewModel({name:"全球地形",iconUrl:_Cesium2.default.buildModuleUrl("Widgets/Images/TerrainProviders/CesiumWorldTerrain.png"),tooltip:"Cesium官方 提供的高分辨率全球地形",category:"",creationFunction:function(){return _util.getTerrainProvider({type:"ion"})}})]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Evented=t.Events=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=i(11),l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));var n=t.Events={on:function(e,t,i){if("object"===(void 0===e?"undefined":o(e)))for(var a in e)this._on(a,e[a],t);else for(var n=0,r=(e=l.splitWords(e)).length;n<r;n++)this._on(e[n],t,i);return this},off:function(e,t,i){if(e)if("object"===(void 0===e?"undefined":o(e)))for(var a in e)this._off(a,e[a],t);else for(var n=0,r=(e=l.splitWords(e)).length;n<r;n++)this._off(e[n],t,i);else delete this._events;return this},_on:function(e,t,i){this._events=this._events||{};var a=this._events[e];a||(a=[],this._events[e]=a),i===this&&(i=void 0);for(var n={fn:t,ctx:i},r=a,o=0,s=r.length;o<s;o++)if(r[o].fn===t&&r[o].ctx===i)return;r.push(n)},_off:function(e,t,i){var a,n,r;if(this._events&&(a=this._events[e]))if(t){if(i===this&&(i=void 0),a)for(n=0,r=a.length;n<r;n++){var o=a[n];if(o.ctx===i&&o.fn===t)return o.fn=l.falseFn,this._firingCount&&(this._events[e]=a=a.slice()),void a.splice(n,1)}}else{for(n=0,r=a.length;n<r;n++)a[n].fn=l.falseFn;delete this._events[e]}},fire:function(e,t,i){if(!this.listens(e,i))return this;var a=l.extend({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var n=this._events[e];if(n){this._firingCount=this._firingCount+1||1;for(var r=0,o=n.length;r<o;r++){var s=n[r];s.fn.call(s.ctx||this,a)}this._firingCount--}}return i&&this._propagateEvent(a),this},listens:function(e,t){var i=this._events&&this._events[e];if(i&&i.length)return!0;if(t)for(var a in this._eventParents)if(this._eventParents[a].listens(e,t))return!0;return!1},once:function(e,t,i){if("object"===(void 0===e?"undefined":o(e))){for(var a in e)this.once(a,e[a],t);return this}var n=l.bind(function(){this.off(e,t,i).off(e,n,i)},this);return this.on(e,t,i).on(e,n,i)},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[l.stamp(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[l.stamp(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,l.extend({layer:e.target,propagatedFrom:e.target},e),!0)}};n.addEventListener=n.on,n.removeEventListener=n.clearAllEventListeners=n.off,n.addOneTimeEventListener=n.once,n.fireEvent=n.fire,n.hasEventListeners=n.listens;t.Evented=a.Class.extend(n)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditPoint=void 0;var a,n=i(0),r=((a=n)&&a.__esModule,function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6))),o=i(3),s=i(18);t.EditPoint=s.EditBase.extend({setPositions:function(e){this.entity.position.setValue(e)},bindDraggers:function(){var i=this;this.entity.draw_tooltip=o.message.dragger.def;r.createDragger(this.dataSource,{dragger:this.entity,onDrag:function(e,t){i.entity.position.setValue(t)}})},finish:function(){this.entity.draw_tooltip=null}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawBillboard=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(17),s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(14));t.DrawBillboard=o.DrawPoint.extend({type:"billboard",createFeature:function(e){this._positions_draw=null;var t=this,i={show:!1,position:new r.default.CallbackProperty(function(e){return t.getDrawPosition()},!1),billboard:s.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.billboard)},getAttrClass:function(){return s}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawLabel=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(17),s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(12));t.DrawLabel=o.DrawPoint.extend({type:"label",createFeature:function(e){this._positions_draw=null;var t=this,i={show:!1,position:new r.default.CallbackProperty(function(e){return t.getDrawPosition()},!1),label:s.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.label)},getAttrClass:function(){return s}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawModel=void 0;var a,n=i(0),s=(a=n)&&a.__esModule?a:{default:a},r=i(17),o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(24));t.DrawModel=r.DrawPoint.extend({type:"model",createFeature:function(e){this._positions_draw=null;var t=this,i={position:new s.default.CallbackProperty(function(e){return t.getDrawPosition()},!1),model:o.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return this.updateOrientation(e,t),o.style2Entity(e,t.model)},updateAttrForDrawing:function(){this.updateOrientation(this.entity.attribute.style,this.entity)},updateOrientation:function(e,t){var i=t.position.getValue();if(null!=i){var a=s.default.Math.toRadians(Number(e.heading||0)),n=s.default.Math.toRadians(Number(e.pitch||0)),r=s.default.Math.toRadians(Number(e.roll||0)),o=new s.default.HeadingPitchRoll(a,n,r);t.orientation=s.default.Transforms.headingPitchRollQuaternion(i,o)}},getAttrClass:function(){return o}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawCurve=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(8),s=i(10),l=i(55);t.DrawCurve=o.DrawPolyline.extend({type:"curve",_positions_show:null,getDrawPosition:function(){return this._positions_show},updateAttrForDrawing:function(){null==this._positions_draw||this._positions_draw.length<3?this._positions_show=this._positions_draw:this._positions_show=(0,s.line2curve)(this._positions_draw)},getEditClass:function(e){var t=new l.EditCurve(e,this.viewer,this.dataSource);return this._bindEdit(t)},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),this.entity._positions_draw=this._positions_draw,this.entity._positions_show=this._positions_show,t.polyline.positions=new r.default.CallbackProperty(function(e){return t._positions_show},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditCurve=void 0;var a,n=i(0),r=((a=n)&&a.__esModule,i(13)),o=i(10);t.EditCurve=r.EditPolyline.extend({changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw,this._positions_show=this.entity._positions_show||this.entity.polyline.positions.getValue()},updateAttrForEditing:function(){null==this._positions_draw||this._positions_draw.length<3?this._positions_show=this._positions_draw:(this._positions_show=(0,o.line2curve)(this._positions_draw),this.entity._positions_show=this._positions_show)},finish:function(){this.entity._positions_show=this._positions_show,this.entity._positions_draw=this._positions_draw}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawPolylineVolume=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(8),s=(i(1),u(i(33))),l=i(57);u(i(2));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawPolylineVolume=o.DrawPolyline.extend({type:"polylineVolume",_minPointNum:2,_maxPointNum:9999,createFeature:function(e){this._positions_draw=[],e.config?(this._minPointNum=e.config.minPointNum||2,this._maxPointNum=e.config.maxPointNum||9999):(this._minPointNum=2,this._maxPointNum=9999);var t=this,i={polylineVolume:s.style2Entity(e.style),attribute:e};return i.polylineVolume.positions=new r.default.CallbackProperty(function(e){return t.getDrawPosition()},!1),this.entity=this.dataSource.entities.add(i),this.entity._positions_draw=this._positions_draw,this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.polylineVolume)},updateAttrForDrawing:function(){},getEditClass:function(e){var t=new l.EditPolylineVolume(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return s},finish:function(){this.entity.editing=this.getEditClass(this.entity),this.entity.polylineVolume.positions=this.getDrawPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditPolylineVolume=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(13);i(10);t.EditPolylineVolume=o.EditPolyline.extend({changePositionsToCallback:function(){var t=this;this._positions_draw=this.entity.polylineVolume.positions.getValue(),this.entity.polylineVolume.positions=new r.default.CallbackProperty(function(e){return t.getPosition()},!1)},finish:function(){this.entity.polylineVolume.positions=this.getPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawCorridor=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(8),s=(i(1),u(i(59))),l=i(60);u(i(2));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawCorridor=o.DrawPolyline.extend({type:"corridor",_minPointNum:2,_maxPointNum:9999,createFeature:function(e){this._positions_draw=[],e.config?(this._minPointNum=e.config.minPointNum||2,this._maxPointNum=e.config.maxPointNum||9999):(this._minPointNum=2,this._maxPointNum=9999);var t=this,i={corridor:s.style2Entity(e.style),attribute:e};return i.corridor.positions=new r.default.CallbackProperty(function(e){return t.getDrawPosition()},!1),this.entity=this.dataSource.entities.add(i),this.entity._positions_draw=this._positions_draw,this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.corridor)},updateAttrForDrawing:function(){},getEditClass:function(e){var t=new l.EditCorridor(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return s},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),t._positions_draw=this.getDrawPosition(),t.corridor.positions=new r.default.CallbackProperty(function(e){return t._positions_draw},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.style2Entity=function(e,t){e=e||{},null==t&&(t={fill:!0});for(var i in e){var a=e[i];switch(i){default:t[i]=a;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new r.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(e.outlineOpacity||e.opacity||1);break;case"color":t.material=new r.default.Color.fromCssColorString(a||"#FFFF00").withAlpha(Number(e.opacity||1));break;case"cornerType":switch(a){case"BEVELED":t.cornerType=r.default.CornerType.BEVELED;break;case"MITERED":t.cornerType=r.default.CornerType.MITERED;break;case"ROUNDED":t.cornerType=r.default.CornerType.ROUNDED;break;default:t.cornerType=a}}}null==t.material&&(t.material=r.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.opacity||1)}));return t},t.getPositions=s,t.getCoordinates=l,t.toGeoJSON=function(e){var t=l(e);return{type:"Feature",properties:e.attribute||{},geometry:{type:"LineString",coordinates:t}}};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(2));function s(e){return e.corridor.positions.getValue()}function l(e){var t=s(e);return o.cartesians2lonlats(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditCorridor=void 0;var a,n=i(0),r=((a=n)&&a.__esModule,i(13));t.EditCorridor=r.EditPolyline.extend({changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw||this.entity.corridor.positions.getValue()},finish:function(){this.entity._positions_draw=this.getPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawPolygon=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(8),s=i(1),l=c(i(15)),u=i(26);c(i(2));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawPolygon=o.DrawPolyline.extend({type:"polygon",_minPointNum:3,_maxPointNum:9999,createFeature:function(e){this._positions_draw=[],e.config?(this._minPointNum=e.config.minPointNum||3,this._maxPointNum=e.config.maxPointNum||9999):(this._minPointNum=3,this._maxPointNum=9999);var t=this,i={polygon:l.style2Entity(e.style),attribute:e};return i.polygon.hierarchy=new r.default.CallbackProperty(function(e){return t.getDrawPosition()},!1),i.polyline={clampToGround:e.style.clampToGround,show:!1},this.entity=this.dataSource.entities.add(i),this.bindOutline(this.entity),this.entity},style2Entity:function(e,t){return l.style2Entity(e,t.polygon)},bindOutline:function(i){i.polyline.show=new r.default.CallbackProperty(function(e){return i.polygon.hierarchy.getValue().length<3||i.polygon.outline&&i.polygon.outline.getValue()&&i.polygon.outlineWidth&&1<i.polygon.outlineWidth.getValue()},!1),i.polyline.positions=new r.default.CallbackProperty(function(e){if(!i.polyline.show.getValue())return null;var t=i.polygon.hierarchy.getValue();return t.length<3?t:t.concat([t[0]])},!1),i.polyline.width=new r.default.CallbackProperty(function(e){return i.polygon.hierarchy.getValue().length<3?2:i.polygon.outlineWidth},!1),i.polyline.material=new r.default.ColorMaterialProperty(new r.default.CallbackProperty(function(e){return i.polygon.hierarchy.getValue().length<3?i.polygon.material.color.getValue():i.polygon.outlineColor.getValue()},!1))},updateAttrForDrawing:function(){var e=this.entity.attribute.style;if(e.extrudedHeight){var t=(0,s.getMaxHeight)(this.getDrawPosition());this.entity.polygon.extrudedHeight=t+Number(e.extrudedHeight)}},getEditClass:function(e){var t=new u.EditPolygon(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return l},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),t._positions_draw=this.getDrawPosition(),t.polygon.hierarchy=new r.default.CallbackProperty(function(e){return t._positions_draw},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawRectangle=void 0;var a,n=i(0),o=(a=n)&&a.__esModule?a:{default:a},r=i(8),s=i(1),l=c(i(34)),u=i(63);c(i(2));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawRectangle=r.DrawPolyline.extend({type:"rectangle",_minPointNum:2,_maxPointNum:2,getRectangle:function(){var e=this.getDrawPosition();return e.length<2?null:o.default.Rectangle.fromCartesianArray(e)},createFeature:function(e){this._positions_draw=[];var t=this,i={rectangle:l.style2Entity(e.style),attribute:e};return i.rectangle.coordinates=new o.default.CallbackProperty(function(e){return t.getRectangle()},!1),i.polyline={clampToGround:e.style.clampToGround,show:!1},this.entity=this.dataSource.entities.add(i),this.bindOutline(this.entity),this.entity},style2Entity:function(e,t){return l.style2Entity(e,t.rectangle)},bindOutline:function(r){r.polyline.show=new o.default.CallbackProperty(function(e){return r.rectangle.outline&&r.rectangle.outline.getValue()&&r.rectangle.outlineWidth&&1<r.rectangle.outlineWidth.getValue()},!1),r.polyline.positions=new o.default.CallbackProperty(function(e){if(!r.polyline.show.getValue())return null;var t=r._draw_positions,i=r.rectangle.height?r.rectangle.height.getValue():0,a=o.default.Rectangle.fromCartesianArray(t),n=o.default.Cartesian3.fromRadians(a.west,a.south,i);return[n,o.default.Cartesian3.fromRadians(a.east,a.south,i),o.default.Cartesian3.fromRadians(a.east,a.north,i),o.default.Cartesian3.fromRadians(a.west,a.north,i),n]},!1),r.polyline.width=new o.default.CallbackProperty(function(e){return r.rectangle.outlineWidth},!1),r.polyline.material=new o.default.ColorMaterialProperty(new o.default.CallbackProperty(function(e){return r.rectangle.outlineColor.getValue()},!1))},updateAttrForDrawing:function(){var e=this.entity.attribute.style;if(!e.clampToGround){var t=(0,s.getMaxHeight)(this.getDrawPosition());this.entity.rectangle.height=t,e.height=t,e.extrudedHeight&&(this.entity.rectangle.extrudedHeight=t+Number(e.extrudedHeight))}},getEditClass:function(e){var t=new u.EditRectangle(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return l},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),t._positions_draw=this._positions_draw,t.rectangle.coordinates=new o.default.CallbackProperty(function(e){return t._positions_draw.length<2?null:o.default.Rectangle.fromCartesianArray(t._positions_draw)},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditRectangle=void 0;var a,n=i(0),l=((a=n)&&a.__esModule,function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6))),r=(i(3),i(26)),u=i(1);t.EditRectangle=r.EditPolygon.extend({changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw},finish:function(){this.entity._positions_draw=this._positions_draw},isClampToGround:function(){return this.entity.attribute.style.clampToGround},bindDraggers:function(){for(var n=this,e=this.isClampToGround(),r=this.getPosition(),t=0,i=r.length;t<i;t++){var a=r[t];if(null!=this.entity.rectangle.height){var o=this.entity.rectangle.height.getValue();a=(0,u.setPositionsHeight)(a,o)}e&&(a=(0,u.updateHeightForClampToGround)(this.viewer,a));var s=l.createDragger(this.dataSource,{position:a,onDrag:function(e,t){if(null!=n.entity.rectangle.height){var i=n.entity.rectangle.height.getValue();t=(0,u.setPositionsHeight)(t,i),e.position=t}if(r[e.index]=t,n.heightDraggers&&0<n.heightDraggers.length){var a=n.entity.rectangle.extrudedHeight.getValue();n.heightDraggers[e.index].position=(0,u.setPositionsHeight)(t,a)}}});s.index=t,this.draggers.push(s)}this.entity.rectangle.extrudedHeight&&this.bindHeightDraggers(this.entity.rectangle)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawCircle=void 0;var a,n=i(0),o=(a=n)&&a.__esModule?a:{default:a},r=i(8),s=(i(1),u(i(7)),i(3),u(i(27))),l=i(65);function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawCircle=r.DrawPolyline.extend({type:"ellipse",_minPointNum:2,_maxPointNum:2,getShowPosition:function(){return this._positions_draw&&1<this._positions_draw.length?this._positions_draw[0]:null},createFeature:function(e){this._positions_draw=[],"ellipse"==e.type?this._maxPointNum=3:this._maxPointNum=2;var t=this,i={position:new o.default.CallbackProperty(function(e){return t.getShowPosition()},!1),ellipse:s.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.ellipse)},updateAttrForDrawing:function(e){if(this._positions_draw)if(e)this.addPositionsForRadius(this._positions_draw);else if(!(this._positions_draw.length<2)){var t=this.entity.attribute.style;if(!t.clampToGround){var i=this.formatNum(o.default.Cartographic.fromCartesian(this._positions_draw[0]).height,2);if(this.entity.ellipse.height=i,t.height=i,t.extrudedHeight){var a=i+Number(t.extrudedHeight);this.entity.ellipse.extrudedHeight=a}}var n,r=this.formatNum(o.default.Cartesian3.distance(this._positions_draw[0],this._positions_draw[1]),2);if(this.entity.ellipse.semiMinorAxis=r,3==this._maxPointNum)n=3==this._positions_draw.length?this.formatNum(o.default.Cartesian3.distance(this._positions_draw[0],this._positions_draw[2]),2):r,this.entity.ellipse.semiMajorAxis=n,t.semiMinorAxis=r,t.semiMajorAxis=n;else this.entity.ellipse.semiMajorAxis=r,t.radius=r}},addPositionsForRadius:function(e){this._positions_draw=[e];var t=this.entity.attribute.style,i=o.default.EllipseGeometryLibrary.computeEllipsePositions({center:e,semiMajorAxis:this.entity.ellipse.semiMajorAxis.getValue(),semiMinorAxis:this.entity.ellipse.semiMinorAxis.getValue(),rotation:o.default.Math.toRadians(Number(t.rotation||0)),granularity:2},!0,!1),a=new o.default.Cartesian3(i.positions[0],i.positions[1],i.positions[2]);if(this._positions_draw.push(a),3==this._maxPointNum){var n=new o.default.Cartesian3(i.positions[3],i.positions[4],i.positions[5]);this._positions_draw.push(n)}},getEditClass:function(e){var t=new l.EditCircle(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return s},finish:function(){var t=this.entity;t.editing=this.getEditClass(t),t._positions_draw=this._positions_draw,t.position=new o.default.CallbackProperty(function(e){return t._positions_draw&&0<t._positions_draw.length?t._positions_draw[0]:null},!1)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditCircle=void 0;var a,n=i(0),g=(a=n)&&a.__esModule?a:{default:a},v=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6)),y=i(3),r=i(26),_=i(1);t.EditCircle=r.EditPolygon.extend({changePositionsToCallback:function(){this._positions_draw=this.entity._positions_draw},finish:function(){this.entity._positions_draw=this._positions_draw},isClampToGround:function(){return this.entity.attribute.style.clampToGround},getPosition:function(){if(null!=this.entity.ellipse.height)for(var e=this.entity.ellipse.height.getValue(),t=0,i=this._positions_draw.length;t<i;t++)this._positions_draw[t]=(0,_.setPositionsHeight)(this._positions_draw[t],e);return this._positions_draw},bindDraggers:function(){var n=this,e=this.isClampToGround(),r=this.getPosition(),a=new g.default.Cartesian3,o=new g.default.Cartesian3,s=this.entity.attribute.style,t=r[0];e&&(t=(0,_.updateHeightForClampToGround)(this.viewer,t),r[0]=t);var i=v.createDragger(this.dataSource,{position:t,onDrag:function(e,t){if(g.default.Cartesian3.subtract(t,r[e.index],a),r[e.index]=t,!s.clampToGround){var i=n.formatNum(g.default.Cartographic.fromCartesian(t).height,2);n.entity.ellipse.height=i,s.height=i}g.default.Cartesian3.add(e.majorDragger.position.getValue(),a,o),e.majorDragger.position=o,e.minorDragger&&(g.default.Cartesian3.add(e.minorDragger.position.getValue(),a,o),e.minorDragger.position=o),null!=n.entity.attribute.style.extrudedHeight&&n.updateDraggers()}});i.index=0,this.draggers.push(i);var l=g.default.EllipseGeometryLibrary.computeEllipsePositions({center:t,semiMajorAxis:this.entity.ellipse.semiMajorAxis.getValue(),semiMinorAxis:this.entity.ellipse.semiMinorAxis.getValue(),rotation:g.default.Math.toRadians(Number(s.rotation||0)),granularity:2},!0,!1),u=new g.default.Cartesian3(l.positions[0],l.positions[1],l.positions[2]);e&&(u=(0,_.updateHeightForClampToGround)(this.viewer,u)),r[1]=u;var c=v.createDragger(this.dataSource,{position:u,type:v.PointType.EditAttr,tooltip:y.message.dragger.editRadius,onDrag:function(e,t){if(null!=n.entity.ellipse.height){var i=n.entity.ellipse.height.getValue();t=(0,_.setPositionsHeight)(t,i),e.position=t}r[e.index]=t;var a=n.formatNum(g.default.Cartesian3.distance(r[0],t),2);n.entity.ellipse.semiMajorAxis=a,s.radius?(n.entity.ellipse.semiMinorAxis=a,s.radius=a):s.semiMajorAxis=a,null!=n.entity.attribute.style.extrudedHeight&&n.updateDraggers()}});if(c.index=1,i.majorDragger=c,this.draggers.push(c),3==this._maxPointNum){var d=new g.default.Cartesian3(l.positions[3],l.positions[4],l.positions[5]);e&&(d=(0,_.updateHeightForClampToGround)(this.viewer,d)),r[2]=d;var h=v.createDragger(this.dataSource,{position:d,type:v.PointType.EditAttr,tooltip:y.message.dragger.editRadius,onDrag:function(e,t){if(null!=n.entity.ellipse.height){var i=n.entity.ellipse.height.getValue();t=(0,_.setPositionsHeight)(t,i),e.position=t}r[e.index]=t;var a=n.formatNum(g.default.Cartesian3.distance(r[0],t),2);n.entity.ellipse.semiMinorAxis=a,s.radius?(n.entity.ellipse.semiMajorAxis=a,s.radius=a):s.semiMinorAxis=a,null!=n.entity.attribute.style.extrudedHeight&&n.updateDraggers()}});h.index=2,i.minorDragger=h,this.draggers.push(h)}if(this.entity.ellipse.extrudedHeight){var f=this.entity.ellipse.extrudedHeight.getValue(),p=(t=(0,_.setPositionsHeight)(r[0],f),v.createDragger(this.dataSource,{position:t,onDrag:function(e,t){t=(0,_.setPositionsHeight)(t,n.entity.ellipse.height),r[0]=t,n.updateDraggers()}}));this.draggers.push(p);var m=3==this._maxPointNum?[r[1],r[2]]:[r[1]];this.bindHeightDraggers(this.entity.ellipse,m),this.heightDraggers.push(p)}}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawEllipsoid=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(8),s=(i(1),u(i(7)),i(3),u(i(36))),l=i(67);function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawEllipsoid=o.DrawPolyline.extend({type:"ellipsoid",_minPointNum:2,_maxPointNum:3,getShowPosition:function(){return this._positions_draw&&0<this._positions_draw.length?this._positions_draw[0]:null},createFeature:function(e){this._positions_draw=[];var t=this,i={position:new r.default.CallbackProperty(function(e){return t.getShowPosition()},!1),ellipsoid:s.style2Entity(e.style),attribute:e};return this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.ellipsoid)},updateAttrForDrawing:function(e){if(this._positions_draw)if(e)this.addPositionsForRadius(this._positions_draw);else if(!(this._positions_draw.length<2)){var t,i=this.entity.attribute.style,a=this.formatNum(r.default.Cartesian3.distance(this._positions_draw[0],this._positions_draw[1]),2);i.extentRadii=a,i.heightRadii=a,t=3==this._positions_draw.length?this.formatNum(r.default.Cartesian3.distance(this._positions_draw[0],this._positions_draw[2]),2):a,i.widthRadii=t,this.updateRadii(i)}},updateRadii:function(e){this.entity.ellipsoid.radii.setValue(new r.default.Cartesian3(e.extentRadii,e.widthRadii,e.heightRadii))},addPositionsForRadius:function(e){this._positions_draw=[e];var t=this.entity.attribute.style,i=r.default.EllipseGeometryLibrary.computeEllipsePositions({center:e,semiMajorAxis:Number(t.extentRadii),semiMinorAxis:Number(t.widthRadii),rotation:r.default.Math.toRadians(Number(t.rotation||0)),granularity:2},!0,!1),a=new r.default.Cartesian3(i.positions[0],i.positions[1],i.positions[2]);this._positions_draw.push(a);var n=new r.default.Cartesian3(i.positions[3],i.positions[4],i.positions[5]);this._positions_draw.push(n)},getEditClass:function(e){var t=new l.EditEllipsoid(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return s},finish:function(){this.entity.editing=this.getEditClass(this.entity),this.entity._positions_draw=this._positions_draw,this.entity.position=this.getShowPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditEllipsoid=void 0;var a,n=i(0),u=(a=n)&&a.__esModule?a:{default:a},c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6)),d=i(3),r=i(18),h=i(1);t.EditEllipsoid=r.EditBase.extend({_positions_draw:null,changePositionsToCallback:function(){this._positions_draw=this.entity.position.getValue()},finish:function(){this._positions_draw=null},updateRadii:function(e){var t=new u.default.Cartesian3(Number(e.extentRadii),Number(e.widthRadii),Number(e.heightRadii));this.entity.ellipsoid.radii.setValue(t)},bindDraggers:function(){var n=this,r=this.entity.attribute.style,e=this.entity.position.getValue(),t=c.createDragger(this.dataSource,{position:(0,h.addPositionsHeight)(e,r.heightRadii),onDrag:function(e,t){this._positions_draw=t,n.entity.position.setValue(t),n.updateDraggers()}});this.draggers.push(t);var i=u.default.EllipseGeometryLibrary.computeEllipsePositions({center:e,semiMajorAxis:Number(r.extentRadii),semiMinorAxis:Number(r.widthRadii),rotation:u.default.Math.toRadians(Number(r.rotation||0)),granularity:2},!0,!1),a=new u.default.Cartesian3(i.positions[0],i.positions[1],i.positions[2]),o=c.createDragger(this.dataSource,{position:a,type:c.PointType.EditAttr,tooltip:d.message.dragger.editRadius,onDrag:function(e,t){var i=u.default.Cartographic.fromCartesian(n._positions_draw).height;t=(0,h.setPositionsHeight)(t,i),e.position=t;var a=n.formatNum(u.default.Cartesian3.distance(n._positions_draw,t),2);r.extentRadii=a,n.updateRadii(r),n.updateDraggers()}});t.majorDragger=o,this.draggers.push(o);var s=new u.default.Cartesian3(i.positions[3],i.positions[4],i.positions[5]),l=c.createDragger(this.dataSource,{position:s,type:c.PointType.EditAttr,tooltip:d.message.dragger.editRadius,onDrag:function(e,t){var i=u.default.Cartographic.fromCartesian(n._positions_draw).height;t=(0,h.setPositionsHeight)(t,i),e.position=t;var a=n.formatNum(u.default.Cartesian3.distance(n._positions_draw,t),2);r.widthRadii=a,n.updateRadii(r),n.updateDraggers()}});t.minorDragger=l,this.draggers.push(l)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawWall=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(8),s=(i(1),u(i(37))),l=i(69);u(i(2));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.DrawWall=o.DrawPolyline.extend({type:"wall",_minPointNum:2,_maxPointNum:9999,createFeature:function(e){this._positions_draw=[],e.config?(this._minPointNum=e.config.minPointNum||2,this._maxPointNum=e.config.maxPointNum||9999):(this._minPointNum=2,this._maxPointNum=9999),this.maximumHeights=[],this.minimumHeights=[];var t=this,i={wall:s.style2Entity(e.style),attribute:e};return i.wall.positions=new r.default.CallbackProperty(function(e){return t.getDrawPosition()},!1),i.wall.minimumHeights=new r.default.CallbackProperty(function(e){return t.getMinimumHeights()},!1),i.wall.maximumHeights=new r.default.CallbackProperty(function(e){return t.getMaximumHeights()},!1),this.entity=this.dataSource.entities.add(i),this.entity},style2Entity:function(e,t){return s.style2Entity(e,t.wall)},maximumHeights:null,getMaximumHeights:function(e){return this.maximumHeights},minimumHeights:null,getMinimumHeights:function(e){return this.minimumHeights},updateAttrForDrawing:function(){var e=this.entity.attribute.style,t=this.getDrawPosition(),i=t.length;this.maximumHeights=new Array(i),this.minimumHeights=new Array(i);for(var a=0;a<i;a++){var n=r.default.Cartographic.fromCartesian(t[a]).height;this.minimumHeights[a]=n,this.maximumHeights[a]=n+Number(e.extrudedHeight)}},getEditClass:function(e){var t=new l.EditWall(e,this.viewer,this.dataSource);return t._minPointNum=this._minPointNum,t._maxPointNum=this._maxPointNum,this._bindEdit(t)},getAttrClass:function(){return s},finish:function(){this.entity.editing=this.getEditClass(this.entity),this.entity.wall.positions=this.getDrawPosition(),this.entity.wall.minimumHeights=this.getMinimumHeights(),this.entity.wall.maximumHeights=this.getMaximumHeights()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditWall=void 0;var a,n=i(0),h=(a=n)&&a.__esModule?a:{default:a},f=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(6)),p=i(3),r=i(13),m=i(1);t.EditWall=r.EditPolyline.extend({changePositionsToCallback:function(){var t=this;this._positions_draw=this.entity.wall.positions.getValue(),this.entity.wall.positions=new h.default.CallbackProperty(function(e){return t.getPosition()},!1),this.minimumHeights=this.entity.wall.minimumHeights.getValue(),this.entity.wall.minimumHeights=new h.default.CallbackProperty(function(e){return t.getMinimumHeights()},!1),this.maximumHeights=this.entity.wall.maximumHeights.getValue(),this.entity.wall.maximumHeights=new h.default.CallbackProperty(function(e){return t.getMaximumHeights()},!1)},maximumHeights:null,getMaximumHeights:function(e){return this.maximumHeights},minimumHeights:null,getMinimumHeights:function(e){return this.minimumHeights},updateAttrForEditing:function(){var e=this.entity.attribute.style,t=this.getPosition(),i=t.length;this.maximumHeights=new Array(i),this.minimumHeights=new Array(i);for(var a=0;a<i;a++){var n=h.default.Cartographic.fromCartesian(t[a]).height;this.minimumHeights[a]=n,this.maximumHeights[a]=n+Number(e.extrudedHeight)}},finish:function(){this.entity.wall.positions=this.getPosition()},bindDraggers:function(){for(var i=this,e=this.isClampToGround(),a=this.getPosition(),n=this.entity.attribute.style,r=a.length<this._maxPointNum,t=0,o=a.length;t<o;t++){var s=a[t],l=f.createDragger(this.dataSource,{position:s,clampToGround:e,onDrag:function(e,t){a[e.index]=t,i.heightDraggers&&0<i.heightDraggers.length&&(i.heightDraggers[e.index].position=(0,m.addPositionsHeight)(t,n.extrudedHeight)),r&&(0<e.index&&(i.draggers[2*e.index-1].position=h.default.Cartesian3.midpoint(t,a[e.index-1],new h.default.Cartesian3)),e.index<a.length-1&&(i.draggers[2*e.index+1].position=h.default.Cartesian3.midpoint(t,a[e.index+1],new h.default.Cartesian3)))}});if(l.index=t,this.draggers.push(l),r){var u=t+1;if(u<o){var c=h.default.Cartesian3.midpoint(s,a[u],new h.default.Cartesian3),d=f.createDragger(this.dataSource,{position:c,type:f.PointType.AddMidPoint,tooltip:p.message.dragger.addMidPoint,clampToGround:e,onDragStart:function(e,t){a.splice(e.index,0,t),i.updateAttrForEditing()},onDrag:function(e,t){a[e.index]=t},onDragEnd:function(e,t){i.updateDraggers()}});d.index=u,this.draggers.push(d)}}}this.bindHeightDraggers()},heightDraggers:null,bindHeightDraggers:function(){var n=this;this.heightDraggers=[];for(var r=this.getPosition(),o=this.entity.attribute.style,e=Number(o.extrudedHeight),t=0,i=r.length;t<i;t++){var a=(0,m.addPositionsHeight)(r[t],e),s=f.createDragger(this.dataSource,{position:a,type:f.PointType.MoveHeight,tooltip:p.message.dragger.moveHeight,onDrag:function(e,t){var i=h.default.Cartographic.fromCartesian(t).height;o.extrudedHeight=n.formatNum(i-n.minimumHeights[e.index],2);for(var a=0;a<r.length;a++)a!=e.index&&(n.heightDraggers[a].position=(0,m.addPositionsHeight)(r[a],o.extrudedHeight));n.updateAttrForEditing()}});s.index=t,this.draggers.push(s),this.heightDraggers.push(s)}}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawPModel=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(21),s=i(1),l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(24)),u=i(3),c=i(71);t.DrawPModel=o.DrawBase.extend({type:"point",createFeature:function(e){var t=this;this._positions_draw=r.default.Cartesian3.ZERO;var i=e.style,a=this.primitives.add(r.default.Model.fromGltf({url:i.modelUrl,modelMatrix:this.getModelMatrix(i),minimumPixelSize:i.minimumPixelSize||30}));return a.readyPromise.then(function(e){t.style2Entity(i,t.entity)}),a.attribute=e,this.entity=a,this.entity},getModelMatrix:function(e,t){var i=new r.default.HeadingPitchRoll(r.default.Math.toRadians(e.heading||0),r.default.Math.toRadians(e.pitch||0),r.default.Math.toRadians(e.roll||0)),a=r.default.Transforms.eastNorthUpToFixedFrame,n=r.default.Transforms.headingPitchRollToFixedFrame(t||this._positions_draw,i,this.viewer.scene.globe.ellipsoid,a);return e.scale&&r.default.Matrix4.multiplyByUniformScale(n,e.scale,n),n},style2Entity:function(e,t){return t.modelMatrix=this.getModelMatrix(e,t.position),l.style2Entity(e,t)},bindEvent:function(){var i=this;this.getHandler().setInputAction(function(e){var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.endPosition,i.entity);t&&(i._positions_draw=t,i.entity.modelMatrix=i.getModelMatrix(i.entity.attribute.style)),i.tooltip.showAt(e.endPosition,u.message.draw.point.start)},r.default.ScreenSpaceEventType.MOUSE_MOVE),this.getHandler().setInputAction(function(e){var t=(0,s.getCurrentMousePosition)(i.viewer.scene,e.position,i.entity);t&&(i._positions_draw=t,i.disable())},r.default.ScreenSpaceEventType.LEFT_CLICK)},getEditClass:function(e){var t=new c.EditPModel(e,this.viewer,this.dataSource);return this._bindEdit(t)},getAttrClass:function(){return l},finish:function(){this.entity.modelMatrix=this.getModelMatrix(this.entity.attribute.style),this.entity.editing=this.getEditClass(this.entity),this.entity.position=this.getDrawPosition()}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditPModel=void 0;var a,n=i(0),u=(a=n)&&a.__esModule?a:{default:a},c=o(i(6)),d=i(3),r=i(18),h=o(i(27)),f=i(1);function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.EditPModel=r.EditBase.extend({setPositions:function(e){this.entity.position=e,this.entity.modelMatrix=this.getModelMatrix()},getModelMatrix:function(e){var t=this.entity.attribute.style,i=new u.default.HeadingPitchRoll(u.default.Math.toRadians(t.heading||0),u.default.Math.toRadians(t.pitch||0),u.default.Math.toRadians(t.roll||0)),a=u.default.Transforms.eastNorthUpToFixedFrame,n=u.default.Transforms.headingPitchRollToFixedFrame(e||this.entity.position,i,this.viewer.scene.globe.ellipsoid,a);return t.scale&&u.default.Matrix4.multiplyByUniformScale(n,t.scale,n),n},bindDraggers:function(){if(this.entity.ready){l=this;this.entity.draw_tooltip=d.message.dragger.def;var e=c.createDragger(this.dataSource,{dragger:this.entity,onDrag:function(e,t){l.entity.position=t,l.entity.modelMatrix=l.getModelMatrix(t),l.updateDraggers()}}),n=this.entity.attribute.style,r=this.entity.position,t=u.default.Cartographic.fromCartesian(r).height,i=this.entity.boundingSphere.radius;this.entityAngle=this.dataSource.entities.add({name:"角度调整底部圆",position:new u.default.CallbackProperty(function(e){return l.entity.position},!1),ellipse:h.style2Entity({fill:!1,outline:!0,outlineColor:"#ffff00",outlineOpacity:.8,radius:i,height:t})});var a=this.getHeadingPosition(),o=c.createDragger(this.dataSource,{position:a,type:c.PointType.EditAttr,tooltip:d.message.dragger.editHeading,onDrag:function(e,t){var i=l.getHeading(l.entity.position,t);n.heading=l.formatNum(i,1),l.entity.modelMatrix=l.getModelMatrix(),e.position=l.getHeadingPosition()}});this.draggers.push(o);var s=(0,f.addPositionsHeight)(r,i);(e=c.createDragger(this.dataSource,{position:s,type:c.PointType.MoveHeight,tooltip:d.message.dragger.editScale,onDrag:function(e,t){var i=u.default.Cartesian3.distance(t,r),a=i/(e.radius/n.scale);e.radius=i,n.scale=l.formatNum(a,2),l.entity.modelMatrix=l.getModelMatrix(),l.updateDraggers()}})).radius=i,this.draggers.push(e)}else{var l=this;this.entity.readyPromise.then(function(e){l.bindDraggers()})}},destroyDraggers:function(){r.EditBase.prototype.destroyDraggers.call(this),this.entityAngle&&(this.dataSource.entities.remove(this.entityAngle),delete this.entityAngle),this.entityBox&&(this.dataSource.entities.remove(this.entityBox),delete this.entityBox)},finish:function(){this.entity.draw_tooltip=null},getHeadingPosition:function(){var e=this.entity.position,t=this.entity.boundingSphere.radius,i=-Number(this.entity.attribute.style.heading||0),a=new u.default.Cartesian3(t,0,0),n=u.default.Transforms.eastNorthUpToFixedFrame(e),r=u.default.Matrix4.fromRotationTranslation(u.default.Matrix3.fromRotationZ(u.default.Math.toRadians(i)));return u.default.Matrix4.multiply(n,r,n),n=u.default.Matrix4.getRotation(n,new u.default.Matrix3),a=u.default.Matrix3.multiplyByVector(n,a,a),a=u.default.Cartesian3.add(e,a,a)},getHeading:function(e,t){var i=u.default.Transforms.eastNorthUpToFixedFrame(e);i=u.default.Matrix4.getRotation(i,new u.default.Matrix3);var a=u.default.Matrix3.getColumn(i,0,new u.default.Cartesian3),n=u.default.Matrix3.getColumn(i,1,new u.default.Cartesian3),r=u.default.Matrix3.getColumn(i,2,new u.default.Cartesian3),o=u.default.Cartesian3.subtract(t,e,new u.default.Cartesian3);o=u.default.Cartesian3.cross(o,r,o),o=u.default.Cartesian3.cross(r,o,o),o=u.default.Cartesian3.normalize(o,o);var s=u.default.Cartesian3.angleBetween(a,o);return u.default.Cartesian3.angleBetween(n,o)>.5*Math.PI&&(s=2*Math.PI-s),-u.default.Math.toDegrees(s)}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};exports.isOnly=isOnly,exports.setEnable=setEnable,exports.getEnable=getEnable,exports.init=init,exports.show=show,exports.getPopupId=getPopupId,exports.close=close,exports.destroy=destroy,exports.getPopupForConfig=getPopupForConfig,exports.getPopup=getPopup;var _Cesium=__webpack_require__(0),_Cesium2=_interopRequireDefault(_Cesium),_jquery=__webpack_require__(5),_jquery2=_interopRequireDefault(_jquery),_point=__webpack_require__(1),_Util=__webpack_require__(2),Util=_interopRequireWildcard(_Util),viewer,handler;function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var objPopup={},_isOnly=!0,_enable=!0,lastShowFeature;function isOnly(e){_isOnly=e}function setEnable(e){(_enable=e)||close()}function getEnable(e){return _enable}function init(e){viewer=e;(0,_jquery2.default)("#"+viewer._container.id).append('<div id="pupup-all-view" ></div>'),(handler=new _Cesium2.default.ScreenSpaceEventHandler(viewer.scene.canvas)).setInputAction(mousePickingClick,_Cesium2.default.ScreenSpaceEventType.LEFT_CLICK),viewer.scene.postRender.addEventListener(bind2scene)}function mousePickingClick(e){if(removeFeature(),unHighlighPick(),_isOnly&&close(),_enable){var t=e.position,i=viewer.scene.pick(t);if(i&&_Cesium2.default.defined(i.id)&&i.id instanceof _Cesium2.default.Entity){var a=i.id;_Cesium2.default.defined(a.popup)&&show(a,c=(0,_point.getCurrentMousePosition)(viewer.scene,t),t),a.click&&"function"==typeof a.click&&a.click(a,t)}else{if(i&&_Cesium2.default.defined(i.tileset)&&_Cesium2.default.defined(i.getProperty)){for(var n={},r=i.getPropertyNames(),o=0;o<r.length;o++){var s=r[o];if(i.hasProperty(s)){var l=i.getProperty(s);null!=l&&(n[s]=l)}}var u=i.tileset._config;if(u){if(_Cesium2.default.defined(u.popup)){var c=(0,_point.getCurrentMousePosition)(viewer.scene,t);show({id:i._batchId,popup:{html:getPopupForConfig(u,n),anchor:u.popupAnchor||[0,-15]}},c,t)}return u.showClickFeature&&highlighPick(i,u.clickFeatureColor),void(u.click&&"function"==typeof u.click&&u.click({attr:n,feature:i},t))}}if(i&&_Cesium2.default.defined(i.primitive)){var d=i.primitive;_Cesium2.default.defined(d.popup)&&show(d,c=(0,_point.getCurrentMousePosition)(viewer.scene,t),t),d.click&&"function"==typeof d.click&&d.click(d,t)}else pickImageryLayerFeatures(t)}}}function pickImageryLayerFeatures(r){var e=viewer.scene,t=e.camera.getPickRay(r),i=e.imageryLayers.pickImageryLayerFeatures(t,e);_Cesium2.default.defined(i)&&_Cesium2.default.when(i,function(e){if(_Cesium2.default.defined(e)&&0!==e.length){var t=e[0];if(null!=t.imageryLayer&&null!=t.imageryLayer.config){var i=t.imageryLayer.config;i.showClickFeature&&t.data&&showFeature(t.data,i.pickFeatureStyle);var a=getPopupForConfig(t.imageryLayer.config,t.properties);if(a){var n=(0,_point.getCurrentMousePosition)(viewer.scene,r);show({id:"imageryLayerFeaturePromise",popup:{html:a,anchor:t.imageryLayer.config.popupAnchor||[0,-12]}},n,r)}i.click&&"function"==typeof i.click&&i.click(t.properties,r)}}},function(){})}function removeFeature(){null!=lastShowFeature&&(viewer.dataSources.remove(lastShowFeature),lastShowFeature=null)}function showFeature(e,t){removeFeature();var i=e;if(e.geometryType&&-1!=e.geometryType.indexOf("esri")){if(JSON.stringify(e.geometry).length<1e4){if(!(a=window.hchx3d.L||window.L).esri)return void console.log("需要引入 hchx-esri 插件解析arcgis标准的json数据！");i=hchx3d.L.esri.Util.arcgisToGeoJSON(e.geometry)}}else if(e.geometry&&e.geometry.type){var a;if(a=window.hchx3d.L||window.L)i=a.geoJSON(e.geometry,{coordsToLatLng:function(e){return 180<e[0]||e[0]<-180?a.CRS.EPSG3857.unproject(a.point(e[0],e[1])):new a.LatLng(e[1],e[0],e[2])}}).toGeoJSON()}null!=i&&(t=t||{},_Cesium2.default.GeoJsonDataSource.load(i,{clampToGround:!0,stroke:new _Cesium2.default.Color.fromCssColorString(t.stroke||"#ffff00"),strokeWidth:t.strokeWidth||3,fill:new _Cesium2.default.Color.fromCssColorString(t.fill||"#ffff00").withAlpha(t.fillAlpha||.7)}).then(function(e){viewer.dataSources.add(e),lastShowFeature=e}).otherwise(function(e){console.log(e)}))}var highlighted={feature:void 0,originalColor:new _Cesium2.default.Color},defaultHighlightedClr=new _Cesium2.default.Color.fromCssColorString("#95e40c");function unHighlighPick(){if(_Cesium2.default.defined(highlighted.feature)){try{highlighted.feature.color=highlighted.originalColor}catch(e){}highlighted.feature=void 0}}function highlighPick(e,t){unHighlighPick(),highlighted.feature=e,_Cesium2.default.Color.clone(e.color,highlighted.originalColor),t&&"string"==typeof t&&(t=new _Cesium2.default.Color.fromCssColorString(t)),e.color=t||defaultHighlightedClr}function show(t,i,a){if(null!=t&&null!=t.popup){var e,n=getPopupId(t);close(n),objPopup[n]={id:t.id,popup:t.popup,cartesian:i,viewPoint:a},(e="object"===_typeof(t.popup)?t.popup.html:t.popup)&&("function"==typeof e&&(e=e(t,i,function(e){_showHtml(e,n,t,i,a)})),e&&_showHtml(e,n,t,i,a))}}function _showHtml(e,t,i,a,n){(0,_jquery2.default)("#pupup-all-view").append('<div id="'+t+'" class="cesium-popup">            <a class="cesium-popup-close-button cesium-popup-color" href="javascript:viewer.hchx.popup.close(\''+t+'\',true)">×</a>            <div class="cesium-popup-content-wrapper cesium-popup-background">                <div class="cesium-popup-content cesium-popup-color">'+e+'</div>            </div>            <div class="cesium-popup-tip-container"><div class="cesium-popup-tip cesium-popup-background"></div></div>        </div>'),updateViewPoint(t,a,i.popup,n)||close(t)}function updateViewPoint(e,t,i,a){var n=_Cesium2.default.SceneTransforms.wgs84ToWindowCoordinates(viewer.scene,t);if(n&&(a=n,objPopup[e]&&(objPopup[e].viewPoint=n)),null==a)return console.log("wgs84ToWindowCoordinates无法转换为屏幕坐标"),!1;var r=viewer.scene;if(r.mode===_Cesium2.default.SceneMode.SCENE3D){var o=r.camera.getPickRay(a),s=r.globe.pick(o,r);if(s)if(1e6<_Cesium2.default.Cartesian3.distance(t,s))return!1}var l=(0,_jquery2.default)("#"+e),u=a.x-l.width()/2,c=a.y-l.height();return i&&"object"===(void 0===i?"undefined":_typeof(i))&&i.anchor&&(u+=i.anchor[0],c+=i.anchor[1]),l.css("transform","translate3d("+u+"px,"+c+"px, 0)"),!0}function bind2scene(){for(var e in objPopup){var t=objPopup[e];updateViewPoint(e,t.cartesian,t.popup,t.viewPoint)||close(e)}}function getPopupId(e){return"popup_"+((e.id||"")+"").replace(new RegExp("[^0-9a-zA-Z_]","gm"),"_")}function close(e,t){if(!_isOnly&&e){for(var i in"object"===(void 0===e?"undefined":_typeof(e))&&(e=getPopupId(e)),objPopup)if(e==objPopup[i].id||e==i){(0,_jquery2.default)("#"+i).remove(),delete objPopup[i];break}}else(0,_jquery2.default)("#pupup-all-view").empty(),objPopup={};t&&(removeFeature(),unHighlighPick())}function destroy(){close(),handler.destroy(),viewer.scene.postRender.removeEventListener(bind2scene)}function template(e,t){for(var i in t){var a=t[i];null!=a&&"Null"!=a&&"Unknown"!=a||(a=""),"_"==i.substr(0,1)&&(i=i.substring(1)),e=e.replace(new RegExp("{"+i+"}","gm"),a)}return e}function getAttrVal(e){try{var t={};if(e._propertyNames&&0<e._propertyNames.length){var i=!0,a=!1,n=void 0;try{for(var r,o=e._propertyNames[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=r.value;t[s]=e[s].getValue()}}catch(e){a=!0,n=e}finally{try{!i&&o.return&&o.return()}finally{if(a)throw n}}}else for(var l in e)"function"!=typeof e[l]&&(t[l]=e[l]);return t}catch(e){console.log(e)}return e}function getPopupForConfig(e,t){var i=e.popupNameField?t[e.popupNameField]:e.name;return e.popup?getPopup(e.popup,t,i):!!e.columns&&getPopup(e.columns,t,i)}function getPopup(cfg,attr,title){if(!attr)return!1;if(title=title||"",Util.isArray(cfg)){for(var countsok=0,inhtml='<div class="hchx-popup-titile">'+title+'</div><div class="hchx-popup-content" >',i=0;i<cfg.length;i++){var thisfield=cfg[i],col=thisfield.field;if(null!=col&&null!=attr[col]&&("object"===_typeof(attr[col])&&attr[col].hasOwnProperty&&attr[col].hasOwnProperty("getValue")&&(attr[col]=attr[col].getValue()),"function"!=typeof attr[col]))if("details"!=thisfield.type){var showval=_jquery2.default.trim(attr[col]);if(null!=showval&&""!=showval&&"Null"!=showval&&"Unknown"!=showval&&"0"!=showval&&0!=showval.length){if(thisfield.format)try{showval=eval(thisfield.format+"("+showval+")")}catch(e){console.log("getPopupByConfig error:"+thisfield.format)}thisfield.unit&&(showval+=thisfield.unit),inhtml+="<div><label>"+thisfield.name+"</label>"+showval+"</div>",countsok++}}else{var showval=_jquery2.default.trim(attr[col||"OBJECTID"]);if(null==showval||""==showval||"Null"==showval||"Unknown"==showval)continue;inhtml+='<div style="text-align: center;padding: 10px 0;"><button type="button" onclick="'+thisfield.calback+"('"+showval+'\');" " class="btn btn-info  btn-sm">'+(thisfield.name||"查看详情")+"</button></div>"}}return inhtml+="</div>",0!=countsok&&inhtml}if("object"!==(void 0===cfg?"undefined":_typeof(cfg))){if("function"==typeof cfg)return cfg(attr);if("all"!=cfg)return template(cfg,attr);var countsok=0,inhtml='<div class="hchx-popup-titile">'+title+'</div><div class="hchx-popup-content" >';for(var col in attr)try{if(null==col||null==attr[col])continue;if("Shape"==col||"FID"==col||"OBJECTID"==col||"_definitionChanged"==col||"_propertyNames"==col)continue;if("_"==col.substr(0,1)&&(col=col.substring(1)),"object"===_typeof(attr[col])&&attr[col].hasOwnProperty&&attr[col].hasOwnProperty("getValue")&&(attr[col]=attr[col].getValue()),"function"==typeof attr[col])continue;var showval=_jquery2.default.trim(attr[col]);if(null==showval||""==showval||"Null"==showval||"Unknown"==showval||"0"==showval||0==showval.length)continue;inhtml+="<div><label>"+col+"</label>"+showval+"</div>",countsok++}catch(e){console.log(e)}return inhtml+="</div>",0!=countsok&&inhtml}switch(cfg.type){case"iframe":var _url=_util.template(cfg.url,attr),inhtml='<iframe id="ifarm" src="'+_url+'"  style="width:'+(cfg.width||"300")+"px;height:"+(cfg.height||"300")+'px;overflow:hidden;margin:0;" scrolling="no" frameborder="0" ></iframe>';return inhtml;case"javascript":return eval(cfg.calback+"("+JSON.stringify(getAttrVal(attr))+")")}return!1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.init=function(e){u=e;(0,d.default)("#"+u._container.id).append('<div id="tooltip-view" class="cesium-popup" style="display:none;">     <div class="cesium-popup-content-wrapper  cesium-popup-background">         <div id="tooltip-content" class="cesium-popup-content cesium-popup-color"></div>     </div>     <div class="cesium-popup-tip-container"><div class="cesium-popup-tip  cesium-popup-background"></div></div></div> '),(a=new c.default.ScreenSpaceEventHandler(u.scene.canvas)).setInputAction(h,c.default.ScreenSpaceEventType.MOUSE_MOVE)},t.show=f,t.close=p,t.destroy=function(){p(),a.destroy()};var u,a,r,o,c=n(i(0)),d=n(i(5)),s=i(1);function n(e){return e&&e.__esModule?e:{default:e}}function h(e){if((0,d.default)(".cesium-viewer").css("cursor",""),!1!==u.scene.screenSpaceCameraController.enableRotate&&!1!==u.scene.screenSpaceCameraController.enableTilt&&!1!==u.scene.screenSpaceCameraController.enableTranslate){var t,i=e.endPosition,a=u.scene.pick(i);if(a&&c.default.defined(a.id)&&a.id instanceof c.default.Entity?t=a.id:a&&c.default.defined(a.primitive)&&(t=a.primitive),t)if((t.popup||t.click||t.cursorCSS)&&(0,d.default)(".cesium-viewer").css("cursor",t.cursorCSS||"pointer"),t.noMouseMove||(clearTimeout(o),o=setTimeout(function(){!function(e,t){if(r===e)return;m(),e.mouseover&&"function"==typeof e.mouseover&&e.mouseover(e,t);r=e}(t,i)},20)),t.tooltip){var n=(0,s.getCurrentMousePosition)(u.scene,i);f(t,n,i)}else p();else p(),clearTimeout(o),o=setTimeout(m,20)}else p()}function f(e,t,i){if(null!=e&&null!=e.tooltip)if(null==i&&(i=c.default.SceneTransforms.wgs84ToWindowCoordinates(u.scene,t)),null!=i){var a,n=(0,d.default)("#tooltip-view");if("object"===l(e.tooltip)){if(a=e.tooltip.html,e.tooltip.check&&!e.tooltip.check())return void p()}else a=e.tooltip;if("function"==typeof a&&(a=a(e,t)),a){(0,d.default)("#tooltip-content").html(a),n.show();var r=i.x-n.width()/2,o=i.y-n.height(),s=e.tooltip;s&&"object"===(void 0===s?"undefined":l(s))&&s.anchor?(r+=s.anchor[0],o+=s.anchor[1]):o-=15,n.css("transform","translate3d("+r+"px,"+o+"px, 0)")}}else p()}function p(){(0,d.default)("#tooltip-content").empty(),(0,d.default)("#tooltip-view").hide()}function m(){null!=r&&(r.mouseout&&"function"==typeof r.mouseout&&r.mouseout(r),r=null)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultContextmenuItems=void 0,t.init=function(e){n=e;(0,l.default)("#"+n._container.id).append('<div id="hchx-contextmenu" class="hchx-contextmenu open" style="display:none;">\n            <ul id="hchx-contextmenu-ul" class="dropdown-menu hchx-contextmenu-ul"> \n            </ul>\n        </div>'),(a=new r.default.ScreenSpaceEventHandler(n.scene.canvas)).setInputAction(f,r.default.ScreenSpaceEventType.LEFT_DOWN),a.setInputAction(f,r.default.ScreenSpaceEventType.MIDDLE_DOWN),a.setInputAction(f,r.default.ScreenSpaceEventType.RIGHT_DOWN),a.setInputAction(f,r.default.ScreenSpaceEventType.PINCH_START),a.setInputAction(f,r.default.ScreenSpaceEventType.WHEEL),a.setInputAction(function(e){f();var t,i=e.position,a=n.scene.pick(i);a&&r.default.defined(a.id)&&a.id instanceof r.default.Entity?h((t=a.id).contextmenuItems,i,t):a&&r.default.defined(a.primitive)&&(t=a.primitive).contextmenuItems?h(t.contextmenuItems,i,t):h(n.hchx.contextmenuItems,i)},r.default.ScreenSpaceEventType.RIGHT_CLICK)},t.show=h;var n,a,r=d(i(0)),l=d(i(5)),o=c(i(1)),s=c(i(4)),u=c(i(38));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{default:e}}t.defaultContextmenuItems=[{text:"俯视",iconCls:"fa fa-chevron-circle-down",calback:function(e){var t=o.getCurrentMousePosition(n.scene,e.position),i=r.default.Cartesian3.distance(n.camera.position,t),a=o.setPositionsHeight(t,i);n.camera.position=a,n.camera.setView({orientation:{heading:n.camera.heading,pitch:r.default.Math.toRadians(-90),roll:n.camera.roll}})}},{text:"显示此处经纬度",iconCls:"fa fa-info-circle",calback:function(e){var t=o.getCurrentMousePosition(n.scene,e.position),i=o.formatPositon(t),a="经度："+i.x+" , 纬度："+i.y+"<br/>高程："+i.z;s.alert(a,"位置信息")}},{text:"显示当前视角信息",iconCls:"fa fa-camera-retro",calback:function(e){var t=o.getCameraView(n);s.alert(JSON.stringify(t)+"<br/>提示：可用viewer.hchx.centerAt方法调用","视角信息")}},{text:"开启光照效果",iconCls:"fa fa-bullseye",visible:function(){return!n.shadows},calback:function(e){n.shadows=!0,n.terrainShadows=r.default.ShadowMode.ENABLED,n.scene.globe.enableLighting=!0}},{text:"关闭光照效果",iconCls:"fa fa-sun-o",visible:function(){return n.shadows},calback:function(e){n.shadows=!1,n.terrainShadows=r.default.ShadowMode.RECEIVE_ONLY,n.scene.globe.enableLighting=!1}},{text:"开启深度监测",iconCls:"fa fa-eye-slash",visible:function(){return!n.scene.globe.depthTestAgainstTerrain},calback:function(e){n.scene.globe.depthTestAgainstTerrain=!0}},{text:"关闭深度监测",iconCls:"fa fa-eye",visible:function(){return n.scene.globe.depthTestAgainstTerrain},calback:function(e){n.scene.globe.depthTestAgainstTerrain=!1}},{text:"开启键盘控制",iconCls:"fa fa-keyboard-o",visible:function(){return!u.isEnable()},calback:function(e){u.bind(n)}},{text:"关闭键盘控制",iconCls:"fa fa-hand-o-right",visible:function(){return u.isEnable()},calback:function(e){u.unbind(n)}},{text:"绕此处环绕飞行",iconCls:"fa fa-retweet",visible:function(){return!o.windingPoint.isStart},calback:function(e){var t=o.getCurrentMousePosition(n.scene,e.position);o.windingPoint.start(n,t)}},{text:"关闭环绕飞行",iconCls:"fa fa-remove",visible:function(){return o.windingPoint.isStart},calback:function(e){o.windingPoint.stop()}},{text:"移动到此处",iconCls:"fa fa-send-o",calback:function(e){var t=o.getCurrentMousePosition(n.scene,e.position),i=n.scene.camera.positionCartographic.height;5e3<i&&(i=5e3),n.camera.lookAt(t,new r.default.HeadingPitchRange(n.camera.heading,n.camera.pitch,i)),n.camera.lookAtTransform(r.default.Matrix4.IDENTITY)}},{text:"第一视角站到此处",iconCls:"fa fa-street-view",calback:function(e){var t=o.getCurrentMousePosition(n.scene,e.position);n.camera.flyTo({destination:o.addPositionsHeight(t,10),orientation:{heading:r.default.Math.toRadians(0),pitch:r.default.Math.toRadians(10),roll:r.default.Math.toRadians(0)}})}}];function h(a,n,r){if(a&&0!=a.length){for(var e="",t=0,i=a.length;t<i;t++){var o=a[t];if(o.hasOwnProperty("visible")){var s=o.visible;if("function"==typeof s&&(s=o.visible()),!s)continue}o.text?e+='<li class="contextmenu-item" data-index="'+t+'"><a href="javascript:void(0)"><i class="'+o.iconCls+'"></i>'+o.text+"</a></li>":e+='<li class="line"></li>'}""!=e?((0,l.default)("#hchx-contextmenu-ul").html(e),(0,l.default)("#hchx-contextmenu-ul .contextmenu-item").click(function(e){var t=Number((0,l.default)(this).attr("data-index")),i=a[t];i&&i.calback&&i.calback({position:n,data:i,target:r}),f()}),(0,l.default)("#hchx-contextmenu").css({top:n.y+10,left:n.x+10}).show()):f()}else f()}function f(){(0,l.default)("#hchx-contextmenu").hide()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupLayer=void 0;var a=i(9).BaseLayer.extend({create:function(){for(var e=this.config._layers,t=0,i=e.length;t<i;t++)this.hasOpacity=e[t].hasOpacity,this.hasZIndex=e[t].hasZIndex},setVisible:function(e){this._visible=e;for(var t=this.config._layers,i=0,a=t.length;i<a;i++)t[i].setVisible(e)},add:function(){this._visible=!0;for(var e=this.config._layers,t=0,i=e.length;t<i;t++)e[t].setVisible(!0)},remove:function(){this._visible=!1;for(var e=this.config._layers,t=0,i=e.length;t<i;t++)e[t].setVisible(!1)},centerAt:function(e){for(var t=this.config._layers,i=0,a=t.length;i<a;i++)t[i].centerAt(e)},setOpacity:function(e){for(var t=this.config._layers,i=0,a=t.length;i<a;i++)t[i].hasOpacity&&t[i].setOpacity(e)}});t.GroupLayer=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraticuleLayer=void 0;var a,n=i(0),_=(a=n)&&a.__esModule?a:{default:a};var r=i(9).BaseLayer.extend({model:null,add:function(){null==this.model&&this.initData(),this.model.setVisible(!0)},remove:function(){null!=this.model&&this.model.setVisible(!1)},initData:function(){function e(e,t){e=e||{},this._tilingScheme=e.tilingScheme||new _.default.GeographicTilingScheme,this._color=e.color||new _.default.Color(1,1,1,.4),this._tileWidth=e.tileWidth||256,this._tileHeight=e.tileHeight||256,this._ready=!0,this._sexagesimal=e.sexagesimal||!1,this._numLines=e.numLines||50,this._scene=t,this._labels=new _.default.LabelCollection,t.primitives.add(this._labels),this._polylines=new _.default.PolylineCollection,t.primitives.add(this._polylines),this._ellipsoid=t.globe.ellipsoid;var i=document.createElement("canvas");i.width=256,i.height=256,this._canvas=i;var a=this;t.camera.moveEnd.addEventListener(function(){a._show&&(a._polylines.removeAll(),a._labels.removeAll(),a._currentExtent=null,a._drawGrid(a._getExtentView()))}),t.imageryLayers.addImageryProvider(this)}var t=function(){try{return"x"in Object.defineProperty({},"x",{})}catch(e){return!1}}(),i=Object.defineProperties;function v(e){return e<.01?2:e<.1?1:0}t&&i||(i=function(e){return e}),i(e.prototype,{url:{get:function(){}},proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return 18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),e.prototype.makeLabel=function(e,t,i,a,n){this._labels.add({position:this._ellipsoid.cartographicToCartesian(new _.default.Cartographic(e,t,10)),text:i,font:"normal small-caps normal 16px 楷体",style:_.default.LabelStyle.FILL_AND_OUTLINE,fillColor:_.default.Color.AZURE,outlineColor:_.default.Color.BLACK,outlineWidth:2,pixelOffset:new _.default.Cartesian2(5,a?5:-5),eyeOffset:_.default.Cartesian3.ZERO,horizontalOrigin:_.default.HorizontalOrigin.LEFT,verticalOrigin:a?_.default.VerticalOrigin.BOTTOM:_.default.VerticalOrigin.TOP,scale:1})},e.prototype._drawGrid=function(e){if(!this._currentExtent||!this._currentExtent.equals(e)){this._currentExtent=e,this._polylines.removeAll(),this._labels.removeAll();this._canvasSize;var t,i=0,a=0;for(t=0;t<y.length&&i<(e.north-e.south)/10;t++)i=y[t];for(t=0;t<y.length&&a<(e.east-e.west)/10;t++)a=y[t];var n=(e.west<0?Math.ceil(e.west/a):Math.floor(e.west/a))*a,r=(e.south<0?Math.ceil(e.south/i):Math.floor(e.south/i))*i,o=(e.east<0?Math.ceil(e.east/i):Math.floor(e.east/i))*i,s=(e.north<0?Math.ceil(e.north/a):Math.floor(e.north/a))*a;n=Math.max(n-2*a,-Math.PI),o=Math.min(o+2*a,Math.PI),r=Math.max(r-2*i,-Math.PI/2),s=Math.min(s+2*a,Math.PI/2);var l,u,c=this._ellipsoid,d=_.default.Math.toRadians(1),h=r+Math.floor((s-r)/i/2)*i;for(u=n;u<o;u+=a){var f=[];for(l=r;l<s;l+=d)f.push(new _.default.Cartographic(u,l));f.push(new _.default.Cartographic(u,s)),this._polylines.add({positions:c.cartographicArrayToCartesianArray(f),width:1});var p=_.default.Math.toDegrees(u);this.makeLabel(u,h,this._sexagesimal?this._decToSex(p):p.toFixed(v(a)),!1)}var m=n+Math.floor((o-n)/a/2)*a;for(l=r;l<s;l+=i){f=[];for(u=n;u<o;u+=d)f.push(new _.default.Cartographic(u,l));f.push(new _.default.Cartographic(o,l)),this._polylines.add({positions:c.cartographicArrayToCartesianArray(f),width:1});var g=_.default.Math.toDegrees(l);this.makeLabel(m,l,this._sexagesimal?this._decToSex(g):g.toFixed(v(i)),!0)}}},e.prototype.requestImage=function(e,t,i){return this._show&&this._drawGrid(this._getExtentView()),this._canvas},e.prototype.setVisible=function(e){(this._show=e)?(this._currentExtent=null,this._drawGrid(this._getExtentView())):(this._polylines.removeAll(),this._labels.removeAll())},e.prototype.isVisible=function(){return this._show},e.prototype._decToSex=function(e){var t=Math.floor(e),i=(60*(Math.abs(e)-t)).toFixed(2);return"60.00"==i&&(t+=1,i="0.00"),[t,":",i].join("")},e.prototype._getExtentView=function(){for(var e=this._scene.camera,t=this._scene.canvas,i=[e.pickEllipsoid(new _.default.Cartesian2(0,0),this._ellipsoid),e.pickEllipsoid(new _.default.Cartesian2(t.width,0),this._ellipsoid),e.pickEllipsoid(new _.default.Cartesian2(0,t.height),this._ellipsoid),e.pickEllipsoid(new _.default.Cartesian2(t.width,t.height),this._ellipsoid)],a=0;a<4;a++)if(void 0===i[a])return _.default.Rectangle.MAX_VALUE;return _.default.Rectangle.fromCartographicArray(this._ellipsoid.cartesianArrayToCartographicArray(i))};var y=[_.default.Math.toRadians(.05),_.default.Math.toRadians(.1),_.default.Math.toRadians(.2),_.default.Math.toRadians(.5),_.default.Math.toRadians(1),_.default.Math.toRadians(2),_.default.Math.toRadians(5),_.default.Math.toRadians(10)];this.model=new e({numLines:10},this.viewer.scene)}});t.GraticuleLayer=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureGridLayer=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a};var o=i(39).TileLayer.extend({dataSource:null,hasOpacity:!1,create:function(){this.dataSource=new r.default.CustomDataSource,this.primitives=new r.default.PrimitiveCollection;var t=this;this.config.type_new="custom_featuregrid",this.config.addImageryCache=function(e){return t._addImageryCache(e)},this.config.removeImageryCache=function(e){return t._removeImageryCache(e)},this.config.removeAllImageryCache=function(e){return t._removeAllImageryCache(e)}},getLength:function(){return this.primitives.length+this.dataSource.entities.values.length},addEx:function(){this.viewer.dataSources.add(this.dataSource),this.viewer.scene.primitives.add(this.primitives)},removeEx:function(){this.viewer.dataSources.remove(this.dataSource),this.viewer.scene.primitives.remove(this.primitives)},_addImageryCache:function(e){},_removeImageryCache:function(e){},_removeAllImageryCache:function(){}});t.FeatureGridLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.POILayer=void 0;var c=n(i(0)),d=n(i(5)),h=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(19)),a=i(40),f=i(23),p=i(14),m=i(12);function n(e){return e&&e.__esModule?e:{default:e}}var r=a.CustomFeatureGridLayer.extend({_keys:null,_key_index:0,getKey:function(){this._keys||(this._keys=this.config.key||["c95467d0ed2a3755836e37dc27369f97","4320dda936d909d73ab438b4e29cf2a2","e64a96ed7e361cbdc0ebaeaf3818c564","df3247b7df64434adecb876da94755d7","d4375ec477cb0a473c448fb1f83be781","13fdd7b2b90a9d326ae96867ebcc34ce","c34502450ae556f42b21760faf6695a0","57f8ebe12797a73fc5b87f5d4ef859b1"]);var e=this._key_index++%this._keys.length;return this._keys[e]},getDataForGrid:function(e,i){var t=h.wgs2gcj([e.rectangle.xmin,e.rectangle.ymax]),a=h.wgs2gcj([e.rectangle.xmax,e.rectangle.ymin]),n=t[0]+","+t[1]+"|"+a[0]+","+a[1],r=this.config.filter||{};r.output="json",r.key=this.getKey(),r.polygon=n,r.offset||(r.offset=25),r.types||(r.types="120000|130000|190000");d.default.ajax({url:"http://restapi.amap.com/v3/place/polygon",type:"get",dataType:"json",timeout:"5000",data:r,success:function(e){if("10000"===e.infocode){var t=e.pois;i(t)}else console.log("POI 请求失败("+e.infocode+")："+e.info)},error:function(e){console.log("POI 请求出错("+e.status+")："+e.statusText)}})},createEntity:function(e,t){var i="<div>名称："+t.name+"</div><div>地址："+t.address+"</div><div>区域："+t.pname+t.cityname+t.adname+"</div><div>类别："+t.type+"</div>",a=t.location.split(",");a=h.gcj2wgs(a);var n=this.viewer.hchx.point2map({x:a[0],y:a[1]}),r={name:t.name,position:c.default.Cartesian3.fromDegrees(n.x,n.y,this.config.height||3),popup:{html:i,anchor:[0,-15]},properties:t},o=this.config.symbol;if(o){var s=o.styleOptions;if(o.styleField){var l=attr[o.styleField],u=o.styleFieldOptions[l];null!=u&&(s=d.default.extend({},s),s=d.default.extend(s,u))}(s=s||{}).image?(r.billboard=(0,p.style2Entity)(s),r.billboard.heightReference=c.default.HeightReference.RELATIVE_TO_GROUND):r.point=(0,f.style2Entity)(s),s.label&&(r.label=(0,m.style2Entity)(s.label),r.label.heightReference=c.default.HeightReference.RELATIVE_TO_GROUND,r.label.text=t.name)}else r.point={color:new c.default.Color.fromCssColorString("#3388ff"),pixelSize:10,outlineColor:new c.default.Color.fromCssColorString("#ffffff"),outlineWidth:2,heightReference:c.default.HeightReference.RELATIVE_TO_GROUND,scaleByDistance:new c.default.NearFarScalar(1e3,1,2e4,.5)},r.label={text:t.name,font:"normal small-caps normal 16px 楷体",style:c.default.LabelStyle.FILL_AND_OUTLINE,fillColor:c.default.Color.AZURE,outlineColor:c.default.Color.BLACK,outlineWidth:2,horizontalOrigin:c.default.HorizontalOrigin.CENTER,verticalOrigin:c.default.VerticalOrigin.BOTTOM,pixelOffset:new c.default.Cartesian2(0,-15),heightReference:c.default.HeightReference.RELATIVE_TO_GROUND,scaleByDistance:new c.default.NearFarScalar(1e3,1,5e3,.8),distanceDisplayCondition:new c.default.DistanceDisplayCondition(0,5e3)};return this.dataSource.entities.add(r)}});t.POILayer=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GltfLayer=void 0;var a,n=i(0),u=(a=n)&&a.__esModule?a:{default:a};var r=i(9).BaseLayer.extend({model:null,add:function(){this.model?this.viewer.entities.add(this.model):this.initData()},remove:function(){this.viewer.entities.remove(this.model)},centerAt:function(e){if(null!=this.model)if(this.config.extent||this.config.center)this.viewer.hchx.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else{var t=this.config.position;this.viewer.hchx.centerAt(t,{duration:e,isWgs84:!0})}},initData:function(){var e=this.config.position;e=this.viewer.hchx.point2map(e);var t=u.default.Cartesian3.fromDegrees(e.x,e.y,e.z||0),i=u.default.Math.toRadians(e.heading||0),a=u.default.Math.toRadians(e.pitch||0),n=u.default.Math.toRadians(e.roll||0),r=new u.default.HeadingPitchRoll(i,a,n),o=u.default.Transforms.headingPitchRollQuaternion(t,r),s={uri:this.config.url};for(var l in this.config)"url"!=l&&"name"!=l&&"position"!=l&&"center"!=l&&"tooltip"!=l&&"popup"!=l&&(s[l]=this.config[l]);this.model=this.viewer.entities.add({name:this.config.name,position:t,orientation:o,model:s,_config:this.config,tooltip:this.config.tooltip,popup:this.config.popup})},hasOpacity:!0,setOpacity:function(e){null!=this.model&&(this.model.model.color=new u.default.Color.fromCssColorString("#FFFFFF").withAlpha(e))}});t.GltfLayer=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tiles3dLayer=void 0;var a,n=i(0),c=(a=n)&&a.__esModule?a:{default:a},r=i(9),o=i(4),s=i(41),l=i(1);var u=r.BaseLayer.extend({model:null,originalCenter:null,boundingSphere:null,add:function(){this.model?this.viewer.scene.primitives.add(this.model):this.initData()},remove:function(){this.viewer.scene.primitives.remove(this.model),this.model=null},centerAt:function(e){this.config.extent||this.config.center?this.viewer.hchx.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0}):this.boundingSphere&&this.viewer.camera.flyToBoundingSphere(this.boundingSphere,{offset:new c.default.HeadingPitchRange(0,-.5,2*this.boundingSphere.radius),duration:e})},initData:function(){for(var e in this.config.maximumScreenSpaceError=this.config.maximumScreenSpaceError||2,this.config.maximumMemoryUsage=this.config.maximumMemoryUsage||2048,this.model=this.viewer.scene.primitives.add(new c.default.Cesium3DTileset((0,o.getProxyUrl)(this.config))),this.model._config=this.config,this.config)if("url"!=e&&"type"!=e&&"style"!=e&&"classificationType"!=e)try{this.model[e]=this.config[e]}catch(e){}this.config.style&&(this.model.style=new c.default.Cesium3DTileStyle(this.config.style));var u=this;this.model.readyPromise.then(function(e){u.readyPromise&&u.readyPromise(e),u.hasOpacity&&1!=u._opacity&&u.setOpacity(u._opacity);var t=e.boundingSphere;u.boundingSphere=t,e._root&&e._root.transform&&(u.orginMatrixInverse=c.default.Matrix4.inverse(c.default.Matrix4.fromArray(e._root.transform),new c.default.Matrix4),0<u.config.scale&&1!=u.config.scale&&(e._root.transform=c.default.Matrix4.multiplyByUniformScale(e._root.transform,u.config.scale,e._root.transform)));var i=t.center,a=c.default.Cartographic.fromCartesian(i),n=Number(a.height.toFixed(2)),r=Number(c.default.Math.toDegrees(a.longitude).toFixed(6)),o=Number(c.default.Math.toDegrees(a.latitude).toFixed(6));u.originalCenter={x:r,y:o,z:n},console.log((u.config.name||"")+" 模型原始位置:"+JSON.stringify(u.originalCenter));var s=u.viewer.hchx.point2map(u.originalCenter);if(s.x!=u.originalCenter.x||s.y!=u.originalCenter.y||null!=u.config.offset){u.config.offset=u.config.offset||{},u.config.offset.x&&u.config.offset.y&&(u.config.offset=u.viewer.hchx.point2map(u.config.offset));var l={x:u.config.offset.x||s.x,y:u.config.offset.y||s.y,z:u.config.offset.z||0,heading:u.config.offset.heading,axis:u.config.axis,scale:u.config.scale};"-height"==u.config.offset.z?(l.z=5-n,u.updateMatrix(l)):"auto"==u.config.offset.z?u.autoHeight(i,l):u.updateMatrix(l)}!u.viewer.hchx.isFlyAnimation()&&u.config.flyTo&&u.centerAt(0),u.config.calback&&u.config.calback(e)})},autoHeight:function(e,a){var n=this;(0,o.terrainPolyline)({viewer:this.viewer,positions:[e,e],calback:function(e,t){if(null!=e&&0!=e.length&&!t){var i=(0,l.formatPositon)(e[0]).z-n.originalCenter.z+1;a.z=i,n.updateMatrix(a)}}})},updateMatrix:function(e){null!=this.model&&(console.log((this.config.name||"")+" 模型修改后位置:"+JSON.stringify(e)),e.transform=null!=e.heading,(0,s.updateMatrix)(this.model,e))},hasOpacity:!0,setOpacity:function(e){this._opacity=e,this.model&&(this.model.style=new c.default.Cesium3DTileStyle({color:"color() *vec4(1,1,1,"+e+")"}))},showClickFeature:function(e){this.model?this.model._config.showClickFeature=e:this.config.showClickFeature=e}});t.Tiles3dLayer=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KmlLayer=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(28),s=i(4);var l=o.GeoJsonLayer.extend({queryData:function(){var t=this,e=(0,s.getProxyUrl)(this.config);r.default.KmlDataSource.load(e.url,{camera:this.viewer.scene.camera,canvas:this.viewer.scene.canvas,clampToGround:e.clampToGround}).then(function(e){t.showResult(e)}).otherwise(function(e){t.showError("服务出错",e)})},getEntityAttr:function(e){var t={name:e._name},i=e._kml.extendedData;for(var a in i)t[a]=i[a].value;return t}});t.KmlLayer=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CzmlLayer=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a},o=i(28),s=i(4);var l=o.GeoJsonLayer.extend({queryData:function(){var t=this,e=(0,s.getProxyUrl)(this.config);r.default.CzmlDataSource.load(e.url,e).then(function(e){t.showResult(e)}).otherwise(function(e){t.showError("服务出错",e)})},getEntityAttr:function(e){if(e.description&&e.description.getValue)return e.description.getValue()}});t.CzmlLayer=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainLayer=void 0;var a,n=i(0),r=((a=n)&&a.__esModule,i(9)),o=i(4);var s=r.BaseLayer.extend({terrain:null,add:function(){this.terrain||(this.terrain=(0,o.getTerrainProvider)(this.config)),this.viewer.terrainProvider=this.terrain},remove:function(){this.viewer.terrainProvider=(0,o.getEllipsoidTerrain)()}});t.TerrainLayer=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrawLayer=void 0;o(i(0));var n=o(i(5)),a=i(9),r=i(16);function o(e){return e&&e.__esModule?e:{default:e}}var s=a.BaseLayer.extend({create:function(){this.drawControl=new r.Draw(this.viewer,{hasEdit:!1,nameTooltip:!1,removeScreenSpaceEvent:!1})},add:function(){this._isload?this.drawControl.setVisible(!0):this._loadData()},remove:function(){this.drawControl.setVisible(!1)},centerAt:function(e){var t=this.drawControl.getEntitys();this.viewer.flyTo(t,{duration:e})},hasOpacity:!1,setOpacity:function(e){},_loadData:function(){var a=this;n.default.ajax({type:"get",dataType:"json",url:this.config.url,timeout:1e4,success:function(e){a._isload=!0;var t=a.drawControl.jsonToEntity(e,!0,a.config.flyTo);a._bindEntityConfig(t)},error:function(e,t,i){console.log("Json文件"+a.config.url+"加载失败！")}})},_bindEntityConfig:function(e){for(var i=this,t=0,a=e.length;t<a;t++){var n=e[t];(this.config.columns||this.config.popup)&&(n.popup={html:function(e){var t=e.attribute.attr;return t.draw_type=e.attribute.type,t.draw_typename=e.attribute.name,i.viewer.hchx.popup.getPopupForConfig(i.config,t)},anchor:this.config.popupAnchor||[0,-15]}),this.config.tooltip&&(n.tooltip={html:function(e){var t=e.attribute.attr;return t.draw_type=e.attribute.type,t.draw_typename=e.attribute.name,i.viewer.hchx.popup.getPopupForConfig({popup:i.config.tooltip},t)},anchor:this.config.tooltipAnchor||[0,-15]}),this.config.click&&(n.click=this.config.click),this.config.mouseover&&(n.mouseover=this.config.mouseover),this.config.mouseout&&(n.mouseout=this.config.mouseout)}}});t.DrawLayer=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e){var t;switch(e.layer){case"vec":default:t="http://online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles="+(e.bigfont?"ph":"pl")+"&scaler=1&p=1";break;case"img_d":t="http://shangetu{s}.map.bdimg.com/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46";break;case"img_z":t="http://online{s}.map.bdimg.com/tile/?qt=tile&x={x}&y={y}&z={z}&styles="+(e.bigfont?"sh":"sl")+"&v=020";break;case"custom":e.customid=e.customid||"midnight",t="http://api{s}.map.bdimg.com/customimage/tile?&x={x}&y={y}&z={z}&scale=1&customid="+e.customid;break;case"time":t="http://its.map.baidu.com:8002/traffic/TrafficTileService?x={x}&y={y}&level={z}&time="+(new Date).getTime()+"&label=web2D&v=017"}this._url=t,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=18;var i=new Cesium.Cartesian2(-33554054,-33746824),a=new Cesium.Cartesian2(33554054,33746824);this._tilingScheme=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:i,rectangleNortheastInMeters:a}),this._credit=void 0,this._rectangle=this._tilingScheme.rectangle,this._ready=!0}Cesium.defineProperties(a.prototype,{url:{get:function(){return this._url}},token:{get:function(){return this._token}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new DeveloperError("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),a.prototype.getTileCredits=function(e,t,i){},a.prototype.requestImage=function(e,t,i){if(!this._ready)throw new DeveloperError("requestImage must not be called before the imagery provider is ready.");var a=this._tilingScheme.getNumberOfXTilesAtLevel(i),n=this._tilingScheme.getNumberOfYTilesAtLevel(i),r=this._url.replace("{x}",e-a/2).replace("{y}",n/2-t-1).replace("{z}",i).replace("{s}",Math.floor(10*Math.random()));return Cesium.ImageryProvider.loadImage(this,r)},t.BaiduImageryProvider=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureGridImageryProvider=void 0;var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a};function o(e){if(e=r.default.defaultValue(e,r.default.defaultValue.EMPTY_OBJECT),this.options=e,this._tileWidth=r.default.defaultValue(e.tileWidth,256),this._tileHeight=r.default.defaultValue(e.tileHeight,256),this._minimumLevel=r.default.defaultValue(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,e.rectangle&&e.rectangle.xmin&&e.rectangle.xmax&&e.rectangle.ymin&&e.rectangle.ymax){var t=e.rectangle.xmin,i=e.rectangle.xmax,a=e.rectangle.ymin,n=e.rectangle.ymax;e.rectangle=r.default.Rectangle.fromDegrees(t,a,i,n)}this._tilingScheme=r.default.defaultValue(e.tilingScheme,new r.default.GeographicTilingScheme({ellipsoid:e.ellipsoid})),this._rectangle=r.default.defaultValue(e.rectangle,this._tilingScheme.rectangle),this._rectangle=r.default.Rectangle.intersection(this._rectangle,this._tilingScheme.rectangle),this._hasAlphaChannel=r.default.defaultValue(e.hasAlphaChannel,!0),this._errorEvent=new r.default.Event,this._readyPromise=r.default.when.resolve(!0),this._credit=void 0,this._ready=!0}r.default.defineProperties(o.prototype,{url:{get:function(){return this._url}},token:{get:function(){return this._token}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new DeveloperError("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),o.prototype.getTileCredits=function(e,t,i){},o.prototype.requestImage=function(e,t,i){var a=document.createElement("canvas");if(a.width=256,a.height=256,i<this._minimumLevel)return a;if(this.options.debuggerTileInfo){var n=a.getContext("2d");n.strokeStyle="#ffff00",n.lineWidth=2,n.strokeRect(1,1,255,255);var r="L"+i+"X"+e+"Y"+t;n.font="bold 25px Arial",n.textAlign="center",n.fillStyle="black",n.fillText(r,127,127),n.fillStyle="#ffff00",n.fillText(r,124,124)}return a},o.prototype._getGridKey=function(e){return e.level+"_x"+e.x+"_y"+e.y},o.prototype.addImageryCache=function(e){e.level<this._minimumLevel||e.level<e.maxLevel-1||this.options.addImageryCache&&(e.key=this._getGridKey(e),this.options.addImageryCache(e))},o.prototype.removeImageryCache=function(e){e.maxLevel<this._minimumLevel&&this.options.removeAllImageryCache&&this.options.removeAllImageryCache(),e.level<this._minimumLevel||this.options.removeImageryCache&&(e.key=this._getGridKey(e),this.options.removeImageryCache(e))},t.FeatureGridImageryProvider=o},function(module,exports,__webpack_require__){"use strict";function addLog(){try{eval(function(e,t,i,a,n,r){if(n=function(e){return e.toString(30)},!"".replace(/^/,String)){for(;i--;)r[n(i)]=a[i]||n(i);a=[function(e){return r[e]}],n=function(){return"\\w+"},i=1}for(;i--;)a[i]&&(e=e.replace(new RegExp("\\b"+n(i)+"\\b","g"),a[i]));return e}('1(g(){2.3("\\4\\5\\6\\7\\8\\9\\a\\b d e\\f\\0\\h\\i %c \\j\\k\\l\\m\\n://o.p.q","r:s")},t);',0,30,"u67b6|setTimeout|console|log|u5f53|u524d|u4e09|u7ef4|u5730|u56fe|u4f7f|u7528HchxGIS||for|Cesium|u6846|function|u5b9e|u73b0|u5b98|u65b9|u7f51|u7ad9|uff1ahttp|cesium|HchxGIS|cn|color|red|6E4".split("|"),0,{}))}catch(e){}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addLog=addLog},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GaodePOIGeocoder=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r},l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(19)),u=i(4);t.GaodePOIGeocoder=(a(c,[{key:"getOneKey",value:function(){var e=this.gaodekey;return e[Math.floor(Math.random()*e.length+1)-1]}},{key:"geocode",value:function(t,e){var n=this,i=this.getOneKey();return new s.default.Resource({url:"http://restapi.amap.com/v3/place/text",queryParameters:{key:i,city:this.citycode,keywords:t}}).fetchJson().then(function(e){if(0!=e.status){if(0!==e.pois.length){var a=3e3;return n.viewer.camera.positionCartographic.height<a&&(a=n.viewer.camera.positionCartographic.height),e.pois.map(function(e){var t=e.location.split(",");t=l.gcj2wgs(t);var i=n.viewer.hchx.point2map({x:t[0],y:t[1]});return{displayName:e.name,destination:s.default.Cartesian3.fromDegrees(i.x,i.y,a)}})}(0,u.msg)("未查询到“"+t+"”相关数据！")}else(0,u.msg)("请求失败("+e.infocode+")："+e.info)})}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),e=e||{},this.citycode=e.citycode||"",this.gaodekey=e.key||["f2fedb9b08ae13d22f1692cd472d345e","81825d9f2bafbb14f235d2779be90c0f","b185732970a4487de104fa71ef575f29","2e6ca4aeb6867fb637a5bee8333e5d3a","027187040fa924e56048468aaa77b62c"]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testTk=function(){return!0};unescape("%u5F53%u524D%u7CFB%u7EDF%u8BB8%u53EF%u5DF2%u5230%u671F%uFF0C%u8BF7%u8054%u7CFB%u4F9B%u5E94%u5546%u201C%u706B%u661F%u79D1%u6280%u201D%uFF01")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHeadingPitchRollByOrientation=function(e,t){var i=h.default.Matrix4.fromRotationTranslation(h.default.Matrix3.fromQuaternion(t,r),e,o);return s(e,i)},t.getHeadingPitchRollByMatrix=s,t.getHeadingPitchRollForLine=function(e,t,i){i=i||h.default.Ellipsoid.WGS84;var a=h.default.Cartesian3.normalize(h.default.Cartesian3.subtract(t,e,l),l);h.default.Transforms.rotationMatrixFromPositionVelocity(e,a,i,u);var n=h.default.Matrix4.fromRotationTranslation(u,e,o);return h.default.Matrix4.multiplyTransformation(n,h.default.Axis.Z_UP_TO_X_UP,n),s(e,n)},t.getRotateCenterPoint=function(e,t,i){var a=h.default.Cartographic.fromCartesian(e);a.height=0;var n=h.default.Cartographic.toCartesian(a),r=h.default.Cartesian3.normalize(h.default.Cartesian3.subtract(n,e,new h.default.Cartesian3),new h.default.Cartesian3),o=h.default.Quaternion.fromAxisAngle(r,h.default.Math.toRadians(i)),s=h.default.Matrix3.fromQuaternion(o),l=h.default.Matrix4.fromRotationTranslation(s),u=h.default.Cartesian3.subtract(t,e,new h.default.Cartesian3),c=h.default.Matrix4.multiplyByPoint(l,u,new h.default.Cartesian3);return h.default.Cartesian3.add(c,e,new h.default.Cartesian3)},t.getPositionTranslation=function(e,t,i,a){i=i||0,a=a||"z";var n=h.default.Math.toRadians(-i);a="UNIT_"+a.toUpperCase();var r=h.default.Quaternion.fromAxisAngle(h.default.Cartesian3[a],n),o=h.default.Matrix3.fromQuaternion(r),s=new h.default.Cartesian3(t.x,t.y,t.z),l=h.default.Matrix4.fromRotationTranslation(o,h.default.Cartesian3.ZERO);h.default.Matrix4.multiplyByTranslation(l,s,l);var u=h.default.Ellipsoid.WGS84.cartographicToCartesian(h.default.Cartographic.fromCartesian(e)),c=h.default.Transforms.eastNorthUpToFixedFrame(u);h.default.Matrix4.multiplyTransformation(c,l,l);var d=new h.default.Cartesian3;return h.default.Matrix4.getTranslation(l,d),d},t.getOffsetLine=function(e,t){for(var i=[],a=1;a<e.length;a++){var n=e[a-1],r=e[a],o=h.default.Cartesian3.subtract(n,r,new h.default.Cartesian3),s=h.default.Cartesian3.cross(n,o,new h.default.Cartesian3),l=c(n,s,1e3*t),u=c(r,s,1e3*t);1==a&&i.push(l),i.push(u)}return i};var a,n=i(0),h=(a=n)&&a.__esModule?a:{default:a};var r=new h.default.Matrix3,o=new h.default.Matrix4;function s(e,t){var i=h.default.Transforms.eastNorthUpToFixedFrame(e,h.default.Ellipsoid.WGS84,new h.default.Matrix4),a=h.default.Matrix4.multiply(h.default.Matrix4.inverse(i,new h.default.Matrix4),t,new h.default.Matrix4),n=h.default.Matrix4.getRotation(a,new h.default.Matrix3),r=h.default.Quaternion.fromRotationMatrix(n);return h.default.HeadingPitchRoll.fromQuaternion(r)}var l=new h.default.Cartesian3,u=(o=new h.default.Matrix4,new h.default.Matrix3);function c(e,t,i){var a=new h.default.Ray(e,t);return h.default.Ray.getPoint(a,i,new h.default.Cartesian3)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlowEcharts=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r};function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=s.default.Math.toRadians(80),c=(a(d,[{key:"setMapOffset",value:function(e){this._mapOffset=e}},{key:"getBMap",value:function(){return this._GLMap}},{key:"dataToPoint",value:function(e){var t=[99999,99999],i=s.default.Cartesian3.fromDegrees(e[0],e[1]);if(!i)return t;var a=this._GLMap.cartesianToCanvasCoordinates(i);if(!a)return t;var n=this._GLMap;if(n.mode===s.default.SceneMode.SCENE3D){var r=s.default.Cartesian3.angleBetween(n.camera.position,i);if(u<r)return!1}return[a.x-this._mapOffset[0],a.y-this._mapOffset[1]]}},{key:"pointToData",value:function(e){var t=this._mapOffset;return[(e=this._bmap.project([e[0]+t[0],e[1]+t[1]])).lng,e.lat]}},{key:"getViewRect",value:function(){var e=this._api;return new echarts.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())}},{key:"getRoamTransform",value:function(){return echarts.matrix.create()}}]),d);function d(e,t){l(this,d),this._GLMap=e,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=t}c.dimensions=["lng","lat"],c.create=function(e,a){var n;e.eachComponent("GLMap",function(e){var t=a.getZr().painter;if(t){t.getViewportRoot();var i=echarts.glMap;(n=new c(i,a)).setMapOffset(e.__mapOffset||[0,0]),e.coordinateSystem=n}}),e.eachSeries(function(e){"GLMap"===e.get("coordinateSystem")&&(e.coordinateSystem=n)})},window.echarts&&(echarts.registerCoordinateSystem("GLMap",c),echarts.registerAction({type:"GLMapRoam",event:"GLMapRoam",update:"updateLayout"},function(e,t){}),echarts.extendComponentModel({type:"GLMap",getBMap:function(){return this.__GLMap},defaultOption:{roam:!1}}),echarts.extendComponentView({type:"GLMap",init:function(e,t){this.api=t,echarts.glMap.postRender.addEventListener(this.moveHandler,this)},moveHandler:function(e,t){this.api.dispatchAction({type:"GLMapRoam"})},render:function(e,t,i){},dispose:function(e){echarts.glMap.postRender.removeEventListener(this.moveHandler,this)}}));t.FlowEcharts=(a(h,[{key:"_createChartOverlay",value:function(){var e=this._mapContainer.scene;e.canvas.setAttribute("tabIndex",0);var t=document.createElement("div");return t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.width=e.canvas.width+"px",t.style.height=e.canvas.height+"px",t.style.pointerEvents="none",t.setAttribute("id","echarts"),t.setAttribute("class","echartMap"),this._mapContainer.container.appendChild(t),this._echartsContainer=t,echarts.glMap=e,echarts.init(t)}},{key:"dispose",value:function(){this._echartsContainer&&(this._mapContainer.container.removeChild(this._echartsContainer),this._echartsContainer=null),this._overlay&&(this._overlay.dispose(),this._overlay=null)}},{key:"destroy",value:function(){this.dispose()}},{key:"updateOverlay",value:function(e){this._overlay&&this._overlay.setOption(e)}},{key:"getMap",value:function(){return this._mapContainer}},{key:"getOverlay",value:function(){return this._overlay}},{key:"show",value:function(){document.getElementById(this._id).style.visibility="visible"}},{key:"hide",value:function(){document.getElementById(this._id).style.visibility="hidden"}}]),h);function h(e,t){l(this,h),this._mapContainer=e,this._overlay=this._createChartOverlay(),this._overlay.setOption(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapVLayer=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r},l=i(93);var u=0;t.MapVLayer=(a(c,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"addInnerContainer",value:function(){this.container.appendChild(this.canvas)}},{key:"bindEvent",value:function(){var t=this;this.innerMoveStart=this.moveStartEvent.bind(this),this.innerMoveEnd=this.moveEndEvent.bind(this),this.scene.camera.moveStart.addEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.addEventListener(this.innerMoveEnd,this);var e=new s.default.ScreenSpaceEventHandler(this.canvas);e.setInputAction(function(e){t.innerMoveEnd()},s.default.ScreenSpaceEventType.LEFT_UP),e.setInputAction(function(e){t.innerMoveEnd()},s.default.ScreenSpaceEventType.MIDDLE_UP),this.handler=e}},{key:"unbindEvent",value:function(){this.scene.camera.moveStart.removeEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.removeEventListener(this.innerMoveEnd,this),this.scene.postRender.removeEventListener(this._reset,this),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"moveStartEvent",value:function(){this.mapvBaseLayer&&this.mapvBaseLayer.animatorMovestartEvent(),this.scene.postRender.addEventListener(this._reset,this),console.log("mapv moveStartEvent")}},{key:"moveEndEvent",value:function(){this.scene.postRender.removeEventListener(this._reset,this),this.mapvBaseLayer&&this.mapvBaseLayer.animatorMoveendEvent(),this._reset(),console.log("mapv moveEndEvent")}},{key:"zoomStartEvent",value:function(){this._unvisiable()}},{key:"zoomEndEvent",value:function(){this._unvisiable()}},{key:"addData",value:function(e,t){null!=this.mapvBaseLayer&&this.mapvBaseLayer.addData(e,t)}},{key:"updateData",value:function(e,t){null!=this.mapvBaseLayer&&this.mapvBaseLayer.updateData(e,t)}},{key:"getData",value:function(){return this.mapvBaseLayer&&(this.dataSet=this.mapvBaseLayer.getData()),this.dataSet}},{key:"removeData",value:function(e){null!=this.mapvBaseLayer&&this.mapvBaseLayer&&this.mapvBaseLayer.removeData(e)}},{key:"removeAllData",value:function(){null!=this.mapvBaseLayer&&this.mapvBaseLayer.clearData()}},{key:"_visiable",value:function(){return this.canvas.style.display="block"}},{key:"_unvisiable",value:function(){return this.canvas.style.display="none"}},{key:"_createCanvas",value:function(){var e=document.createElement("canvas");e.id=this.mapVOptions.layerid||"mapv"+u++,e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=this.mapVOptions.zIndex||100,e.width=parseInt(this.map.canvas.width),e.height=parseInt(this.map.canvas.height),e.style.width=this.map.canvas.style.width,e.style.height=this.map.canvas.style.height;var t=this.devicePixelRatio;return"2d"==this.mapVOptions.context&&e.getContext(this.mapVOptions.context).scale(t,t),e}},{key:"_reset",value:function(){this.resizeCanvas(),this.fixPosition(),this.onResize(),this.render()}},{key:"draw",value:function(){this._reset()}},{key:"show",value:function(){this._visiable()}},{key:"hide",value:function(){this._unvisiable()}},{key:"destroy",value:function(){this.unbindEvent(),this.remove()}},{key:"remove",value:function(){null!=this.mapvBaseLayer&&(this.removeAllData(),this.mapvBaseLayer.destroy(),this.mapvBaseLayer=void 0,this.canvas.parentElement.removeChild(this.canvas))}},{key:"update",value:function(e){null!=e&&this.updateData(e.data,e.options)}},{key:"resizeCanvas",value:function(){if(null!=this.canvas&&null!=this.canvas){var e=this.canvas;e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.width=parseInt(this.map.canvas.width),e.height=parseInt(this.map.canvas.height),e.style.width=this.map.canvas.style.width,e.style.height=this.map.canvas.style.height}}},{key:"fixPosition",value:function(){}},{key:"onResize",value:function(){}},{key:"render",value:function(){null!=this.mapvBaseLayer&&this.mapvBaseLayer._canvasUpdate()}}]),c);function c(e,t,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),this.map=e,this.scene=e.scene,this.mapvBaseLayer=new l.MapVRenderer(e,t,i,this),this.mapVOptions=i,this.initDevicePixelRatio(),this.canvas=this._createCanvas(),this.render=this.render.bind(this),null!=a?(this.container=a).appendChild(this.canvas):(this.container=e.container,this.addInnerContainer()),this.bindEvent(),this._reset()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapVRenderer=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function o(e,t,i){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,t);if(void 0===a){var n=Object.getPrototypeOf(e);return null===n?void 0:o(n,t,i)}if("value"in a)return a.value;var r=a.get;return void 0!==r?r.call(i):void 0}var r,s=i(0),l=(r=s)&&r.__esModule?r:{default:r};function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=i(94),d=c?c.baiduMapLayer:null,h=d?d.__proto__:Function,f=l.default.Math.toRadians(80);t.MapVRenderer=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,h),a(p,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"clickEvent",value:function(e){var t=e.point;o(p.prototype.__proto__||Object.getPrototypeOf(p.prototype),"clickEvent",this).call(this,t,e)}},{key:"mousemoveEvent",value:function(e){var t=e.point;o(p.prototype.__proto__||Object.getPrototypeOf(p.prototype),"mousemoveEvent",this).call(this,t,e)}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var e=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=e.stepsRange.start)}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator}},{key:"bindEvent",value:function(){this.map,this.options.methods&&(this.options.methods.click,this.options.methods.mousemove)}},{key:"unbindEvent",value:function(){var e=this.map;this.options.methods&&(this.options.methods.click&&e.off("click",this.clickEvent),this.options.methods.mousemove&&e.off("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"init",value:function(e){this.options=e,this.initDataRange(e),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"_canvasUpdate",value:function(i){this.map;var r=this.scene;if(this.canvasLayer&&!this.stopAniamation){var a=this.options.animation,e=this.getContext();if(this.isEnabledTime()){if(void 0===i)return void this.clear(e);"2d"===this.context&&(e.save(),e.globalCompositeOperation="destination-out",e.fillStyle="rgba(0, 0, 0, .1)",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore())}else this.clear(e);if("2d"===this.context)for(var t in this.options)e[t]=this.options[t];else e.clear(e.COLOR_BUFFER_BIT);var n={transferCoordinate:function(e){var t=[99999,99999],i=l.default.Cartesian3.fromDegrees(e[0],e[1]);if(!i)return t;var a=r.cartesianToCanvasCoordinates(i);if(!a)return t;if(r.mode===l.default.SceneMode.SCENE3D){var n=l.default.Cartesian3.angleBetween(r.camera.position,i);if(f<n)return!1}return[a.x,a.y]}};void 0!==i&&(n.filter=function(e){var t=a.trails||10;return!!(i&&e.time>i-t&&e.time<i)});var o=this.dataSet.get(n);this.processData(o),"m"==this.options.unit&&this.options.size,this.options._size=this.options.size;var s=l.default.SceneTransforms.wgs84ToWindowCoordinates(r,l.default.Cartesian3.fromDegrees(0,0));this.drawContext(e,new c.DataSet(o),this.options,s),this.options.updateCallback&&this.options.updateCallback(i)}}},{key:"updateData",value:function(e,t){var i=e;i&&i.get&&(i=i.get()),null!=i&&this.dataSet.set(i),o(p.prototype.__proto__||Object.getPrototypeOf(p.prototype),"update",this).call(this,{options:t})}},{key:"addData",value:function(e,t){var i=e;e&&e.get&&(i=e.get()),this.dataSet.add(i),this.update({options:t})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!=typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"clear",value:function(e){e&&e.clearRect&&e.clearRect(0,0,e.canvas.width,e.canvas.height)}},{key:"destroy",value:function(){this.unbindEvent(),this.clear(this.getContext()),this.clearData(),this.animator&&this.animator.stop(),this.animator=null,this.canvasLayer=null}}]),p);function p(e,t,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p);var n=u(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,e,t,i));return h?(n.map=e,n.scene=e.scene,n.dataSet=t,i=i||{},n.init(i),n.argCheck(i),n.initDevicePixelRatio(),n.canvasLayer=a,n.stopAniamation=!1,n.animation=i.animation,n.clickEvent=n.clickEvent.bind(n),n.mousemoveEvent=n.mousemoveEvent.bind(n),n.bindEvent(),n):u(n)}},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_94__},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ellipsoid=t.rectangle=t.circle=t.polygon=t.wall=t.polylineVolume=t.polyline=t.model=t.point=t.label=t.billboard=void 0;var a=p(i(14)),n=p(i(12)),r=p(i(23)),o=p(i(24)),s=p(i(10)),l=p(i(33)),u=p(i(37)),c=p(i(15)),d=p(i(27)),h=p(i(34)),f=p(i(36));function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.billboard=a,t.label=n,t.point=r,t.model=o,t.polyline=s,t.polylineVolume=l,t.wall=u,t.polygon=c,t.circle=d,t.rectangle=h,t.ellipsoid=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Measure=void 0;var a,n=i(0),E=(a=n)&&a.__esModule?a:{default:a},p=r(i(22)),m=i(16),g=r(i(7)),v=i(12),y=r(i(15)),S=i(4),T=i(1);function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}t.Measure=function(e){var P=e.viewer,o={color:"#ffffff",font_family:"楷体",font_size:20,border:!0,border_color:"#000000",border_width:3,background:!0,background_color:"#000000",background_opacity:.5,scaleByDistance:!0,scaleByDistance_far:8e5,scaleByDistance_farValue:.5,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,pixelOffset:[0,-15],disableDepthTestDistance:Number.POSITIVE_INFINITY};if(e.label)for(var t in e.label)o[t]=e.label[t];var i="",c=new m.Draw(P,{hasEdit:!1,removeScreenSpaceEvent:e.removeScreenSpaceEvent});c.on(g.DrawAddPoint,function(e){var t=e.entity;switch(i){case"length":case"section":n.showAddPointLength(t);break;case"area":r.showAddPointLength(t);break;case"volume":l.showAddPointLength(t);break;case"height":u.showAddPointLength(t);break;case"super_height":d.showAddPointLength(t);break;case"angle":h.showAddPointLength(t)}}),c.on(g.DrawRemovePoint,function(e){switch(i){case"length":case"section":n.showRemoveLastPointLength(e);break;case"area":r.showRemoveLastPointLength(e);break;case"volume":l.showRemoveLastPointLength(e);break;case"height":u.showRemoveLastPointLength(e);break;case"super_height":d.showRemoveLastPointLength(e);break;case"angle":h.showRemoveLastPointLength(e)}}),c.on(g.DrawMouseMove,function(e){var t=e.entity;switch(i){case"length":case"section":n.showMoveDrawing(t);break;case"area":r.showMoveDrawing(t);break;case"volume":l.showMoveDrawing(t);break;case"height":u.showMoveDrawing(t);break;case"super_height":d.showMoveDrawing(t);break;case"angle":h.showMoveDrawing(t)}}),c.on(g.DrawCreated,function(e){var t=e.entity;switch(i){case"length":case"section":n.showDrawEnd(t);break;case"area":r.showDrawEnd(t);break;case"volume":l.showDrawEnd(t);break;case"height":u.showDrawEnd(t);break;case"super_height":d.showDrawEnd(t);break;case"angle":h.showDrawEnd(t)}});var s=c.getDataSource();function a(){n.clearLastNoEnd(),r.clearLastNoEnd(),l.clearLastNoEnd(),u.clearLastNoEnd(),d.clearLastNoEnd(),h.clearLastNoEnd(),c.stopDraw()}var n={options:null,arrLables:[],totalLable:null,disTerrainScale:1.2,clearLastNoEnd:function(){if(null!=this.totalLable&&s.entities.remove(this.totalLable),this.arrLables&&0<this.arrLables.length){var e=this.arrLables;if(e&&0<e.length)for(var t in e)s.entities.remove(e[t])}this.totalLable=null,this.arrLables=[]},start:function(e){this.options=e;var t=(0,v.style2Entity)(o,{horizontalOrigin:E.default.HorizontalOrigin.LEFT,verticalOrigin:E.default.VerticalOrigin.BOTTOM,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),this.arrLables=[],c.startDraw({type:"polyline",config:{addHeight:e.addHeight},style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1,clampToGround:"section"==this.options.type||this.options.terrain}})},showAddPointLength:function(e){var t=c.getPositions(e),i=(0,v.style2Entity)(o,{horizontalOrigin:E.default.HorizontalOrigin.LEFT,verticalOrigin:E.default.VerticalOrigin.BOTTOM,show:!0}),a=s.entities.add({position:t[t.length-1],label:i,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}});if(1==t.length)a.label.text="起点";else{var n=this.getLength(t),r=M(n,this.options.unit);a.label.text=r,a.attribute.value=n,this.getLength([t[t.length-2],t[t.length-1]])<5&&(a.show=!1)}this.arrLables.push(a)},showRemoveLastPointLength:function(e){var t=this.arrLables.pop();s.entities.remove(t),this.showMoveDrawing(e.entity),this.totalLable.position=e.position},showMoveDrawing:function(e){var t=c.getPositions(e);if(t.length<2)this.totalLable.label.show=!1;else{var i=this.getLength(t),a=M(i,this.options.unit);this.totalLable.position=t[t.length-1],this.totalLable.label.text="总长:"+a,this.totalLable.label.show=!0,this.totalLable.attribute.value=i,this.totalLable.attribute.textEx="总长:",this.options.calback&&this.options.calback(a,i)}},showDrawEnd:function(e){var t=c.getPositions(e),i=this.arrLables.length-t.length;if(0<=i){for(var a=this.arrLables.length-1;a>=t.length-1;a--)s.entities.remove(this.arrLables[a]);this.arrLables.splice(t.length-1,1+i)}e._totalLable=this.totalLable,e._arrLables=this.arrLables,this.totalLable=null,this.arrLables=[],null!=e.polyline&&("section"==this.options.type?this.updateSectionForTerrain(e):this.options.terrain&&this.updateLengthForTerrain(e))},updateLengthForTerrain:function(e){var o=this,i=e.polyline.positions.getValue(),s=e._arrLables,a=e._totalLable,l=a&&a.unit,u=0,c=0;!function r(){if(++u>=i.length&&a){var e=M(c,l);return a.label.text="总长:"+e,a.attribute.value=c,void(o.options.calback&&o.options.calback(e,c))}var t=[i[u-1],i[u]];(0,S.terrainPolyline)({viewer:P,positions:t,calback:function(e,t){var i=o.getLength(e);t&&(i*=o.disTerrainScale);var a=s[u];if(a){var n=M(i,l);a.label.text=n,a.attribute.value=i}c+=i,r()}})}()},updateSectionForTerrain:function(e){var h=e.polyline.positions.getValue();if(!(h.length<2)){var f=e._arrLables,p=e._totalLable,m=p&&p.unit,g=0,v=[],y=0,_=[],w=[],b=[],C=[],x=this;!function c(){var d=[h[++g-1],h[g]];(0,S.terrainPolyline)({viewer:P,positions:d,calback:function(e,t){v=t?1==g?v.concat(d):v.concat([h[g]]):v.concat(e);for(var i=E.default.Cartographic.fromCartesian(h[g-1]).height,a=(E.default.Cartographic.fromCartesian(h[g]).height-i)/e.length,n=0;n<e.length;n++){0!=n&&(y+=E.default.Cartesian3.distance(e[n],e[n-1])),_.push(Number(y.toFixed(1)));var r=(0,T.formatPositon)(e[n]);w.push(r.z),C.push(r);var o=Number((i+a*n).toFixed(1));b.push(o)}if(g>=h.length-1){if(p){var s=M(l=x.getLength(v),m);p.label.text="总长:"+s,p.attribute.value=l}x.options.calback&&x.options.calback({distancestr:s,distance:l,arrLen:_,arrLX:b,arrHB:w,arrPoint:C})}else{s=M(l=x.getLength(e),m);var l,u=f[g];u.label.text=s,u.attribute.value=l,c()}}})}()}},getLength:function(e){for(var t=0,i=0,a=e.length-1;i<a;i++)t+=E.default.Cartesian3.distance(e[i],e[i+1]);return t}},r={options:null,totalLable:null,clearLastNoEnd:function(){null!=this.totalLable&&s.entities.remove(this.totalLable),this.totalLable=null},start:function(e){this.options=e;var t=(0,v.style2Entity)(o,{horizontalOrigin:E.default.HorizontalOrigin.CENTER,verticalOrigin:E.default.VerticalOrigin.BOTTOM,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),c.startDraw({type:"polygon",style:e.style||{color:"#00fff2",outline:!0,outlineColor:"#fafa5a",outlineWidth:1,opacity:.4,clampToGround:!0}})},showAddPointLength:function(e){},showRemoveLastPointLength:function(e){c.getPositions(e.entity).length<3&&(this.totalLable.label.show=!1)},showMoveDrawing:function(e){var t=c.getPositions(e);if(t.length<3)this.totalLable.label.show=!1;else{var i=y.toGeoJSON(e),a=p.area(i),n=f(a,this.options.unit),r=(0,T.centerOfMass)(t);this.totalLable.position=r,this.totalLable.label.text="面积:"+n,this.totalLable.label.show=!0,this.totalLable.attribute.value=a,this.totalLable.attribute.textEx="面积:",this.options.calback&&this.options.calback(n,a)}},showDrawEnd:function(e){null!=e.polygon&&(e._totalLable=this.totalLable,this.totalLable=null)}},l={options:null,totalLable:null,prevEntity:null,clearLastNoEnd:function(){null!=this.totalLable&&s.entities.remove(this.totalLable),(this.totalLable=null)!=this.prevEntity&&s.entities.remove(this.prevEntity),this.prevEntity=null},start:function(e){this.options=e;var t=(0,v.style2Entity)(o,{horizontalOrigin:E.default.HorizontalOrigin.CENTER,verticalOrigin:E.default.VerticalOrigin.BOTTOM,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),c.startDraw({type:"polygon",style:e.style||{color:"#00fff2",outline:!0,outlineColor:"#fafa5a",outlineWidth:1,opacity:.4,clampToGround:!0}})},showAddPointLength:function(e){},showRemoveLastPointLength:function(e){},showMoveDrawing:function(e){},showDrawEnd:function(e){if(null!=e.polygon){var t=e.polygon.hierarchy.getValue(),i=this.computeCutVolume(t),a=i.maxHeight,n=i.totalCutVolume,r=n.toFixed(2)+"立方米",o=(0,T.centerOfMass)(t,a+10);this.totalLable.position=o,this.totalLable.label.text="挖方体积:"+r,this.totalLable.label.show=!0,this.totalLable.attribute.value=n,this.totalLable.attribute.textEx="挖方体积:",this.options.calback&&this.options.calback(areastr,n),s.entities.remove(e),(e=s.entities.add({polygon:{hierarchy:{positions:t},extrudedHeight:a,closeTop:!1,closeBottom:!1,material:new E.default.Color.fromCssColorString("#00fff2").withAlpha(.5),outline:!0,outlineColor:new E.default.Color.fromCssColorString("#fafa5a").withAlpha(.4),outlineWidth:1}}))._totalLable=this.totalLable,this.totalLable=null}},computeCutVolume:function(e){for(var t=15e3,i=0;i<e.length;i++){var a=E.default.Cartographic.fromCartesian(e[i]),n=P.scene.globe.getHeight(a);n<t&&(t=n)}var r=Math.PI/Math.pow(2,11);r/=64;var o,s,l,u,c,d,h,f,p,m=new E.default.PolygonGeometry.fromPositions({positions:e,vertexFormat:E.default.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,granularity:r}),g=new E.default.PolygonGeometry.createGeometry(m),v=0,y=0;for(i=0;i<g.indices.length;i+=3){o=g.indices[i],s=g.indices[i+1],l=g.indices[i+2],p=new E.default.Cartesian3(g.attributes.position.values[3*o],g.attributes.position.values[3*o+1],g.attributes.position.values[3*o+2]),a=E.default.Cartographic.fromCartesian(p),u=P.scene.globe.getHeight(a),h=E.default.Cartesian3.fromRadians(a.longitude,a.latitude,0),y<u&&(y=u),p=new E.default.Cartesian3(g.attributes.position.values[3*s],g.attributes.position.values[3*s+1],g.attributes.position.values[3*s+2]),a=E.default.Cartographic.fromCartesian(p),c=P.scene.globe.getHeight(a);var _=E.default.Cartesian3.fromRadians(a.longitude,a.latitude,0);y<c&&(y=c),p=new E.default.Cartesian3(g.attributes.position.values[3*l],g.attributes.position.values[3*l+1],g.attributes.position.values[3*l+2]),a=E.default.Cartographic.fromCartesian(p),d=P.scene.globe.getHeight(a),f=E.default.Cartesian3.fromRadians(a.longitude,a.latitude,0),y<d&&(y=d),v+=this.computeAreaOfTriangle(h,_,f)*(u-t+c-t+d-t)/3}return{maxHeight:y,totalCutVolume:v}},computeAreaOfTriangle:function(e,t,i){var a=E.default.Cartesian3.distance(e,t),n=E.default.Cartesian3.distance(t,i),r=E.default.Cartesian3.distance(i,e),o=(a+n+r)/2;return Math.sqrt(o*(o-a)*(o-n)*(o-r))}},u={options:null,totalLable:null,clearLastNoEnd:function(){null!=this.totalLable&&s.entities.remove(this.totalLable),this.totalLable=null},start:function(e){this.options=e;var t=(0,v.style2Entity)(o,{horizontalOrigin:E.default.HorizontalOrigin.RIGHT,verticalOrigin:E.default.VerticalOrigin.BOTTOM,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),c.startDraw({type:"polyline",config:{maxPointNum:2},style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1}})},showAddPointLength:function(e){},showRemoveLastPointLength:function(e){this.totalLable&&(this.totalLable.label.show=!1)},showMoveDrawing:function(e){var t=c.getPositions(e);if(t.length<2)this.totalLable.label.show=!1;else{var i=E.default.Cartographic.fromCartesian(t[0]),a=E.default.Cartographic.fromCartesian(t[1]),n=Math.abs(a.height-i.height),r=M(n,this.options.unit);this.totalLable.position=E.default.Cartesian3.midpoint(t[0],t[1],new E.default.Cartesian3),this.totalLable.label.text="高度差:"+r,this.totalLable.label.show=!0,this.totalLable.attribute.value=n,this.totalLable.attribute.textEx="高度差:",this.options.calback&&this.options.calback(r,n)}},showDrawEnd:function(e){e._totalLable=this.totalLable,this.totalLable=null}},d={options:null,totalLable:null,xLable:null,hLable:null,clearLastNoEnd:function(){null!=this.totalLable&&s.entities.remove(this.totalLable),null!=this.xLable&&s.entities.remove(this.xLable),null!=this.hLable&&s.entities.remove(this.hLable),this.totalLable=null,this.xLable=null,this.hLable=null},start:function(e){this.options=e;var t=(0,v.style2Entity)(o,{horizontalOrigin:E.default.HorizontalOrigin.RIGHT,verticalOrigin:E.default.VerticalOrigin.CENTER,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}});var i=(0,v.style2Entity)(o,{horizontalOrigin:E.default.HorizontalOrigin.CENTER,verticalOrigin:E.default.VerticalOrigin.BOTTOM,show:!1});i.pixelOffset=new E.default.Cartesian2(0,0),this.xLable=s.entities.add({label:i,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),this.hLable=s.entities.add({label:i,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),c.startDraw({type:"polyline",config:{maxPointNum:2},style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1}})},showAddPointLength:function(e){var t=c.getPositions(e);if(4==t.length){var i=t[3].clone();t.pop(),t.pop(),t.pop(),t.push(i)}if(2==t.length){var a=this.getZHeightPosition(t[0],t[1]);3<this.getHDistance(t[0],t[1])&&(t.push(a),t.push(t[0]))}this.showSuperHeight(t)},showRemoveLastPointLength:function(e){var t=c.getPositions(e.entity);2==t.length&&(t.pop(),t.pop(),this.totalLable.label.show=!1,this.hLable.label.show=!1,this.xLable.label.show=!1)},showMoveDrawing:function(e){var t=c.getPositions(e);if(4==t.length){var i=t[3].clone();t.pop(),t.pop(),t.pop(),t.push(i)}if(2==t.length){var a=this.getZHeightPosition(t[0],t[1]);3<this.getHDistance(t[0],t[1])&&(t.push(a),t.push(t[0]))}this.showSuperHeight(t)},showDrawEnd:function(e){e._arrLables=[this.totalLable,this.hLable,this.xLable],this.totalLable=null,this.hLable=null,this.xLable=null},showSuperHeight:function(e){var t,i,a,n;if(4==e.length){var r,o=E.default.Cartesian3.midpoint(e[0],e[1],new E.default.Cartesian3),s=E.default.Cartographic.fromCartesian(e[0]),l=E.default.Cartographic.fromCartesian(e[1]),u=E.default.Cartographic.fromCartesian(e[2]),c=l.height-u.height;n=l.height-s.height,a=E.default.Cartesian3.distance(e[0],e[1]),-1<n&&n<1?(d=e[1],this.updateSuperHeightLabel(this.totalLable,d,"高度差:",n)):(t=-.1<c&&c<.1?(r=E.default.Cartesian3.midpoint(e[2],e[1],new E.default.Cartesian3),d=E.default.Cartesian3.midpoint(e[2],e[3],new E.default.Cartesian3),i=E.default.Cartesian3.distance(e[1],e[2]),E.default.Cartesian3.distance(e[3],e[2])):(d=E.default.Cartesian3.midpoint(e[2],e[1],new E.default.Cartesian3),r=E.default.Cartesian3.midpoint(e[2],e[3],new E.default.Cartesian3),i=E.default.Cartesian3.distance(e[3],e[2]),E.default.Cartesian3.distance(e[1],e[2])),this.updateSuperHeightLabel(this.totalLable,d,"高度差:",t),this.updateSuperHeightLabel(this.xLable,r,"",i)),this.updateSuperHeightLabel(this.hLable,o,"",a)}else if(2==e.length){t=E.default.Cartesian3.distance(e[1],e[0]);var d=E.default.Cartesian3.midpoint(e[0],e[1],new E.default.Cartesian3);xLable.label.show&&(xLable.label.show=!1,hLable.label.show=!1),this.updateSuperHeightLabel(this.totalLable,d,"高度差:",t)}var h=M(t,this.options.unit);this.options.calback&&this.options.calback(h,t)},updateSuperHeightLabel:function(e,t,i,a){null!=e&&(e.position=t,e.label.text=i+M(a,this.options.unit),e.label.show=!0,e.attribute.value=a,e.attribute.textEx=i)},getZHeightPosition:function(e,t){var i=E.default.Cartographic.fromCartesian(e),a=Number(E.default.Math.toDegrees(i.longitude)),n=Number(E.default.Math.toDegrees(i.latitude)),r=Number(i.height.toFixed(2)),o=E.default.Cartographic.fromCartesian(t),s=Number(E.default.Math.toDegrees(o.longitude)),l=Number(E.default.Math.toDegrees(o.latitude)),u=Number(o.height.toFixed(2));return u<r?E.default.Cartesian3.fromDegrees(s,l,r):E.default.Cartesian3.fromDegrees(a,n,u)},getHDistance:function(e,t){var i=this.getZHeightPosition(e,t),a=E.default.Cartographic.fromCartesian(t),n=E.default.Cartographic.fromCartesian(i),r=E.default.Cartesian3.distance(e,i);return Math.abs(Number(n.height)-Number(a.height))<.01&&(r=E.default.Cartesian3.distance(t,i)),r}},h={options:null,totalLable:null,exLine:null,clearLastNoEnd:function(){null!=this.totalLable&&s.entities.remove(this.totalLable),(this.totalLable=null)!=this.exLine&&s.entities.remove(this.exLine),this.exLine=null},start:function(e){this.options=e;var t=(0,v.style2Entity)(o,{horizontalOrigin:E.default.HorizontalOrigin.LEFT,verticalOrigin:E.default.VerticalOrigin.BOTTOM,show:!1});this.totalLable=s.entities.add({label:t,isMarsMeasureLabel:!0,_noMousePosition:!0,attribute:{unit:this.options.unit,type:this.options.type}}),c.startDraw({type:"polyline",config:{maxPointNum:2},style:e.style||{lineType:"arrow",color:"#ebe967",width:9,clampToGround:!0}})},showAddPointLength:function(e){},showRemoveLastPointLength:function(e){this.exLine&&(this.exLine.polyline.show=!1),this.totalLable&&(this.totalLable.label.show=!1)},showMoveDrawing:function(e){var t=c.getPositions(e);if(t.length<2)this.totalLable.label.show=!1;else{var i=E.default.Cartesian3.distance(t[0],t[1]),a=(0,T.formatPositon)(t[0]),n=(0,T.formatPositon)(t[1]),r=p.point([a.x,a.y,a.z]),o=p.point([n.x,n.y,n.z]),s=Math.round(p.rhumbBearing(r,o)),l=p.destination(r,i/3e3,0,{units:"kilometers"});l={x:l.geometry.coordinates[0],y:l.geometry.coordinates[1],z:a.z};var u=E.default.Cartesian3.fromDegrees(l.x,l.y,l.z);this.updateExLine([t[0],u]),this.totalLable.position=t[1],this.totalLable.label.text="角度:"+s+"°\n距离:"+M(i),this.totalLable.label.show=!0,this.totalLable.attribute.value=s,this.totalLable.attribute.textEx="角度:",this.options.calback&&this.options.calback(s+"°",s)}},updateExLine:function(e){this.exLine?(this.exLine.polyline.show=!0,this.exLine.polyline.positions.setValue(e)):this.exLine=s.entities.add({polyline:{positions:e,width:3,clampToGround:!0,material:new E.default.PolylineDashMaterialProperty({color:E.default.Color.RED})}})},showDrawEnd:function(e){e._totalLable=this.totalLable,this.totalLable=null,this.exLine=null}};function f(e,t){if(null==e)return"";null!=t&&"auto"!=t||(t=e<1e6?"m":"km");var i="";switch(t){default:case"m":i=e.toFixed(2)+"平方米";break;case"km":i=(e/1e6).toFixed(2)+"平方公里";break;case"mu":i=(.0015*e).toFixed(2)+"亩";break;case"ha":i=(1e-4*e).toFixed(2)+"公顷"}return i}function M(e,t){if(null==e)return"";null!=t&&"auto"!=t||(t=e<1e3?"m":"km");var i="";switch(t){default:case"m":i=e.toFixed(2)+"米";break;case"km":i=(.001*e).toFixed(2)+"公里";break;case"mile":i=(54e-5*e).toFixed(2)+"海里";break;case"zhang":i=(.3*e).toFixed(2)+"丈"}return i}return{measuerLength:function(e){a(),(e=e||{}).type=i="length",e.hasOwnProperty("terrain")||(e.terrain=!0),n.start(e)},measureHeight:function(e){a(),(e=e||{}).hasOwnProperty("isSuper")&&!e.isSuper?(i="height",e.type=i,u.start(e)):(i="super_height",e.type=i,d.start(e))},measureArea:function(e){a(),(e=e||{}).type=i="area",r.start(e)},measureAngle:function(e){a(),(e=e||{}).type=i="angle",h.start(e)},measureVolume:function(e){a(),(e=e||{}).type=i="volume",l.start(e)},measureSection:function(e){a(),(e=e||{}).type=i="section",e.terrain=!0,n.start(e)},updateUnit:function(e,t){var i=s.entities.values;for(var a in i){var n=i[a];if(n.label&&n.isMarsMeasureLabel&&n.attribute&&n.attribute.value){if(n.attribute.type!=e)continue;"area"==e?n.label.text._value=(n.attribute.textEx||"")+f(n.attribute.value,t):n._label.text._value=(n.attribute.textEx||"")+M(n.attribute.value,t)}}},clearMeasure:function(){i="",a(),c.deleteAll()},formatArea:f,formatLength:M}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DivPoint=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=s(i(0)),r=s(i(5));function s(e){return e&&e.__esModule?e:{default:e}}t.DivPoint=(a(l,[{key:"updateViewPoint",value:function(){if(this._visible){var e=this.viewer.scene,t=o.default.SceneTransforms.wgs84ToWindowCoordinates(e,this.position);if(null!=t){if(e.mode===o.default.SceneMode.SCENE3D){var i=e.camera.getPickRay(t),a=e.globe.pick(i,e);if(a&&1e6<o.default.Cartesian3.distance(this.position,a))return!1}var n=t.x,r=t.y-this.$view.height();this.anchor?(n+=this.anchor[0],r+=this.anchor[1]):n-=this.$view.width()/2,this.$view.css("transform","translate3d("+n+"px,"+r+"px, 0)")}}}},{key:"setVisible",value:function(e){(this._visible=e)?this.$view.show():this.$view.hide()}},{key:"  ",value:function(){this.viewer.scene.postRender.removeEventListener(this.updateViewPoint,this),this.$view.remove(),this.$view=null,this.position=null,this.anchor=null,this.viewer=null}},{key:"dom",get:function(){return this.$view}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e,this.setVisible(e)}}]),l);function l(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.viewer=t,this.position=i.position,this.anchor=i.anchor,this._visible=!0,this.$view=(0,r.default)(i.html),this.$view.css({position:"absolute",left:"0",top:"0"}),this.$view.appendTo("#"+t._container.id);var a=this;(i.click||i.popup)&&this.$view.click(function(e){i.popup&&t.hchx.popup.show(i,a.position),i.click&&i.click(i,a,e)}),i.tooltip&&this.$view.hover(function(){t.hchx.tooltip.show(i,a.position)},function(){t.hchx.tooltip.close()}),this.$view.on("mousewheel",function(e){}),t.scene.postRender.addEventListener(this.updateViewPoint,this)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=new Cesium.Matrix4,s=new Cesium.Matrix3,l=new Cesium.Cartesian3,u=new Cesium.Quaternion,c={model:{show:!1,scale:1,minimumPixelSize:50},label:{show:!1,color:"#ffffff",opacity:1,font_family:"楷体",font_size:20,border:!0,border_color:"#000000",border_width:3,background:!1,hasPixelOffset:!0,pixelOffsetX:30,pixelOffsetY:-30,scaleByDistance:!0,scaleByDistance_far:1e7,scaleByDistance_farValue:.4,scaleByDistance_near:1e5,scaleByDistance_nearValue:1},path:{show:!1,lineType:"solid",color:"#3388ff",opacity:.5,width:1,outline:!1,outlineColor:"#ffffff",outlineWidth:2},shadow:{show:!1,color:"#00ff00",outline:!1,opacity:.3},camera:{type:"gs",followedX:50,followedZ:10},showGroundHeight:!1};t.FlyLine=(a(d,[{key:"_createLine",value:function(){var e,t=new Cesium.SampledPositionProperty,i=Cesium.JulianDate.fromDate(new Date),a=this.points;if(a.length<2)console.log("路线无坐标数据，无法漫游！");else{var n=this.options.speed,r=!haoutil.isutil.isNumber(n);if(2==a.length){var o=this.getPointForLineAlong(a[0],a[1],0,.5);a.splice(1,0,o),n&&r&&n.splice(1,0,n[0])}for(var s,l=0,u=0,c=[],d=0,h=a.length;d<h;d++){var f=a[d],p=Cesium.Cartesian3.fromDegrees(f[0],f[1],f[2]||0);if(p.lonlat=f,0==d){var m=Cesium.JulianDate.addSeconds(i,l,new Cesium.JulianDate);p.time=m,p.second=l,t.addSample(m,p)}else{var g=r?n?n[d-1]:100:n||100,v=Cesium.Cartesian3.distance(p,s);l+=Math.round(v/g*3.6),u+=v,m=Cesium.JulianDate.addSeconds(i,l,new Cesium.JulianDate),p.time=m,p.second=l,t.addSample(m,p)}s=p,c.push(p)}this.arrLinePoint=c,e=Cesium.JulianDate.addSeconds(i,l,new Cesium.JulianDate),this.alllen=u,this.alltimes=l,this.startTime=i,this.stopTime=e,this.property=t,this.property.setInterpolationOptions({interpolationDegree:2,interpolationAlgorithm:Cesium.LagrangePolynomialApproximation})}}},{key:"_createEntity",value:function(){this.options.label.text=this.name;var e=hchx3d.draw.attr.model.style2Entity(this.options.model),t=hchx3d.draw.attr.label.style2Entity(this.options.label),i=hchx3d.draw.attr.polyline.style2Entity(this.options.path,{});i.leadTime=0,i.trailTime=this.alltimes;var a=new Cesium.VelocityOrientationProperty(this.property);this.velocityOrientation=a,this.entity=this.viewer.entities.add({id:this.id,availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:this.startTime,stop:this.stopTime})]),position:this.property,orientation:a,model:e,label:t,path:i,point:{show:!e.show,color:new Cesium.Color.fromCssColorString("#ffffff").withAlpha(.01),pixelSize:1}})}},{key:"updateStyle",value:function(e){for(var t in e)if("object"===r(e[t])&&this.options[t])for(var i in e[t])this.options[t][i]=e[t][i];else this.options[t]=e[t]}},{key:"updateAngle",value:function(e,t){if(e)this.entity.orientation=this.velocityOrientation;else{t=t||{};var i=Cesium.Property.getValueOrUndefined(this.property,this.viewer.clock.currentTime,l),a=Cesium.Property.getValueOrUndefined(this.velocityOrientation,this.viewer.clock.currentTime,u),n=hchx3d.matrix.getHeadingPitchRollByOrientation(i,a).heading,r=Cesium.Math.toRadians(Number(t.pitch||0)),o=Cesium.Math.toRadians(Number(t.roll||0));this.entity.orientation=Cesium.Transforms.headingPitchRollQuaternion(i,new Cesium.HeadingPitchRoll(n,r,o))}}},{key:"start",value:function(){this._isStart&&this.stop(),this._isStart=!0,this.viewer.clock.startTime=this.startTime.clone(),this.viewer.clock.stopTime=this.stopTime.clone(),this.viewer.clock.currentTime=this.startTime.clone(),this.viewer.clock.multiplier=1,this.viewer.clock.shouldAnimate=!0,this.options.clockRange?this.viewer.clock.clockRange=Cesium.ClockRange.LOOP_STOP:this.viewer.clock.clockRange=Cesium.ClockRange.CLAMPED,this.viewer.flyTo(this.entity),this.viewer.trackedEntity=this.entity,this.options.shadow.show&&("wall"==this.options.shadow.type?this.addWallShading():"cylinder"==this.options.shadow.type&&this.addCylinderShading()),this.viewer.scene.preRender.addEventListener(this.preRender_eventHandler,this)}},{key:"preRender_eventHandler",value:function(e){if(this._isStart&&null!=this.entity){switch(this.options.camera.type){default:null!=this.viewer.trackedEntity&&(this.viewer.trackedEntity=void 0);break;case"gs":this.viewer.trackedEntity!=this.entity&&(this.viewer.trackedEntity=this.entity);break;case"dy":this.viewer.trackedEntity!=this.entity&&(this.viewer.trackedEntity=this.entity),this.getModelMatrix(this.viewer.trackedEntity,this.viewer.clock.currentTime,o);var t=this.options.camera.followedX,i=this.options.camera.followedZ;this.viewer.scene.camera.lookAtTransform(o,new Cesium.Cartesian3(-t,0,i));break;case"sd":this.viewer.trackedEntity!=this.entity&&(this.viewer.trackedEntity=this.entity),this.getModelMatrix(this.viewer.trackedEntity,this.viewer.clock.currentTime,o),i=this.options.camera.followedZ,this.viewer.scene.camera.lookAtTransform(o,new Cesium.Cartesian3(-1,0,i))}var a=Cesium.Property.getValueOrUndefined(this.entity.position,this.viewer.clock.currentTime,l);a&&this.realTime(a)}}},{key:"realTime",value:function(e){var t=Cesium.JulianDate.secondsDifference(this.viewer.clock.currentTime,this.viewer.clock.startTime),o=hchx3d.point.formatPositon(e),i=this.getFlyOkPoints(e);this.timeinfo={time:t,len:i.len,x:o.x,y:o.y,z:o.z},this.options.shadow.show&&"wall"==this.options.shadow.type&&this.updateWallShading(i.positions);var a=Cesium.Cartographic.fromCartesian(e),n=this.viewer.scene.globe.getHeight(a);null!=n&&0<n&&(this.timeinfo.hbgd=n,this.timeinfo.ldgd=o.z-n),this.options.showGroundHeight&&hchx3d.util.terrainPolyline({viewer:this.viewer,positions:[e,e],calback:function(e,t){if(null!=e&&0!=e.length&&!t){var i=hchx3d.point.formatPositon(e[0]).z,a=o.z-i;if(this.timeinfo.hbgd=i,this.timeinfo.ldgd=a,this.entity.label){var n=haoutil.str.formatLength(this.timeinfo.z),r=haoutil.str.formatLength(this.timeinfo.ldgd);this.entity.label.text=this.name+"\n漫游高程："+n+"\n离地距离："+r}}}})}},{key:"getFlyOkPoints",value:function(e){for(var t=[],i=0,a=this.viewer.clock.currentTime,n=this.arrLinePoint,r=0,o=n.length;r<o;r++){var s=n[r];if(Cesium.JulianDate.compare(a,s.time)<0){i+=Cesium.Cartesian3.distance(e,0==r?s:n[r-1]);break}0<r&&(i+=Cesium.Cartesian3.distance(s,n[r-1])),t.push(s)}return t.push(e),{positions:t,len:i}}},{key:"getModelMatrix",value:function(e,t,i){if(null==e)return i;var a=Cesium.Property.getValueOrUndefined(e.position,t,l);if(Cesium.defined(a)){var n=Cesium.Property.getValueOrUndefined(e.orientation,t,u);return i=Cesium.defined(n)?Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(n,s),a,i):Cesium.Transforms.eastNorthUpToFixedFrame(a,void 0,i)}}},{key:"addWallShading",value:function(){this._wall_positions=[],this._wall_minimumHeights=[],this._wall_maximumHeights=[];var i=this,e=hchx3d.draw.attr.wall.style2Entity(this.options.shadow);e.minimumHeights=new Cesium.CallbackProperty(function(e){return i._wall_minimumHeights},!1),e.maximumHeights=new Cesium.CallbackProperty(function(e){return i._wall_maximumHeights},!1),e.positions=new Cesium.CallbackProperty(function(e){var t=Cesium.Property.getValueOrUndefined(i.entity.position,i.viewer.clock.currentTime,l);return i._wall_positions[i._wall_positions.length-1]=t,i._wall_positions},!1),this.wallEntity=this.viewer.entities.add({wall:e})}},{key:"updateWallShading",value:function(e){for(var t=[],i=[],a=[],n=0;n<e.length;n++){t.push(e[n].clone());var r=Cesium.Cartographic.fromCartesian(e[n]);i.push(0),a.push(r.height)}this._wall_positions=t,this._wall_minimumHeights=i,this._wall_maximumHeights=a}},{key:"addCylinderShading",value:function(){var n=100,r=100,o=this.property,e=hchx3d.draw.attr.wall.style2Entity(this.options.shadow);e.length=new Cesium.CallbackProperty(function(e){return r},!1),e.topRadius=0,e.bottomRadius=new Cesium.CallbackProperty(function(e){return n},!1),e.numberOfVerticalLines=0,this.cylinderEntity=viewer.entities.add({position:new Cesium.CallbackProperty(function(e){var t=Cesium.Property.getValueOrUndefined(o,e,new Cesium.Cartesian3),i=Cesium.Cartographic.fromCartesian(t),a=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,i.height/2);return r=i.height,n=.3*r,a},!1),cylinder:e})}},{key:"getTerrainHeight",value:function(u){var t=this,c=this.arrLinePoint,d=0,h=[],f=[],p=[],m=[],g=0;!function l(){var e=[c[++g-1],c[g]];hchx3d.util.terrainPolyline({viewer:t.viewer,positions:e,calback:function(e,t){for(var i=c[g-1].lonlat[2],a=(c[g].lonlat[2]-i)/e.length,n=0;n<e.length;n++){0!=n&&(d+=Cesium.Cartesian3.distance(e[n],e[n-1])),h.push(Number(d.toFixed(1)));var r=hchx3d.point.formatPositon(e[n]);m.push(r);var o=t?0:r.z;f.push(o);var s=Number((i+a*n).toFixed(1));p.push(s)}g>=c.length-1?u({arrLength:h,arrFxgd:p,arrHbgd:f,arrPoint:m}):l()}})}()}},{key:"toGeoJSON",value:function(){return this.options}},{key:"toCZML",value:function(){this.options;for(var e=this.startTime.toString(),t=this.stopTime.toString(),i=[],a=this.arrLinePoint,n=0,r=a.length;n<r;n++){var o=a[n];i.push(o.second),i=i.concat(o.lonlat)}var s={id:this.name,description:this.options.remark,availability:e+"/"+t,orientation:{velocityReference:"#position"},position:{epoch:e,cartographicDegrees:i,interpolationAlgorithm:"LAGRANGE",interpolationDegree:2}};return this.options.label.show&&(s.label={show:!0,outlineWidth:2,text:this.name,font:"12pt 微软雅黑 Console",outlineColor:{rgba:[0,0,0,255]},horizontalOrigin:"LEFT",fillColor:{rgba:[213,255,0,255]}}),this.options.path.show&&(s.path={show:!0,material:{solidColor:{color:{rgba:[255,0,0,255]}}},width:5,resolution:1,leadTime:0,trailTime:this.alltimes}),this.options.model.show&&(s.model=this.options.model),[{version:"1.0",id:"document",clock:{interval:e+"/"+t,currentTime:e,multiplier:1}},s]}},{key:"stop",value:function(){this.viewer.trackedEntity=void 0,this.viewer.scene.preRender.removeEventListener(this.preRender_eventHandler,this),this._isStart=!1}},{key:"destroy",value:function(){this.stop(),this.entity&&(this.viewer.entities.remove(this.entity),delete this.entity),this.wallEntity&&(this.viewer.entities.remove(this.wallEntity),delete this.wallEntity),this.cylinderEntity&&(this.viewer.entities.remove(this.cylinderEntity),delete this.cylinderEntity)}}]),d);function d(e,t){for(var i in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),this.viewer=e,this.id=t.id||0,this.name=t.name||"",this.points=t.points,c){var a=c[i];if(t.hasOwnProperty(i)&&"object"===r(t[i]))for(var n in a)t[i].hasOwnProperty(n)||(t[i][n]=a[n]);else t[i]=a}this.options=t,this._isStart=!1,this._createLine(),this._createEntity()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilesEditor=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r};t.TilesEditor=(a(l,[{key:"update",value:function(e){for(var t in e)this[t]=e[t];this.movep.position=this.position,this.rotatep.position=this.rotationPos()}},{key:"modelMatrix",value:function(){var e=s.default.Transforms.eastNorthUpToFixedFrame(this.position),t=s.default.Matrix4.fromRotationTranslation(s.default.Matrix3.fromRotationZ(this.heading));if(s.default.Matrix4.multiply(e,t,e),0<this.scale&&1!=this.scale&&s.default.Matrix4.multiplyByUniformScale(e,this.scale,e),this.axis&&""!=this.axis){var i;switch(this.axis.toUpperCase()){case"Y_UP_TO_Z_UP":i=s.default.Axis.Y_UP_TO_Z_UP;break;case"Z_UP_TO_Y_UP":i=s.default.Axis.Z_UP_TO_Y_UP;break;case"X_UP_TO_Z_UP":i=s.default.Axis.X_UP_TO_Z_UP;break;case"Z_UP_TO_X_UP":i=s.default.Axis.Z_UP_TO_X_UP;break;case"X_UP_TO_Y_UP":i=s.default.Axis.X_UP_TO_Y_UP;break;case"Y_UP_TO_X_UP":i=s.default.Axis.Y_UP_TO_X_UP}i&&(e=s.default.Matrix4.multiplyTransformation(e,i,e))}return e}},{key:"rotationPos",value:function(){var e=new s.default.Cartesian3(this.range,0,0),t=s.default.Matrix4.getRotation(this.modelMatrix(),new s.default.Matrix3);return e=s.default.Matrix3.multiplyByVector(t,e,e),e=s.default.Cartesian3.add(this.position,e,e)}},{key:"pickTerrain",value:function(e){var t=this.viewer.camera.getPickRay(e);return this.viewer.scene.globe.pick(t,this.viewer.scene)}},{key:"setEnable",value:function(e){if(e){var t=this;this.handler.setInputAction(function(e){t.handler_onLeafDown(e)},s.default.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction(function(e){t.handler_onMouseMove(e)},s.default.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){t.handler_onLeftUp(e)},s.default.ScreenSpaceEventType.LEFT_UP),this.rotatep.show=!0,this.movep.show=!0}else this.handler.removeInputAction(s.default.ScreenSpaceEventType.LEFT_DOWN),this.handler.removeInputAction(s.default.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(s.default.ScreenSpaceEventType.LEFT_UP),this.rotatep.show=!1,this.movep.show=!1;this._enable=!1}},{key:"handler_onLeafDown",value:function(e){for(var t=this.scene.drillPick(e.position,2),i=0;i<t.length;i++){var a=t[i];if(s.default.defined(a)&&a.primitive===this.movep){this.dragging=!0,this.scene.screenSpaceCameraController.enableRotate=!1;break}if(s.default.defined(a)&&a.primitive===this.rotatep){this.rotating=!0,this.scene.screenSpaceCameraController.enableRotate=!1;break}}}},{key:"handler_onMouseMove",value:function(e){var t=this.pickTerrain(e.endPosition);if(t)if(this.dragging)this.position=t,this.movep.position=this.position,this.rotatep.position=this.rotationPos(),this.options.onPosition&&this.options.onPosition(this.position);else if(this.rotating){this.rotatep.position=t,this.range=s.default.Cartesian3.distance(this.position,t);var i=s.default.Transforms.eastNorthUpToFixedFrame(this.position);i=s.default.Matrix4.getRotation(i,new s.default.Matrix3);var a=s.default.Matrix3.getColumn(i,0,new s.default.Cartesian3),n=s.default.Matrix3.getColumn(i,1,new s.default.Cartesian3),r=s.default.Matrix3.getColumn(i,2,new s.default.Cartesian3),o=s.default.Cartesian3.subtract(t,this.position,new s.default.Cartesian3);o=s.default.Cartesian3.cross(o,r,o),o=s.default.Cartesian3.cross(r,o,o),o=s.default.Cartesian3.normalize(o,o),this.heading=s.default.Cartesian3.angleBetween(a,o),s.default.Cartesian3.angleBetween(n,o)>.5*Math.PI&&(this.heading=2*Math.PI-this.heading),this.options.onHeading&&this.options.onHeading(this.heading)}}},{key:"handler_onLeftUp",value:function(e){(this.dragging||this.rotating)&&(this.rotating=this.dragging=!1,this.scene.screenSpaceCameraController.enableRotate=!0,this.billboards._createVertexArray=!0)}},{key:"remove",value:function(){this.billboards&&(this.scene.primitives.remove(this.billboards),this.billboards=void 0),this.enable=!1}},{key:"destroy",value:function(){this.remove(),this.handler.destroy(),this.handler=null,this.viewer=null}}]),l);function l(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.viewer=e,this.scene=this.viewer.scene,this.options=t,this.position=t.position,this.heading=t.heading||0,this.range=t.range||100,this.dragging=!1,this.rotating=!1,this.enable=!1,this.billboards=this.viewer.scene.primitives.add(new s.default.BillboardCollection),this.handler=new s.default.ScreenSpaceEventHandler(this.viewer.canvas),this.movep=this.billboards.add({position:this.position,color:new s.default.Color.fromCssColorString("#FFFF00"),image:t.moveImg,show:!1,disableDepthTestDistance:Number.POSITIVE_INFINITY}),this.rotatep=this.billboards.add({position:this.position?this.rotationPos():null,color:new s.default.Color.fromCssColorString("#FFFF00"),image:t.rotateImg,show:!1,disableDepthTestDistance:Number.POSITIVE_INFINITY})}},function(e,t){e.exports="uniform sampler2D colorTexture;\r\nvarying vec2 v_textureCoordinates;\r\n\r\nfloat hash(float x){\r\n    return fract(sin(x*133.3)*13.13);\r\n}\r\n\r\nvoid main(void){ \r\n    float time = czm_frameNumber / 240.0;\r\n    vec2 resolution = czm_viewport.zw;\r\n\r\n    vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\r\n    vec3 c=vec3(.6,.7,.8);\r\n\r\n    float a=-.4;\r\n    float si=sin(a),co=cos(a);\r\n    uv*=mat2(co,-si,si,co);\r\n    uv*=length(uv+vec2(0,4.9))*.3+1.;\r\n\r\n    float v=1.-sin(hash(floor(uv.x*100.))*2.);\r\n    float b=clamp(abs(sin(20.*time*v+uv.y*(5./(2.+v))))-.95,0.,1.)*20.;\r\n    c*=v*b; \r\n\r\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(c,1), 0.5);  \r\n}\r\n                        "},function(e,t){e.exports="uniform sampler2D colorTexture;\r\nvarying vec2 v_textureCoordinates;\r\n\r\nfloat snow(vec2 uv,float scale){\r\n    float time = czm_frameNumber / 60.0;\r\n    float w=smoothstep(1.,0.,-uv.y*(scale/10.));if(w<.1)return 0.;\r\n    uv+=time/scale;uv.y+=time*2./scale;uv.x+=sin(uv.y+time*.5)/scale;\r\n    uv*=scale;vec2 s=floor(uv),f=fract(uv),p;float k=3.,d;\r\n    p=.5+.35*sin(11.*fract(sin((s+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);k=min(d,k);\r\n    k=smoothstep(0.,k,sin(f.x+f.y)*0.01);\r\n    return k*w;\r\n}\r\n\r\nvoid main(void){\r\n    vec2 resolution = czm_viewport.zw;\r\n    vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\r\n    vec3 finalColor=vec3(0);\r\n    float c = 0.0;\r\n    // c+=snow(uv,30.)*.0;\r\n    // c+=snow(uv,20.)*.0;\r\n    // c+=snow(uv,15.)*.0;\r\n    c+=snow(uv,10.);\r\n    c+=snow(uv,8.);\r\n    c+=snow(uv,6.);\r\n    c+=snow(uv,5.);\r\n    finalColor=(vec3(c)); \r\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(finalColor,1), 0.5); \r\n\r\n}"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CircleFadeMaterial=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r};var l=new s.default.Color(0,0,0,0),u=t.CircleFadeMaterial=(a(c,[{key:"getType",value:function(e){return s.default.Material.CircleFadeMaterialType}},{key:"getValue",value:function(e,t){return s.default.defined(t)||(t={}),t.color=s.default.Property.getValueOrClonedDefault(this._color,e,l,t.color),void 0===this._time&&(this._time=(new Date).getTime()),t.time=((new Date).getTime()-this._time)/this._duration,t}},{key:"equals",value:function(e){return this===e||e instanceof c&&s.default.Property.equals(this._color,e._color)}},{key:"isConstant",get:function(){return!1}},{key:"definitionChanged",get:function(){return this._definitionChanged}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),e=s.default.defaultValue(e,s.default.defaultValue.EMPTY_OBJECT),this._definitionChanged=new s.default.Event,this._color=void 0,this._colorSubscription=void 0,this.color=s.default.defaultValue(e.color,l),this._duration=e.duration||1e3,this._time=void 0}s.default.defineProperties(u.prototype,{color:s.default.createPropertyDescriptor("color")}),s.default.Material.CircleFadeMaterialType="CircleFadeMaterial",s.default.Material._materialCache.addMaterial(s.default.Material.CircleFadeMaterialType,{fabric:{type:s.default.Material.CircleFadeMaterialType,uniforms:{color:new s.default.Color(1,0,0,1),time:1},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                {\n                    czm_material material = czm_getDefaultMaterial(materialInput);\n                    material.diffuse = 1.5 * color.rgb;\n                    vec2 st = materialInput.st;\n                    float dis = distance(st, vec2(0.5, 0.5));\n                    float per = fract(time);\n                    if(dis > per * 0.5){\n                        //material.alpha = 0.0;\n                        discard;\n                    }else {\n                            material.alpha = color.a  * dis / per / 2.0;\n                    }\n                    return material;\n                }"},translucent:function(){return!0}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextMaterial=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r};var l=new s.default.Color(0,0,0,0),u={font:"50px 楷体",fill:!0,fillColor:new s.default.Color(1,1,0,1),stroke:!0,strokeWidth:2,strokeColor:new s.default.Color(1,1,1,.8),backgroundColor:new s.default.Color(1,1,1,.1),textBaseline:"top",padding:40},c=new s.default.Cartesian2(1,1),d=t.TextMaterial=(a(h,[{key:"getType",value:function(e){return this._materialType}},{key:"getValue",value:function(e,t){return s.default.defined(t)||(t={}),t.color=s.default.Property.getValueOrClonedDefault(this._color,e,l,t.color),t.image=this._materialImage,t.repeat=this.repeat,t}},{key:"equals",value:function(e){return this===e||e instanceof h&&s.default.Property.equals(this._color,e._color)}},{key:"_text2Img",value:function(e,t){var i=s.default.writeTextToCanvas(e,t);if(i){this.canvas=i;var a=new Image;return a.src=i.toDataURL("image/png"),a}}},{key:"isConstant",get:function(){return!1}},{key:"definitionChanged",get:function(){return this._definitionChanged}},{key:"text",get:function(){return this._text},set:function(e){if(e){this._text=e,delete this._img,this._img=this._text2Img(this._text,this._textStyles);var t=m(this._img.src,this.repeat);this._materialType=s.default.clone(t.type),this._materialImage=s.default.clone(t.image)}}},{key:"textStyles",get:function(){return this._textStyles},set:function(e){if(e){delete this._img,this._textStyles=e,this._img=this._text2Img(this._text,this._textStyles);var t=m(this._img.src,this.repeat);this._materialType=s.default.clone(t.type),this._materialImage=s.default.clone(t.image)}}}]),h);function h(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(e=s.default.defaultValue(e,s.default.defaultValue.EMPTY_OBJECT)).text){this._text=e.text,this._textStyles=s.default.defaultValue(e.textStyles,u),this._definitionChanged=new s.default.Event,this._color=void 0,this._colorSubscription=void 0,this.color=s.default.defaultValue(e.color,l),this.repeat=s.default.defaultValue(e.repeat,c),this._img=this._text2Img(this._text,this._textStyles);var t=m(this._img.src,this.repeat);this._materialType=s.default.clone(t.type),this._materialImage=s.default.clone(t.image)}}s.default.defineProperties(d.prototype,{color:s.default.createPropertyDescriptor("color")});var f=0,p="Text";function m(e,t){var i=p+ ++f+"Type",a=p+f+"Image";return s.default.Material[i]=i,s.default.Material[a]=e,s.default.Material._materialCache.addMaterial(s.default.Material[i],{fabric:{type:s.default.Material.PolylineArrowLinkType,uniforms:{color:new s.default.Color(1,0,0,1),image:s.default.Material[a],time:0,repeat:t||new s.default.Cartesian2(1,1)},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                        {\n                            czm_material material = czm_getDefaultMaterial(materialInput);\n                            vec2 mst = fract(materialInput.st + vec2(.0,.0));\n                            mst = vec2(mst.x,mst.y);\n                            vec2 st = fract(repeat * mst);\n                            vec4 colorImage = texture2D(image, st);\n                            if(color.a == 0.0)\n                            {\n                                material.alpha = colorImage.a;\n                                material.diffuse = colorImage.rgb; \n                            }\n                            else\n                            {\n                                material.alpha = colorImage.a * color.a;\n                                material.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb); \n                            }\n                            return material;\n                        }"},translucent:function(){return!0}}),{type:s.default.Material[i],image:s.default.Material[a]}}},function(e,t){e.exports="attribute vec4 position;\r\nattribute vec3 normal;\r\n\r\nvarying vec3 v_position;\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = czm_modelViewProjection * position;\r\n    v_position = vec3(position);\r\n    v_positionWC = (czm_model * position).xyz;\r\n    v_positionEC = (czm_modelView * position).xyz;\r\n    v_normalEC = czm_normal * normal;\r\n}"},function(e,t){e.exports='#ifdef GL_OES_standard_derivatives\r\n    #extension GL_OES_standard_derivatives : enable\r\n#endif\r\n\r\nuniform bool u_showIntersection;\r\nuniform bool u_showThroughEllipsoid;\r\n\r\nuniform float u_radius;\r\nuniform float u_xHalfAngle;\r\nuniform float u_yHalfAngle;\r\nuniform float u_normalDirection;\r\nuniform float u_type;\r\n\r\nvarying vec3 v_position;\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvec4 getColor(float sensorRadius, vec3 pointEC)\r\n{\r\n    czm_materialInput materialInput;\r\n\r\n    vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\r\n    materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\r\n    materialInput.str = pointMC / sensorRadius;\r\n\r\n    vec3 positionToEyeEC = -v_positionEC;\r\n    materialInput.positionToEyeEC = positionToEyeEC;\r\n\r\n    vec3 normalEC = normalize(v_normalEC);\r\n    materialInput.normalEC = u_normalDirection * normalEC;\r\n\r\n    czm_material material = czm_getMaterial(materialInput);\r\n\r\n    return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\r\n\r\n}\r\n\r\nbool isOnBoundary(float value, float epsilon)\r\n{\r\n    float width = getIntersectionWidth();\r\n    float tolerance = width * epsilon;\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    float delta = max(abs(dFdx(value)), abs(dFdy(value)));\r\n    float pixels = width * delta;\r\n    float temp = abs(value);\r\n    // There are a couple things going on here.\r\n    // First we test the value at the current fragment to see if it is within the tolerance.\r\n    // We also want to check if the value of an adjacent pixel is within the tolerance,\r\n    // but we don\'t want to admit points that are obviously not on the surface.\r\n    // For example, if we are looking for "value" to be close to 0, but value is 1 and the adjacent value is 2,\r\n    // then the delta would be 1 and "temp - delta" would be "1 - 1" which is zero even though neither of\r\n    // the points is close to zero.\r\n    return temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\r\n#else\r\n    return abs(value) < tolerance;\r\n#endif\r\n}\r\n\r\nvec4 shade(bool isOnBoundary)\r\n{\r\n    if (u_showIntersection && isOnBoundary)\r\n    {\r\n        return getIntersectionColor();\r\n    }\r\n    if(u_type == 1.0){\r\n        return getLineColor();\r\n    }\r\n    return getColor(u_radius, v_positionEC);\r\n}\r\n\r\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\r\n{\r\n    vec3 scaled = ellipsoid.inverseRadii * point;\r\n    return dot(scaled, scaled) - 1.0;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec3 sensorVertexWC = czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\r\n    vec3 sensorVertexEC = czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\r\n\r\n    //vec3 pixDir = normalize(v_position);\r\n    float positionX = v_position.x;\r\n    float positionY = v_position.y;\r\n    float positionZ = v_position.z;\r\n\r\n    vec3 zDir = vec3(0.0, 0.0, 1.0);\r\n    vec3 lineX = vec3(positionX, 0 ,positionZ);\r\n    vec3 lineY = vec3(0, positionY, positionZ);\r\n    float resX = dot(normalize(lineX), zDir);\r\n    if(resX < cos(u_xHalfAngle)-0.00001){\r\n        discard;\r\n    }\r\n    float resY = dot(normalize(lineY), zDir);\r\n    if(resY < cos(u_yHalfAngle)-0.00001){\r\n        discard;\r\n    }\r\n\r\n\r\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\r\n    float ellipsoidValue = ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\r\n\r\n    // Occluded by the ellipsoid?\r\n\tif (!u_showThroughEllipsoid)\r\n\t{\r\n\t    // Discard if in the ellipsoid\r\n\t    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\r\n\t    if (ellipsoidValue < 0.0)\r\n\t    {\r\n            discard;\r\n\t    }\r\n\r\n\t    // Discard if in the sensor\'s shadow\r\n\t    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\r\n\t    {\r\n\t        discard;\r\n\t    }\r\n    }\r\n\r\n    // Notes: Each surface functions should have an associated tolerance based on the floating point error.\r\n    bool isOnEllipsoid = isOnBoundary(ellipsoidValue, czm_epsilon3);\r\n    //isOnEllipsoid = false;\r\n    //if((resX >= 0.8 && resX <= 0.81)||(resY >= 0.8 && resY <= 0.81)){\r\n    /*if(false){\r\n        gl_FragColor = vec4(1.0,0.0,0.0,1.0);\r\n    }else{\r\n        gl_FragColor = shade(isOnEllipsoid);\r\n    }\r\n*/\r\n    gl_FragColor = shade(isOnEllipsoid);\r\n\r\n}'},function(e,t){e.exports="uniform vec4 u_intersectionColor;\nuniform float u_intersectionWidth;\nuniform vec4 u_lineColor;\n\nbool inSensorShadow(vec3 coneVertexWC, czm_ellipsoid ellipsoidEC, vec3 pointWC)\n{\n    // Diagonal matrix from the unscaled ellipsoid space to the scaled space.    \n    vec3 D = ellipsoidEC.inverseRadii;\n\n    // Sensor vertex in the scaled ellipsoid space\n    vec3 q = D * coneVertexWC;\n    float qMagnitudeSquared = dot(q, q);\n    float test = qMagnitudeSquared - 1.0;\n    \n    // Sensor vertex to fragment vector in the ellipsoid's scaled space\n    vec3 temp = D * pointWC - q;\n    float d = dot(temp, q);\n    \n    // Behind silhouette plane and inside silhouette cone\n    return (d < -test) && (d / length(temp) < -sqrt(test));\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\nvec4 getLineColor()\n{\n    return u_lineColor;\n}\n\nvec4 getIntersectionColor()\n{\n    return u_intersectionColor;\n}\n\nfloat getIntersectionWidth()\n{\n    return u_intersectionWidth;\n}\n\nvec2 sensor2dTextureCoordinates(float sensorRadius, vec3 pointMC)\n{\n    // (s, t) both in the range [0, 1]\n    float t = pointMC.z / sensorRadius;\n    float s = 1.0 + (atan(pointMC.y, pointMC.x) / czm_twoPi);\n    s = s - floor(s);\n    \n    return vec2(s, t);\n}\n"},function(e,t){e.exports='#ifdef GL_OES_standard_derivatives\r\n    #extension GL_OES_standard_derivatives : enable\r\n#endif\r\n\r\nuniform bool u_showIntersection;\r\nuniform bool u_showThroughEllipsoid;\r\n\r\nuniform float u_radius;\r\nuniform float u_xHalfAngle;\r\nuniform float u_yHalfAngle;\r\nuniform float u_normalDirection;\r\nuniform vec4 u_color;\r\n\r\nvarying vec3 v_position;\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvec4 getColor(float sensorRadius, vec3 pointEC)\r\n{\r\n    czm_materialInput materialInput;\r\n\r\n    vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\r\n    materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\r\n    materialInput.str = pointMC / sensorRadius;\r\n\r\n    vec3 positionToEyeEC = -v_positionEC;\r\n    materialInput.positionToEyeEC = positionToEyeEC;\r\n\r\n    vec3 normalEC = normalize(v_normalEC);\r\n    materialInput.normalEC = u_normalDirection * normalEC;\r\n\r\n    czm_material material = czm_getMaterial(materialInput);\r\n\r\n    material.diffuse = u_color.rgb;\r\n    material.alpha = u_color.a;\r\n\r\n    return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\r\n\r\n}\r\n\r\nbool isOnBoundary(float value, float epsilon)\r\n{\r\n    float width = getIntersectionWidth();\r\n    float tolerance = width * epsilon;\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    float delta = max(abs(dFdx(value)), abs(dFdy(value)));\r\n    float pixels = width * delta;\r\n    float temp = abs(value);\r\n    // There are a couple things going on here.\r\n    // First we test the value at the current fragment to see if it is within the tolerance.\r\n    // We also want to check if the value of an adjacent pixel is within the tolerance,\r\n    // but we don\'t want to admit points that are obviously not on the surface.\r\n    // For example, if we are looking for "value" to be close to 0, but value is 1 and the adjacent value is 2,\r\n    // then the delta would be 1 and "temp - delta" would be "1 - 1" which is zero even though neither of\r\n    // the points is close to zero.\r\n    return temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\r\n#else\r\n    return abs(value) < tolerance;\r\n#endif\r\n}\r\n\r\nvec4 shade(bool isOnBoundary)\r\n{\r\n    if (u_showIntersection && isOnBoundary)\r\n    {\r\n        return getIntersectionColor();\r\n    }\r\n    return getColor(u_radius, v_positionEC);\r\n}\r\n\r\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\r\n{\r\n    vec3 scaled = ellipsoid.inverseRadii * point;\r\n    return dot(scaled, scaled) - 1.0;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec3 sensorVertexWC = czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\r\n    vec3 sensorVertexEC = czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\r\n\r\n    //vec3 pixDir = normalize(v_position);\r\n    float positionX = v_position.x;\r\n    float positionY = v_position.y;\r\n    float positionZ = v_position.z;\r\n\r\n    vec3 zDir = vec3(0.0, 0.0, 1.0);\r\n    vec3 lineX = vec3(positionX, 0 ,positionZ);\r\n    vec3 lineY = vec3(0, positionY, positionZ);\r\n    float resX = dot(normalize(lineX), zDir);\r\n    if(resX < cos(u_xHalfAngle) - 0.0001){\r\n        discard;\r\n    }\r\n    float resY = dot(normalize(lineY), zDir);\r\n    if(resY < cos(u_yHalfAngle)- 0.0001){\r\n        discard;\r\n    }\r\n\r\n\r\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\r\n    float ellipsoidValue = ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\r\n\r\n    // Occluded by the ellipsoid?\r\n\tif (!u_showThroughEllipsoid)\r\n\t{\r\n\t    // Discard if in the ellipsoid\r\n\t    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\r\n\t    if (ellipsoidValue < 0.0)\r\n\t    {\r\n            discard;\r\n\t    }\r\n\r\n\t    // Discard if in the sensor\'s shadow\r\n\t    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\r\n\t    {\r\n\t        discard;\r\n\t    }\r\n    }\r\n\r\n    // Notes: Each surface functions should have an associated tolerance based on the floating point error.\r\n    bool isOnEllipsoid = isOnBoundary(ellipsoidValue, czm_epsilon3);\r\n    gl_FragColor = shade(isOnEllipsoid);\r\n\r\n}'},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RectangularSensorVisualizer=void 0;var a,n=i(0),b=(a=n)&&a.__esModule?a:{default:a},C=i(42),u=i(109);function r(e,t){if(!M(e))throw new E("scene is required.");if(!M(t))throw new E("entityCollection is required.");t.collectionChanged.addEventListener(r.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._hash={},this._entitiesToVisualize=new o,this._onCollectionChanged(t,t.values,[],[])}var o=b.default.AssociativeArray,x=b.default.Cartesian3,P=b.default.Color,M=b.default.defined,s=b.default.destroyObject,E=b.default.DeveloperError,S=b.default.Matrix3,T=b.default.Matrix4,D=b.default.Quaternion,k=b.default.MaterialProperty,O=b.default.Property,A=new S,L=new x,R=new x,F=new D,V=new x,N=new D;r.prototype.update=function(e){if(!M(e))throw new E("time is required.");for(var t=this._entitiesToVisualize.values,i=this._hash,a=this._primitives,n=0,r=t.length;n<r;n++){var o,s,l,u,c=t[n],d=c._rectangularSensor,h=i[c.id],f=c.isShowing&&c.isAvailable(e)&&O.getValueOrDefault(d._show,e,!0);if(f&&(o=O.getValueOrUndefined(c._position,e,L),w=O.getValueOrUndefined(c._orientation,e,F),s=O.getValueOrUndefined(d._radius,e),l=O.getValueOrUndefined(d._xHalfAngle,e),u=O.getValueOrUndefined(d._yHalfAngle,e),f=M(o)&&M(l)&&M(u)),f){var p=M(h)?h.primitive:void 0;M(p)||((p=new C.RectangularSensorPrimitive).id=c,a.add(p),h={primitive:p,position:void 0,orientation:void 0},i[c.id]=h);var m=O.getValueOrUndefined(d._gaze,e);if(M(m)){var g=O.getValueOrUndefined(m._position,e,R);if(!M(o)||!M(g))continue;var v=x.subtract(o,g,V),y=x.angleBetween(b.default.Cartesian3.UNIT_Z,v),_=x.cross(b.default.Cartesian3.UNIT_Z,v,V),w=D.fromAxisAngle(_,y-Math.PI,N);s=x.distance(o,g),p.modelMatrix=T.fromRotationTranslation(S.fromQuaternion(w,A),o,p.modelMatrix)}else x.equals(o,h.position)&&D.equals(w,h.orientation)||(M(w)?(p.modelMatrix=T.fromRotationTranslation(S.fromQuaternion(w,A),o,p.modelMatrix),h.position=x.clone(o,h.position),h.orientation=D.clone(w,h.orientation)):(p.modelMatrix=b.default.Transforms.eastNorthUpToFixedFrame(o),h.position=x.clone(o,h.position)));p.show=!0,p.gaze=m,p.radius=s,p.xHalfAngle=l,p.yHalfAngle=u,p.lineColor=O.getValueOrDefault(d._lineColor,e,P.WHITE),p.showSectorLines=O.getValueOrDefault(d._showSectorLines,e,!0),p.showSectorSegmentLines=O.getValueOrDefault(d._showSectorSegmentLines,e,!0),p.showLateralSurfaces=O.getValueOrDefault(d._showLateralSurfaces,e,!0),p.material=k.getValue(e,d._material,p.material),p.showDomeSurfaces=O.getValueOrDefault(d._showDomeSurfaces,e,!0),p.showDomeLines=O.getValueOrDefault(d._showDomeLines,e,!0),p.showIntersection=O.getValueOrDefault(d._showIntersection,e,!0),p.intersectionColor=O.getValueOrDefault(d._intersectionColor,e,P.WHITE),p.intersectionWidth=O.getValueOrDefault(d._intersectionWidth,e,1),p.showThroughEllipsoid=O.getValueOrDefault(d._showThroughEllipsoid,e,!0),p.scanPlaneMode=O.getValueOrDefault(d._scanPlaneMode,e),p.scanPlaneColor=O.getValueOrDefault(d._scanPlaneColor,e,P.WHITE),p.showScanPlane=O.getValueOrDefault(d._showScanPlane,e,!0),p.scanPlaneRate=O.getValueOrDefault(d._scanPlaneRate,e,1)}else M(h)&&(h.primitive.show=!1)}return!0},r.prototype.isDestroyed=function(){return!1},r.prototype.destroy=function(){for(var e=this._entitiesToVisualize.values,t=this._hash,i=this._primitives,a=e.length-1;-1<a;a--)(0,u.removePrimitive)(e[a],t,i);return s(this)},r.prototype._onCollectionChanged=function(e,t,i,a){var n,r,o=this._entitiesToVisualize,s=this._hash,l=this._primitives;for(n=t.length-1;-1<n;n--)r=t[n],M(r._rectangularSensor)&&M(r._position)&&o.set(r.id,r);for(n=a.length-1;-1<n;n--)r=a[n],M(r._rectangularSensor)&&M(r._position)?o.set(r.id,r):((0,u.removePrimitive)(r,s,l),o.remove(r.id));for(n=i.length-1;-1<n;n--)r=i[n],(0,u.removePrimitive)(r,s,l),o.remove(r.id)},t.RectangularSensorVisualizer=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removePrimitive=function(e,t,i){var a=t[e.id];if(r.default.defined(a)){var n=a.primitive;try{i.remove(n)}catch(e){}n.isDestroyed&&!n.isDestroyed()&&n.destroy(),delete t[e.id]}};var a,n=i(0),r=(a=n)&&a.__esModule?a:{default:a}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainClipPlan=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),g=(r=o)&&r.__esModule?r:{default:r};t.TerrainClipPlan=(a(s,[{key:"updateData",value:function(e){this.clear();var t=[],i=e.length,a=new g.default.Cartesian3,n=g.default.Cartesian3.subtract(e[0],e[1],a);n=0<n.x,this.excavateMinHeight=9999;for(var r=0;r<i;++r){var o=(r+1)%i,s=g.default.Cartesian3.midpoint(e[r],e[o],new g.default.Cartesian3),l=g.default.Cartographic.fromCartesian(e[r]),u=viewer.scene.globe.getHeight(l)||l.height;u<this.excavateMinHeight&&(this.excavateMinHeight=u);var c,d=g.default.Cartesian3.normalize(s,new g.default.Cartesian3);c=n?g.default.Cartesian3.subtract(e[r],s,new g.default.Cartesian3):g.default.Cartesian3.subtract(e[o],s,new g.default.Cartesian3),c=g.default.Cartesian3.normalize(c,c);var h=g.default.Cartesian3.cross(c,d,new g.default.Cartesian3);h=g.default.Cartesian3.normalize(h,h);var f=new g.default.Plane(h,0),p=g.default.Plane.getPointDistance(f,s);t.push(new g.default.ClippingPlane(h,p))}this.viewer.scene.globe.clippingPlanes=new g.default.ClippingPlaneCollection({planes:t,edgeWidth:1,edgeColor:g.default.Color.WHITE,enabled:!0}),this._prepareWell(e),this._createWell(this.wellData)}},{key:"clear",value:function(){this.viewer.scene.globe.clippingPlanes&&(this.viewer.scene.globe.clippingPlanes.enabled=!1,this.viewer.scene.globe.clippingPlanes.removeAll(),this.viewer.scene.globe.clippingPlanes.isDestroyed()||this.viewer.scene.globe.clippingPlanes.destroy()),this.viewer.scene.globe.clippingPlanes=void 0,this.bottomSurface&&this.viewer.scene.primitives.remove(this.bottomSurface),this.wellWall&&this.viewer.scene.primitives.remove(this.wellWall),delete this.bottomSurface,delete this.wellWall,this.viewer.scene.render()}},{key:"_prepareWell",value:function(e){var t=this.splitNum,i=e.length;if(0!=i){for(var a=this.excavateMinHeight-this.height,n=[],r=[],o=[],s=0;s<i;s++){var l=s==i-1?0:s+1,u=g.default.Cartographic.fromCartesian(e[s]),c=g.default.Cartographic.fromCartesian(e[l]),d=[u.longitude,u.latitude],h=[c.longitude,c.latitude];0==s&&(o.push(new g.default.Cartographic(d[0],d[1])),r.push(g.default.Cartesian3.fromRadians(d[0],d[1],a)),n.push(g.default.Cartesian3.fromRadians(d[0],d[1],0)));for(var f=1;f<=t;f++){var p=g.default.Math.lerp(d[0],h[0],f/t),m=g.default.Math.lerp(d[1],h[1],f/t);s==i-1&&f==t||(o.push(new g.default.Cartographic(p,m)),r.push(g.default.Cartesian3.fromRadians(p,m,a)),n.push(g.default.Cartesian3.fromRadians(p,m,0)))}}this.wellData={lerp_pos:o,bottom_pos:r,no_height_top:n}}}},{key:"_createWell",value:function(r){if(Boolean(this.viewer.terrainProvider._layers)){var o=this;this._createBottomSurface(r.bottom_pos);var e=g.default.sampleTerrainMostDetailed(viewer.terrainProvider,r.lerp_pos);g.default.when(e,function(e){for(var t=e.length,i=[],a=0;a<t;a++){var n=g.default.Cartesian3.fromRadians(e[a].longitude,e[a].latitude,e[a].height);i.push(n)}o._createWellWall(r.bottom_pos,i)})}else this._createBottomSurface(r.bottom_pos),this._createWellWall(r.bottom_pos,r.no_height_top)}},{key:"_createWellWall",value:function(e,t){var i=new g.default.WellNoBottom({minimumArr:e,maximumArr:t});i=g.default.WellNoBottom.createGeometry(i);var a=new g.default.Material({fabric:{type:"Image",uniforms:{image:this.wallImg}}}),n=new g.default.MaterialAppearance({translucent:!1,flat:!0,material:a});this.wellWall=new g.default.Primitive({geometryInstances:new g.default.GeometryInstance({geometry:i,attributes:{color:g.default.ColorGeometryInstanceAttribute.fromColor(g.default.Color.GREY)},id:"PitWall"}),appearance:n,asynchronous:!1}),this.viewer.scene.primitives.add(this.wellWall)}},{key:"_createBottomSurface",value:function(e){if(e.length){var t=new g.default.CustomPlaneGeometry({pos_arr:e});t=g.default.CustomPlaneGeometry.createGeometry(t);var i=new g.default.Material({fabric:{type:"Image",uniforms:{image:this.bottomImg}}}),a=new g.default.MaterialAppearance({translucent:!1,flat:!0,material:i});this.bottomSurface=new g.default.Primitive({geometryInstances:new g.default.GeometryInstance({geometry:t}),appearance:a,asynchronous:!1}),this.viewer.scene.primitives.add(this.bottomSurface)}}},{key:"_switchExcavate",value:function(e){e?(this.viewer.scene.globe.material=g.default.Material.fromType("WaJue"),this.wellWall.show=!0,this.bottomSurface.show=!0):(this.viewer.scene.globe.material=null,this.wellWall.show=!1,this.bottomSurface.show=!1)}},{key:"_updateExcavateDepth",value:function(e){this.bottomSurface&&this.viewer.scene.primitives.remove(this.bottomSurface),this.wellWall&&this.viewer.scene.primitives.remove(this.wellWall);for(var t=this.wellData.lerp_pos,i=[],a=t.length,n=0;n<a;n++)i.push(g.default.Cartesian3.fromRadians(t[n].longitude,t[n].latitude,this.excavateMinHeight-e));this.wellData.bottom_pos=i,this._createWell(this.wellData),this.viewer.scene.primitives.add(this.bottomSurface),this.viewer.scene.primitives.add(this.wellWall)}},{key:"show",get:function(){return this._show},set:function(e){this._show=e,this.viewer.scene.globe.clippingPlanes&&(this.viewer.scene.globe.clippingPlanes.enabled=e),this._switchExcavate(e)}},{key:"height",get:function(){return this._height},set:function(e){this._height=e,this._updateExcavateDepth(e)}}]),s);function s(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.viewer=e,this.options=t||{},this._positions=t.positions,this._height=this.options.height||0,this.bottomImg=t.bottomImg,this.wallImg=t.wallImg,this.splitNum=g.default.defaultValue(t.splitNum,50),this._positions&&0<this._positions.length&&this.updateData(this._positions)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilesetClipPlan=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r};function l(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.tileset=e,this.options=t||{},this.options.type&&(this.type=this.options.type),this.options.distance&&(this.distance=this.options.distance)}(t.TilesetClipPlan=(a(l,[{key:"createPlane",value:function(e){var t;switch(this.clear(),e){case l.Type.Z:t=[new s.default.ClippingPlane(new s.default.Cartesian3(0,0,1),1)];break;default:case l.Type.ZR:t=[new s.default.ClippingPlane(new s.default.Cartesian3(0,0,-1),1)];break;case l.Type.X:t=[new s.default.ClippingPlane(new s.default.Cartesian3(1,0,0),1)];break;case l.Type.XR:t=[new s.default.ClippingPlane(new s.default.Cartesian3(-1,0,0),1)];break;case l.Type.Y:t=[new s.default.ClippingPlane(new s.default.Cartesian3(0,1,0),1)];break;case l.Type.YR:t=[new s.default.ClippingPlane(new s.default.Cartesian3(0,-1,0),1)]}var i=new s.default.ClippingPlaneCollection({planes:t,edgeWidth:this.options.edgeWidth||0});this.clippingPlanes=i,this.tileset.clippingPlanes=i}},{key:"updateDistance",value:function(e){if(null!=this.clippingPlanes)for(var t=0;t<this.clippingPlanes.length;t++)this.clippingPlanes.get(t).distance=e}},{key:"clear",value:function(){this.tileset.clippingPlanes&&(this.tileset.clippingPlanes.enabled=!1),this.clippingPlanes&&(this.clippingPlanes.destroy(),delete this.clippingPlanes)}},{key:"planes",get:function(){return this.clippingPlanes}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this.createPlane(e)}},{key:"distance",get:function(){return this._distance||0},set:function(e){this._distance=e,this.updateDistance(e)}}]),l)).Type={Z:1,ZR:2,X:3,XR:4,Y:5,YR:6}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FloodByEntity=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r},l=i(1);t.FloodByEntity=(a(u,[{key:"start",value:function(e,t){this.stop(),this.entity=e,this.options=t;var i=this;this._last_depthTestAgainstTerrain=this.viewer.scene.globe.depthTestAgainstTerrain,this.viewer.scene.globe.depthTestAgainstTerrain=!0,this.extrudedHeight=t.height,this.entity.polygon.extrudedHeight=new s.default.CallbackProperty(function(e){return i.extrudedHeight},!1);var a=this.entity.polygon.hierarchy.getValue();this.entity.polygon.hierarchy=(0,l.setPositionsHeight)(a,t.height),this.timeIdx=setInterval(function(){if(i.extrudedHeight>i.options.maxHeight)return t.onStop&&t.onStop(),void i.stop();i.extrudedHeight+=i.options.speed/10,t.onChange&&t.onChange(i.extrudedHeight)},100)}},{key:"stop",value:function(){clearInterval(this.timeIdx)}},{key:"clear",value:function(){this.stop(),null!==this._last_depthTestAgainstTerrain&&(this.viewer.scene.globe.depthTestAgainstTerrain=this._last_depthTestAgainstTerrain),this.entity=null}},{key:"updateHeight",value:function(e){this.extrudedHeight=e}},{key:"height",get:function(){return this.extrudedHeight},set:function(e){this.extrudedHeight=e}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.viewer=e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewShed3D=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var c=s(i(0)),r=s(i(114)),o=i(43);function s(e){return e&&e.__esModule?e:{default:e}}var l={cameraPosition:null,viewPosition:null,horizontalAngle:120,verticalAngle:90,visibleAreaColor:new c.default.Color(0,1,0),hiddenAreaColor:new c.default.Color(1,0,0),alpha:.5,distance:100,frustum:!0,show:!0};t.ViewShed3D=(a(u,[{key:"_bindMourseEvent",value:function(){var a=this,n=this.viewer,e=new c.default.ScreenSpaceEventHandler(this.viewer.scene.canvas);e.setInputAction(function(e){var t=hchx3d.point.getCurrentMousePosition(n.scene,e.position);t&&(a.cameraPosition?a.cameraPosition&&!a.viewPosition&&(a.viewPosition=t,a._addToScene(),a._unbindMourseEvent(),a.calback&&a.calback()):a.cameraPosition=t)},c.default.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(e){var t=hchx3d.point.getCurrentMousePosition(n.scene,e.endPosition);if(t){var i=a.cameraPosition;i&&(a.frustumQuaternion=a.getFrustumQuaternion(i,t),a.distance=Number(c.default.Cartesian3.distance(i,t).toFixed(1)))}},c.default.ScreenSpaceEventType.MOUSE_MOVE),this._handler=e}},{key:"_unbindMourseEvent",value:function(){null!=this._handler&&(this._handler.destroy(),delete this._handler)}},{key:"_addToScene",value:function(){this.frustumQuaternion=this.getFrustumQuaternion(this.cameraPosition,this.viewPosition),this._createShadowMap(this.cameraPosition,this.viewPosition),this._addPostProcess(),this.radar||this.addRadar(this.cameraPosition,this.frustumQuaternion),this.viewer.scene.primitives.add(this)}},{key:"_createShadowMap",value:function(e,t,i){var a=e,n=t,r=this.viewer.scene,o=new c.default.Camera(r);o.position=a,o.direction=c.default.Cartesian3.subtract(n,a,new c.default.Cartesian3(0,0,0)),o.up=c.default.Cartesian3.normalize(a,new c.default.Cartesian3(0,0,0));var s=Number(c.default.Cartesian3.distance(n,a).toFixed(1));this.distance=s,o.frustum=new c.default.PerspectiveFrustum({fov:c.default.Math.toRadians(120),aspectRatio:r.canvas.clientWidth/r.canvas.clientHeight,near:.1,far:5e3}),this.viewShadowMap=new c.default.ShadowMap({lightCamera:o,enable:!1,isPointLight:!1,isSpotLight:!0,cascadesEnabled:!1,context:r.context,pointLightRadius:s})}},{key:"getFrustumQuaternion",value:function(e,t){var i=c.default.Cartesian3.normalize(c.default.Cartesian3.subtract(t,e,new c.default.Cartesian3),new c.default.Cartesian3),a=c.default.Cartesian3.normalize(e,new c.default.Cartesian3),n=new c.default.Camera(this.viewer.scene);n.position=e,n.direction=i,n.up=a,i=n.directionWC,a=n.upWC;var r=n.rightWC,o=new c.default.Cartesian3,s=new c.default.Matrix3,l=new c.default.Quaternion;r=c.default.Cartesian3.negate(r,o);var u=s;return c.default.Matrix3.setColumn(u,0,r,u),c.default.Matrix3.setColumn(u,1,a,u),c.default.Matrix3.setColumn(u,2,i,u),c.default.Quaternion.fromRotationMatrix(u,l)}},{key:"_addPostProcess",value:function(){var e=this,t=r.default,i=this,a=i.viewShadowMap._isPointLight?i.viewShadowMap._pointBias:i.viewShadowMap._primitiveBias;this.postProcess=new c.default.PostProcessStage({fragmentShader:t,uniforms:{czzj:function(){return e.verticalAngle},dis:function(){return e.distance},spzj:function(){return e.horizontalAngle},visibleColor:function(){return e.visibleAreaColor},disVisibleColor:function(){return e.hiddenAreaColor},mixNum:function(){return e.alpha},stcshadow:function(){return i.viewShadowMap._shadowMapTexture},_shadowMap_matrix:function(){return i.viewShadowMap._shadowMapMatrix},shadowMap_lightPositionEC:function(){return i.viewShadowMap._lightPositionEC},shadowMap_lightDirectionEC:function(){return i.viewShadowMap._lightDirectionEC},shadowMap_lightUp:function(){return i.viewShadowMap._lightCamera.up},shadowMap_lightDir:function(){return i.viewShadowMap._lightCamera.direction},shadowMap_lightRight:function(){return i.viewShadowMap._lightCamera.right},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var e=new c.default.Cartesian2;return e.x=1/i.viewShadowMap._textureSize.x,e.y=1/i.viewShadowMap._textureSize.y,c.default.Cartesian4.fromElements(e.x,e.y,a.depthBias,a.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return c.default.Cartesian4.fromElements(a.normalOffsetScale,i.viewShadowMap._distance,i.viewShadowMap.maximumDistance,i.viewShadowMap._darkness,this.combinedUniforms2)}}}),this.show&&this.viewer.scene.postProcessStages.add(this.postProcess)}},{key:"removeRadar",value:function(){this.viewer.entities.remove(this.radar)}},{key:"resetRadar",value:function(){this.removeRadar(),this.addRadar(this.cameraPosition,this.frustumQuaternion)}},{key:"addRadar",value:function(e,t){var i=e;this.radar=this.viewer.entities.add({position:i,orientation:t,show:this.show,rectangularSensor:new o.RectangularSensorGraphics({radius:this.distance,xHalfAngle:c.default.Math.toRadians(this.horizontalAngle/2),yHalfAngle:c.default.Math.toRadians(this.verticalAngle/2),material:new c.default.Color(0,1,1,.4),lineColor:new c.default.Color(1,1,1,1),slice:8,showScanPlane:!1,scanPlaneColor:new c.default.Color(0,1,1,1),scanPlaneMode:"vertical",scanPlaneRate:3,showThroughEllipsoid:!1,showLateralSurfaces:!1,showDomeSurfaces:!1})})}},{key:"update",value:function(e){this.viewShadowMap&&e.shadowMaps.push(this.viewShadowMap)}},{key:"_switchShow",value:function(){this.show?this.postProcess||this._addPostProcess():(this.viewer.scene.postProcessStages.remove(this.postProcess),delete this.postProcess,this.postProcess=null),this.radar.show=this.show}},{key:"destroy",value:function(){this._unbindMourseEvent(),this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.entities.remove(this.radar),delete this.radar,delete this.postProcess,delete this.viewShadowMap,delete this.verticalAngle,delete this.viewer,delete this.horizontalAngle,delete this.visibleAreaColor,delete this.hiddenAreaColor,delete this.distance,delete this.frustumQuaternion,delete this.cameraPosition,delete this.viewPosition,delete this.alpha}},{key:"horizontalAngle",get:function(){return this._horizontalAngle},set:function(e){this._horizontalAngle=e,this.resetRadar()}},{key:"verticalAngle",get:function(){return this._verticalAngle},set:function(e){this._verticalAngle=e,this.resetRadar()}},{key:"distance",get:function(){return this._distance},set:function(e){this._distance=e,this.resetRadar()}},{key:"visibleAreaColor",get:function(){return this._visibleAreaColor},set:function(e){this._visibleAreaColor=e}},{key:"hiddenAreaColor",get:function(){return this._hiddenAreaColor},set:function(e){this._hiddenAreaColor=e}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=e}},{key:"show",get:function(){return this.defaultShow},set:function(e){this.defaultShow=Boolean(e),this._switchShow()}}]),u);function u(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),e&&(t=t||{},this.viewer=e,this.cameraPosition=c.default.defaultValue(t.cameraPosition,l.cameraPosition),this.viewPosition=c.default.defaultValue(t.viewPosition,l.viewPosition),this._horizontalAngle=c.default.defaultValue(t.horizontalAngle,l.horizontalAngle),this._verticalAngle=c.default.defaultValue(t.verticalAngle,l.verticalAngle),this._visibleAreaColor=c.default.defaultValue(t.visibleAreaColor,l.visibleAreaColor),this._hiddenAreaColor=c.default.defaultValue(t.hiddenAreaColor,l.hiddenAreaColor),this._alpha=c.default.defaultValue(t.alpha,l.alpha),this._distance=c.default.defaultValue(t.distance,l.distance),this._frustum=c.default.defaultValue(t.frustum,l.frustum),this.calback=t.calback,this.defaultShow=c.default.defaultValue(t.show,!0),this.cameraPosition&&this.viewPosition?(this._addToScene(),this.calback&&this.calback()):this._bindMourseEvent())}},function(e,t){e.exports="uniform float czzj;\r\nuniform float dis;\r\nuniform float spzj;\r\nuniform vec3 visibleColor;\r\nuniform vec3 disVisibleColor;\r\nuniform float mixNum;\r\nuniform sampler2D colorTexture;\r\nuniform sampler2D stcshadow; \r\nuniform sampler2D depthTexture;\r\nuniform mat4 _shadowMap_matrix; \r\nuniform vec4 shadowMap_lightPositionEC; \r\nuniform vec4 shadowMap_lightDirectionEC;\r\nuniform vec3 shadowMap_lightUp;\r\nuniform vec3 shadowMap_lightDir;\r\nuniform vec3 shadowMap_lightRight;\r\nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \r\nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \r\nvarying vec2 v_textureCoordinates;\r\nvec4 toEye(in vec2 uv, in float depth){\r\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\r\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\r\n    posInCamera =posInCamera / posInCamera.w;\r\n    return posInCamera;\r\n}\r\nfloat getDepth(in vec4 depth){\r\n    float z_window = czm_unpackDepth(depth);\r\n    z_window = czm_reverseLogDepth(z_window);\r\n    float n_range = czm_depthRange.near;\r\n    float f_range = czm_depthRange.far;\r\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\r\n}\r\nfloat _czm_sampleShadowMap(sampler2D shadowMap, vec2 uv){\r\n    return texture2D(shadowMap, uv).r;\r\n}\r\nfloat _czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth){\r\n    return step(depth, _czm_sampleShadowMap(shadowMap, uv));\r\n}\r\nfloat _czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters){\r\n    float depthBias = shadowParameters.depthBias;\r\n    float depth = shadowParameters.depth;\r\n    float nDotL = shadowParameters.nDotL;\r\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\r\n    float darkness = shadowParameters.darkness;\r\n    vec2 uv = shadowParameters.texCoords;\r\n    depth -= depthBias;\r\n    vec2 texelStepSize = shadowParameters.texelStepSize;\r\n    float radius = 1.0;\r\n    float dx0 = -texelStepSize.x * radius;\r\n    float dy0 = -texelStepSize.y * radius;\r\n    float dx1 = texelStepSize.x * radius;\r\n    float dy1 = texelStepSize.y * radius;\r\n    float visibility = \r\n    (\r\n    _czm_shadowDepthCompare(shadowMap, uv, depth)\r\n    +_czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\r\n    ) * (1.0 / 9.0)\r\n    ;\r\n    return visibility;\r\n}\r\nvec3 pointProjectOnPlane(in vec3 planeNormal, in vec3 planeOrigin, in vec3 point){\r\n    vec3 v01 = point -planeOrigin;\r\n    float d = dot(planeNormal, v01) ;\r\n    return (point - planeNormal * d);\r\n}\r\nfloat ptm(vec3 pt){\r\n    return sqrt(pt.x*pt.x + pt.y*pt.y + pt.z*pt.z);\r\n}\r\nvoid main() \r\n{ \r\n    const float PI = 3.141592653589793;\r\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\r\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\r\n\r\n    // vec4 stcc = texture2D(stcshadow, v_textureCoordinates);\r\n    // gl_FragColor = stcc;\r\n    // return;\r\n    if(currD.r>=1.0){\r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n    \r\n    float depth = getDepth(currD);\r\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\r\n    vec3 normalEC = vec3(1.0);\r\n    czm_shadowParameters shadowParameters; \r\n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \r\n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \r\n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \r\n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \r\n    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \r\n    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \r\n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \r\n    vec4 shadowPosition = _shadowMap_matrix * positionEC; \r\n    shadowPosition /= shadowPosition.w; \r\n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \r\n    { \r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n\r\n    //坐标与视点位置距离，大于最大距离则舍弃阴影效果\r\n    vec4 lw = czm_inverseView*  vec4(shadowMap_lightPositionEC.xyz, 1.0);\r\n    vec4 vw = czm_inverseView* vec4(positionEC.xyz, 1.0);\r\n    if(distance(lw.xyz,vw.xyz)>dis){\r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n\r\n\r\n    //水平夹角限制\r\n    vec3 ptOnSP = pointProjectOnPlane(shadowMap_lightUp,lw.xyz,vw.xyz);\r\n    directionEC = ptOnSP - lw.xyz;\r\n    float directionECMO = ptm(directionEC.xyz);\r\n    float shadowMap_lightDirMO = ptm(shadowMap_lightDir.xyz);\r\n    float cosJJ = dot(directionEC,shadowMap_lightDir)/(directionECMO*shadowMap_lightDirMO);\r\n    float degJJ = acos(cosJJ)*(180.0 / PI);\r\n    degJJ = abs(degJJ);\r\n    if(degJJ>spzj/2.0){\r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n\r\n    //垂直夹角限制\r\n    vec3 ptOnCZ = pointProjectOnPlane(shadowMap_lightRight,lw.xyz,vw.xyz);\r\n    vec3 dirOnCZ = ptOnCZ - lw.xyz;\r\n    float dirOnCZMO = ptm(dirOnCZ);\r\n    float cosJJCZ = dot(dirOnCZ,shadowMap_lightDir)/(dirOnCZMO*shadowMap_lightDirMO);\r\n    float degJJCZ = acos(cosJJCZ)*(180.0 / PI);\r\n    degJJCZ = abs(degJJCZ);\r\n    if(degJJCZ>czzj/2.0){\r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n\r\n    shadowParameters.texCoords = shadowPosition.xy; \r\n    shadowParameters.depth = shadowPosition.z; \r\n    shadowParameters.nDotL = nDotL; \r\n    float visibility = _czm_shadowVisibility(stcshadow, shadowParameters); \r\n    if(visibility==1.0){\r\n        gl_FragColor = mix(color,vec4(visibleColor,1.0),mixNum);\r\n    }else{\r\n        // if(abs(shadowPosition.z-0.0)<0.01){\r\n        //     return;\r\n        // }\r\n        gl_FragColor = mix(color,vec4(disVisibleColor,1.0),mixNum);\r\n    }\r\n} "},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoShed3D=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var v=o(i(0)),r=o(i(116));function o(e){return e&&e.__esModule?e:{default:e}}var y="Z",_="-Z",w="Y",b="-Y",C="X",x="-X",s={font:"50px 楷体",fill:!0,fillColor:new v.default.Color(1,1,0,1),stroke:!0,strokeWidth:2,strokeColor:new v.default.Color(1,1,1,.8),backgroundColor:new v.default.Color(1,1,1,.1),textBaseline:"top",padding:40};t.VideoShed3D=(a(l,[{key:"rotateCamera",value:function(e,t){var i=v.default.defaultValue(t,this._rotateDeg);switch(e){case y:break;case _:i*=-1;break;case w:break;case b:i*=-1;break;case C:break;case x:i*=-1}var a=this._computedNewViewDir(e,i);this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this.viewShadowMap.destroy(),this.cameraFrustum.destroy(),this._resetCameraDir(a),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess()}},{key:"_resetCameraDir",value:function(e){e&&e.up&&e.right&&e.direction&&(this._dirObj=e,this._createShadowMap())}},{key:"_computedNewViewDir",value:function(e,t){t=v.default.Math.toRadians(t);var i=this.viewShadowMap._lightCamera,a=v.default.clone(i.direction),n=v.default.clone(i.right),r=v.default.clone(i.up),o=new v.default.Matrix3;switch(e){case y:case _:v.default.Matrix3.fromRotationZ(t,o);break;case w:case b:v.default.Matrix3.fromRotationY(t,o);break;case C:case x:v.default.Matrix3.fromRotationX(t,o)}var s=v.default.Transforms.eastNorthUpToFixedFrame(i.position),l=v.default.Matrix4.inverse(s,new v.default.Matrix4),u=v.default.Matrix4.multiplyByPointAsVector(l,a,new v.default.Cartesian3),c=v.default.Matrix3.multiplyByVector(o,u,new v.default.Cartesian3),d=v.default.Matrix4.multiplyByPointAsVector(s,c,new v.default.Cartesian3),h=v.default.Matrix4.multiplyByPointAsVector(l,n,new v.default.Cartesian3),f=v.default.Matrix3.multiplyByVector(o,h,new v.default.Cartesian3),p=v.default.Matrix4.multiplyByPointAsVector(s,f,new v.default.Cartesian3),m=v.default.Matrix4.multiplyByPointAsVector(l,r,new v.default.Cartesian3),g=v.default.Matrix3.multiplyByVector(o,m,new v.default.Cartesian3);return{direction:d,right:p,up:v.default.Matrix4.multiplyByPointAsVector(s,g,new v.default.Cartesian3)}}},{key:"getPercentagePoint",value:function(e){if(e){var t=this.viewShadowMap._lightCamera._viewMatrix,i=this.viewShadowMap._lightCamera.frustum.projectionMatrix,a=new v.default.Cartesian4(e.x,e.y,e.z,1),n=v.default.Matrix4.multiply(i,t,new v.default.Matrix4),r=v.default.Matrix4.multiplyByVector(n,a,new v.default.Cartesian4),o=new v.default.Cartesian2(r.x/r.w,r.y/r.w);return new v.default.Cartesian2(o.x/2+.5,o.y/2+.5)}}},{key:"_changeCameraFov",value:function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess()}},{key:"_changeVideoWidHei",value:function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess()}},{key:"_changeCameraPos",value:function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this.viewShadowMap.destroy(),this.cameraFrustum.destroy(),this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess()}},{key:"_changeViewPos",value:function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this.viewShadowMap.destroy(),this.cameraFrustum.destroy(),this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess()}},{key:"_switchShow",value:function(){this.show?this.postProcess||this._addPostProcess():(this.viewer.scene.postProcessStages.remove(this.postProcess),delete this.postProcess,this.postProcess=null)}},{key:"activeVideo",value:function(e){var t=this._createVideoEle(e),i=this;if(t){this.type=l.Type.Video;var a=this.viewer;this.activeVideoListener||(this.activeVideoListener=function(){i.videoTexture&&i.videoTexture.destroy(),i.videoTexture=new v.default.Texture({context:a.scene.context,source:t,pixelFormat:v.default.PixelFormat.RGBA,pixelDatatype:v.default.PixelDatatype.UNSIGNED_BYTE})}),a.clock.onTick.addEventListener(this.activeVideoListener)}}},{key:"deActiveVideo",value:function(){this.viewer.clock.onTick.removeEventListener(this.activeVideoListener),delete this.activeVideoListener}},{key:"activePicture",value:function(e){this.videoTexture=this.texture;var t=this,i=new Image;i.onload=function(){t.type=l.Type.Image,t.videoTexture=new v.default.Texture({context:t.viewer.scene.context,source:i})},i.onerror=function(){console.log("图片加载失败："+e)},i.src=e}},{key:"activeColor",value:function(e){var t,i,a,n;this.type=l.Type.Color,n=e?(t=255*e.red,i=255*e.green,a=255*e.blue,255*e.alpha):(t=255*Math.random(),i=255*Math.random(),a=255*Math.random(),255*Math.random()),this.videoTexture=new v.default.Texture({context:this.viewer.scene.context,source:{width:1,height:1,arrayBufferView:new Uint8Array([t,i,a,n])},flipY:!1})}},{key:"activeText",value:function(e,t){this.type=l.Type.Text,e&&((t=t||{}).textBaseline="top",this.textCanvas=v.default.writeTextToCanvas(e,t),this.videoTexture=new v.default.Texture({context:this.viewer.scene.context,source:this.textCanvas,flipY:!0}))}},{key:"locate",value:function(){var e=v.default.clone(this.cameraPosition),t=v.default.clone(this.position);if(this.viewer.camera.position=e,this._dirObj)return this.viewer.camera.direction=v.default.clone(this._dirObj.direction),this.viewer.camera.right=v.default.clone(this._dirObj.right),void(this.viewer.camera.up=v.default.clone(this._dirObj.up));this.viewer.camera.direction=v.default.Cartesian3.subtract(t,e,new v.default.Cartesian3(0,0,0)),this.viewer.camera.up=v.default.Cartesian3.normalize(e,new v.default.Cartesian3(0,0,0))}},{key:"_getOrientation",value:function(){var e=this.cameraPosition,t=this.position,i=v.default.Cartesian3.normalize(v.default.Cartesian3.subtract(t,e,new v.default.Cartesian3),new v.default.Cartesian3),a=v.default.Cartesian3.normalize(e,new v.default.Cartesian3),n=new v.default.Camera(this.viewer.scene);n.position=e,n.direction=i,n.up=a,i=n.directionWC,a=n.upWC;var r=n.rightWC,o=new v.default.Cartesian3,s=new v.default.Matrix3,l=new v.default.Quaternion;r=v.default.Cartesian3.negate(r,o);var u=s;v.default.Matrix3.setColumn(u,0,r,u),v.default.Matrix3.setColumn(u,1,a,u),v.default.Matrix3.setColumn(u,2,i,u);var c=v.default.Quaternion.fromRotationMatrix(u,l);return this.orientation=c}},{key:"_createVideoEle",value:function(e){this.videoId="visualDomId";var t=document.createElement("SOURCE");t.type="video/mp4",t.src=e;var i=document.createElement("SOURCE");i.type="video/quicktime",i.src=e;var a=document.createElement("VIDEO");return a.setAttribute("autoplay",!0),a.setAttribute("loop",!0),a.setAttribute("crossorigin",!0),a.appendChild(t),a.appendChild(i),document.body.appendChild(a),this._videoEle=a}},{key:"_getWinWidHei",value:function(){var e=this.viewer.scene;return e.canvas.clientWidth/e.canvas.clientHeight}},{key:"_createShadowMap",value:function(){var e=this.cameraPosition,t=this.position,i=this.viewer.scene,a=new v.default.Camera(i);a.position=e,this._dirObj?(a.direction=this._dirObj.direction,a.right=this._dirObj.right,a.up=this._dirObj.up):(a.direction=v.default.Cartesian3.subtract(t,e,new v.default.Cartesian3(0,0,0)),a.up=v.default.Cartesian3.normalize(e,new v.default.Cartesian3(0,0,0)));var n=v.default.Cartesian3.distance(t,e);this.viewDis=n,a.frustum=new v.default.PerspectiveFrustum({fov:this.fov,aspectRatio:this.aspectRatio,near:.1,far:2*n}),this.viewShadowMap=new v.default.ShadowMap({lightCamera:a,enable:!1,isPointLight:!1,isSpotLight:!0,cascadesEnabled:!1,context:i.context,pointLightRadius:n})}},{key:"_addCameraFrustum",value:function(){this.cameraFrustum=new v.default.Primitive({geometryInstances:new v.default.GeometryInstance({geometry:new v.default.FrustumOutlineGeometry({origin:this.cameraPosition,orientation:this.orientation,frustum:this.viewShadowMap._lightCamera.frustum,_drawNearPlane:!0}),attributes:{color:v.default.ColorGeometryInstanceAttribute.fromColor(new v.default.Color(0,.5,.5))}}),appearance:new v.default.PerInstanceColorAppearance({translucent:!1,flat:!0}),asynchronous:!1,show:this.debugFrustum&&this.show}),this.viewer.scene.primitives.add(this.cameraFrustum)}},{key:"_addPostProcess",value:function(){var t=this,e=r.default,i=t.viewShadowMap._isPointLight?t.viewShadowMap._pointBias:t.viewShadowMap._primitiveBias;this.show&&(this.postProcess=new v.default.PostProcessStage({fragmentShader:e,uniforms:{mixNum:function(){return t.alpha},stcshadow:function(){return t.viewShadowMap._shadowMapTexture},videoTexture:function(){return t.videoTexture},_shadowMap_matrix:function(){return t.viewShadowMap._shadowMapMatrix},shadowMap_lightPositionEC:function(){return t.viewShadowMap._lightPositionEC},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var e=new v.default.Cartesian2;return e.x=1/t.viewShadowMap._textureSize.x,e.y=1/t.viewShadowMap._textureSize.y,v.default.Cartesian4.fromElements(e.x,e.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return v.default.Cartesian4.fromElements(i.normalOffsetScale,t.viewShadowMap._distance,t.viewShadowMap.maximumDistance,t.viewShadowMap._darkness,this.combinedUniforms2)},disViewColor:function(){return t._disViewColor}}}),this.viewer.scene.postProcessStages.add(this.postProcess))}},{key:"update",value:function(e){this.viewShadowMap&&e.shadowMaps.push(this.viewShadowMap)}},{key:"destroy",value:function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this._videoEle&&this._videoEle.parentNode.removeChild(this._videoEle),this.viewer.clock.onTick.removeEventListener(this.activeVideoListener),delete this.activeVideoListener,delete this.postProcess,delete this.viewShadowMap,delete this.color,delete this.viewDis,delete this.cameraPosition,delete this.position,delete this.alpha,delete this._camerafov,delete this._cameraPosition,delete this.videoTexture,delete this.cameraFrustum,delete this._videoEle,delete this._debugFrustum,delete this._position,delete this._aspectRatio,delete this.url,delete this.orientation,delete this.texture,delete this.videoId,delete this.type,delete this.videoTexture,delete this.url,this.viewer.scene.primitives.remove(this),delete this.viewer}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=e}},{key:"aspectRatio",get:function(){return this._aspectRatio},set:function(e){this._aspectRatio=e,this._changeVideoWidHei()}},{key:"debugFrustum",get:function(){return this._debugFrustum},set:function(e){this._debugFrustum=e,this.cameraFrustum.show=e}},{key:"fov",get:function(){return this._camerafov},set:function(e){this._camerafov=v.default.Math.toRadians(e),this._changeCameraFov()}},{key:"cameraPosition",get:function(){return this._cameraPosition},set:function(e){e&&(this._cameraPosition=e,this._changeCameraPos())}},{key:"position",get:function(){return this._position},set:function(e){e&&(this._position=e,this._changeViewPos())}},{key:"videoPlay",get:function(){return this._videoPlay},set:function(e){this._videoPlay=Boolean(e),this._videoEle&&(this.videoPlay?this._videoEle.play():this._videoEle.pause())}},{key:"params",get:function(){var e={};return e.type=this.type,this.type==l.Type.Color?e.color=this.color:e.url=this.url,e.position=this.position,e.cameraPosition=this.cameraPosition,e.fov=v.default.Math.toDegrees(this.fov),e.aspectRatio=this.aspectRatio,e.alpha=this.alpha,e.debugFrustum=this.debugFrustum,e.dirObj=this._dirObj,e}},{key:"show",get:function(){return this.defaultShow},set:function(e){this.defaultShow=Boolean(e),this._switchShow()}},{key:"camera",get:function(){return this.viewShadowMap._lightCamera}},{key:"disViewColor",get:function(){return this._disViewColor},set:function(e){e&&((this._disViewColor=e).a||0==e.a||(this._disViewColor.a=1))}}]),l);function l(e,t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),e){t=t||{},this.viewer=e,this._cameraPosition=t.cameraPosition,this._position=t.position,this.type=t.type,this.alpha=t.alpha||1,this.url=t.url,this.color=t.color,this._debugFrustum=v.default.defaultValue(t.debugFrustum,!0),this._aspectRatio=t.aspectRatio||this._getWinWidHei();var i=t.fov&&v.default.Math.toRadians(t.fov);if(this._camerafov=i||this.viewer.scene.camera.frustum.fov,this.texture=t.texture||new v.default.Texture({context:this.viewer.scene.context,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1}),this._videoPlay=v.default.defaultValue(t.videoPlay,!0),this.defaultShow=v.default.defaultValue(t.show,!0),this._rotateDeg=1,this._dirObj=v.default.defaultValue(t.dirObj,void 0),this.text=v.default.defaultValue(t.text,void 0),this.textStyles=v.default.defaultValue(t.textStyles,s),this._disViewColor=v.default.defaultValue(t.disViewColor,new v.default.Color(0,0,0,.5)),this.cameraPosition&&this.cameraPosition){switch(l.Type={Color:1,Image:2,Video:3,Text:4},this.type){default:case l.Type.Video:this.activeVideo(this.url);break;case l.Type.Image:this.activePicture(this.url),this.deActiveVideo();break;case l.Type.Color:this.activeColor(this.color),this.deActiveVideo();break;case l.Type.Text:this.activeText(this.text,this.textStyles),this.deActiveVideo()}this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess(),this.viewer.scene.primitives.add(this)}else console.log("初始化失败：请确认相机位置与视点位置正确！")}}},function(e,t){e.exports="\r\n\r\n\r\n\r\nuniform float mixNum;\r\nuniform sampler2D colorTexture;\r\nuniform sampler2D stcshadow; \r\nuniform sampler2D videoTexture;\r\nuniform sampler2D depthTexture;\r\nuniform mat4 _shadowMap_matrix; \r\nuniform vec4 shadowMap_lightPositionEC; \r\nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \r\nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \r\nuniform vec4 disViewColor;\r\nvarying vec2 v_textureCoordinates;\r\nvec4 toEye(in vec2 uv, in float depth){\r\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\r\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\r\n    posInCamera =posInCamera / posInCamera.w;\r\n    return posInCamera;\r\n}\r\nfloat getDepth(in vec4 depth){\r\n    float z_window = czm_unpackDepth(depth);\r\n    z_window = czm_reverseLogDepth(z_window);\r\n    float n_range = czm_depthRange.near;\r\n    float f_range = czm_depthRange.far;\r\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\r\n}\r\nfloat _czm_sampleShadowMap(sampler2D shadowMap, vec2 uv){\r\n    return texture2D(shadowMap, uv).r;\r\n}\r\nfloat _czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth){\r\n    return step(depth, _czm_sampleShadowMap(shadowMap, uv));\r\n}\r\nfloat _czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters){\r\n    float depthBias = shadowParameters.depthBias;\r\n    float depth = shadowParameters.depth;\r\n    float nDotL = shadowParameters.nDotL;\r\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\r\n    float darkness = shadowParameters.darkness;\r\n    vec2 uv = shadowParameters.texCoords;\r\n    depth -= depthBias;\r\n    vec2 texelStepSize = shadowParameters.texelStepSize;\r\n    float radius = 1.0;\r\n    float dx0 = -texelStepSize.x * radius;\r\n    float dy0 = -texelStepSize.y * radius;\r\n    float dx1 = texelStepSize.x * radius;\r\n    float dy1 = texelStepSize.y * radius;\r\n    float visibility = \r\n    (\r\n    _czm_shadowDepthCompare(shadowMap, uv, depth)\r\n    +_czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\r\n    _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\r\n    ) * (1.0 / 9.0)\r\n    ;\r\n    return visibility;\r\n}\r\nvec3 pointProjectOnPlane(in vec3 planeNormal, in vec3 planeOrigin, in vec3 point){\r\n    vec3 v01 = point -planeOrigin;\r\n    float d = dot(planeNormal, v01) ;\r\n    return (point - planeNormal * d);\r\n}\r\nfloat ptm(vec3 pt){\r\n    return sqrt(pt.x*pt.x + pt.y*pt.y + pt.z*pt.z);\r\n}\r\nvoid main() \r\n{ \r\n    const float PI = 3.141592653589793;\r\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\r\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\r\n    if(currD.r>=1.0){\r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n    \r\n    float depth = getDepth(currD);\r\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\r\n    vec3 normalEC = vec3(1.0);\r\n    czm_shadowParameters shadowParameters; \r\n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \r\n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \r\n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \r\n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \r\n    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \r\n    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \r\n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \r\n    vec4 shadowPosition = _shadowMap_matrix * positionEC; \r\n    shadowPosition /= shadowPosition.w; \r\n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \r\n    { \r\n        gl_FragColor = color;\r\n        return;\r\n    }\r\n\r\n    shadowParameters.texCoords = shadowPosition.xy; \r\n    shadowParameters.depth = shadowPosition.z; \r\n    shadowParameters.nDotL = nDotL; \r\n    float visibility = _czm_shadowVisibility(stcshadow, shadowParameters); \r\n\r\n    vec4 videoColor = texture2D(videoTexture,shadowPosition.xy);\r\n    if(visibility==1.0){\r\n        gl_FragColor = mix(color,vec4(videoColor.xyz,1.0),mixNum*videoColor.a);\r\n    }else{\r\n        if(abs(shadowPosition.z-0.0)<0.01){\r\n            return;\r\n        }\r\n        gl_FragColor = vec4(mix(color.rgb,disViewColor.rgb,disViewColor.a),disViewColor.a);\r\n    }\r\n} "},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Underground=void 0;var a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r,o=i(0),s=(r=o)&&r.__esModule?r:{default:r};t.Underground=(a(l,[{key:"_updateImageryLayersAlpha",value:function(e){for(var t=this._viewer.imageryLayers._layers,i=0,a=t.length;i<a;i++)t[i].alpha=e}},{key:"_historyOpts",value:function(){var e={};e.alpha=s.default.clone(this._viewer.imageryLayers._layers[0]&&this._viewer.imageryLayers._layers[0].alpha),e.highDynamicRange=s.default.clone(this._viewer.scene.highDynamicRange),e.skyShow=s.default.clone(this._viewer.scene.skyAtmosphere.show),e.skyBoxShow=s.default.clone(this._viewer.scene.skyBox.show),e.depthTest=s.default.clone(this._viewer.scene.globe.depthTestAgainstTerrain),this._viewer.scene.globe._surface&&this._viewer.scene.globe._surface._tileProvider&&this._viewer.scene.globe._surface._tileProvider._renderState&&(e.blending=s.default.clone(this._viewer.scene.globe._surface._tileProvider._renderState.blending)),this._oldViewOpts=e}},{key:"activate",value:function(){if(!this._enable){this._enable=!0,this._historyOpts(),this._updateImageryLayersAlpha(this._alpha);var e=this._viewer;s.default.ExpandByMars.underEarth.cullFace=!1,s.default.ExpandByMars.underEarth.enable=!0,s.default.ExpandByMars.underEarth.enableDepth=this._depth,s.default.ExpandByMars.underEarth.enableSkirt=!0,e.scene.globe.depthTestAgainstTerrain=!0,e.scene.highDynamicRange=!1,e.scene.skyAtmosphere.show=!1,e.scene.skyBox.show=!1,e.scene.globe._surface._tileProvider&&e.scene.globe._surface._tileProvider._renderState&&e.scene.globe._surface._tileProvider._renderState.blending&&(e.scene.globe._surface._tileProvider._renderState.blending.enabled=!0,e.scene.globe._surface._tileProvider._renderState.blending.equationRgb=s.default.BlendEquation.ADD,e.scene.globe._surface._tileProvider._renderState.blending.equationAlpha=s.default.BlendEquation.ADD,e.scene.globe._surface._tileProvider._renderState.blending.functionSourceAlpha=s.default.BlendFunction.ONE,e.scene.globe._surface._tileProvider._renderState.blending.functionSourceRgb=s.default.BlendFunction.ONE,e.scene.globe._surface._tileProvider._renderState.blending.functionDestinationAlpha=s.default.BlendFunction.ZERO,e.scene.globe._surface._tileProvider._renderState.blending.functionDestinationRgb=s.default.BlendFunction.ZERO)}}},{key:"disable",value:function(){if(this._enable){this._enable=!1,this._updateImageryLayersAlpha(this._oldViewOpts.alpha);var e=this._viewer;s.default.ExpandByMars.underEarth.cullFace=void 0,s.default.ExpandByMars.underEarth.enable=!1,s.default.ExpandByMars.underEarth.enableDepth=0,s.default.ExpandByMars.underEarth.enableSkirt=!1,e.scene.globe.depthTestAgainstTerrain=this._oldViewOpts.depthTest,e.scene.skyBox.show=this._oldViewOpts.skyBoxShow,e.scene.highDynamicRange=this._oldViewOpts.highDynamicRange,e.scene.skyAtmosphere.show=this._oldViewOpts.skyShow,null!=this._oldViewOpts.blending&&(e.scene.globe._surface._tileProvider._renderState.blending=this._oldViewOpts.blending)}}},{key:"destroy",value:function(){delete this._viewer,delete this._alpha,delete this._depth,delete this._enable,delete this._oldViewOpts}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=Number(e),this._enable&&this._updateImageryLayersAlpha(this._alpha)}},{key:"depth",get:function(){return this._depth},set:function(e){this._depth=Number(e),this._enable&&(s.default.ExpandByMars.underEarth.enableDepth=this._depth)}},{key:"enable",get:function(){return this._enable},set:function(e){e?this.activate():this.disable()}}]),l);function l(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this._viewer=e;var i=s.default.defaultValue(t,{});this._depth=s.default.defaultValue(i.depth,500),this._alpha=s.default.defaultValue(i.alpha,.5),this.enable=s.default.defaultValue(i.enable,!1)}}],e={},f.m=d,f.c=e,f.d=function(e,t,i){f.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},f.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(t,"a",t),t},f.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},f.p="",f(f.s=44);function f(t){if(e[t])return e[t].exports;var i=e[t]={i:t,l:!1,exports:{}};return d[t].call(i.exports,i,i.exports,f),i.l=!0,i.exports}var d,e});